!function(){this.$jit=function(e){e=e||window;for(var t in $jit)$jit[t].$extend&&(e[t]=$jit[t])},$jit.version="2.0.1";var e=function(e){return document.getElementById(e)};e.empty=function(){},e.extend=function(e,t){for(var i in t||{})e[i]=t[i];return e},e.lambda=function(e){return"function"==typeof e?e:function(){return e}},e.time=Date.now||function(){return+new Date},e.splat=function(t){var i=e.type(t);return i?"array"!=i?[t]:t:[]},e.type=function(t){var i=e.type.s.call(t).match(/^\[object\s(.*)\]$/)[1].toLowerCase();return"object"!=i?i:t&&t.$$family?t.$$family:t&&9==t.nodeType?"htmldocument":t&&t.nodeName&&1==t.nodeType?"element":i},e.type.s=Object.prototype.toString,e.each=function(t,i){var n=e.type(t);if("object"==n)for(var a in t)i(t[a],a);else for(var o=0,s=t.length;s>o;o++)i(t[o],o)},e.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1},e.map=function(t,i){var n=[];return e.each(t,function(e,t){n.push(i(e,t))}),n},e.reduce=function(e,t,i){var n=e.length;if(0==n)return i;for(var a=3==arguments.length?i:e[--n];n--;)a=t(a,e[n]);return a},e.merge=function(){for(var t={},i=0,n=arguments.length;n>i;i++){var a=arguments[i];if("object"==e.type(a))for(var o in a){var s=a[o],r=t[o];t[o]=r&&"object"==e.type(s)&&"object"==e.type(r)?e.merge(r,s):e.unlink(s)}}return t},e.unlink=function(t){var i;switch(e.type(t)){case"object":i={};for(var n in t)i[n]=e.unlink(t[n]);break;case"array":i=[];for(var a=0,o=t.length;o>a;a++)i[a]=e.unlink(t[a]);break;default:return t}return i},e.zip=function(){if(0===arguments.length)return[];for(var e=0,t=[],i=arguments.length,n=arguments[0].length;n>e;e++){for(var a=0,o=[];i>a;a++)o.push(arguments[a][e]);t.push(o)}return t},e.rgbToHex=function(e,t){if(e.length<3)return null;if(4==e.length&&0==e[3]&&!t)return"transparent";for(var i=[],n=0;3>n;n++){var a=(e[n]-0).toString(16);i.push(1==a.length?"0"+a:a)}return t?i:"#"+i.join("")},e.hexToRgb=function(e){if(7!=e.length){if(e=e.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/),e.shift(),3!=e.length)return null;for(var t=[],i=0;3>i;i++){var n=e[i];1==n.length&&(n+=n),t.push(parseInt(n,16))}return t}return e=parseInt(e.slice(1),16),[e>>16,e>>8&255,255&e]},e.destroy=function(t){e.clean(t),t.parentNode&&t.parentNode.removeChild(t),t.clearAttributes&&t.clearAttributes()},e.clean=function(t){for(var i=t.childNodes,n=0,a=i.length;a>n;n++)e.destroy(i[n])},e.addEvent=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)},e.addEvents=function(t,i){for(var n in i)e.addEvent(t,n,i[n])},e.hasClass=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1},e.addClass=function(t,i){e.hasClass(t,i)||(t.className=t.className+" "+i)},e.removeClass=function(e,t){e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)"),"$1")},e.getPos=function(e){function t(e){for(var t={x:0,y:0};e&&!n(e);)t.x+=e.offsetLeft,t.y+=e.offsetTop,e=e.offsetParent;return t}function i(e){for(var t={x:0,y:0};e&&!n(e);)t.x+=e.scrollLeft,t.y+=e.scrollTop,e=e.parentNode;return t}function n(e){return/^(?:body|html)$/i.test(e.tagName)}var a=t(e),o=i(e);return{x:a.x-o.x,y:a.y-o.y}},e.event={get:function(e,t){return t=t||window,e||t.event},getWheel:function(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3},isRightClick:function(e){return 3==e.which||2==e.button},getPos:function(e,t){t=t||window,e=e||t.event;var i=t.document;i=i.documentElement||i.body,e.touches&&e.touches.length&&(e=e.touches[0]);var n={x:e.pageX||e.clientX+i.scrollLeft,y:e.pageY||e.clientY+i.scrollTop};return n},stop:function(e){e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1}},$jit.util=$jit.id=e;var t=function(i){i=i||{};var n=function(){for(var i in this)"function"!=typeof this[i]&&(this[i]=e.unlink(this[i]));if(this.constructor=n,t.prototyping)return this;var a=this.initialize?this.initialize.apply(this,arguments):this;return this.$$family="class",a};for(var a in t.Mutators)i[a]&&(i=t.Mutators[a](i,i[a]),delete i[a]);return e.extend(n,this),n.constructor=t,n.prototype=i,n};t.Mutators={Implements:function(i,n){return e.each(e.splat(n),function(e){t.prototyping=e;var n="function"==typeof e?new e:e;for(var a in n)a in i||(i[a]=n[a]);delete t.prototyping}),i}},e.extend(t,{inherit:function(i,n){for(var a in n){var o=n[a],s=i[a],r=e.type(o);s&&"function"==r?o!=s&&t.override(i,a,o):"object"==r?i[a]=e.merge(s,o):i[a]=o}return i},override:function(e,i,n){var a=t.prototyping;a&&e[i]!=a[i]&&(a=null);var o=function(){var t=this.parent;this.parent=a?a[i]:e[i];var o=n.apply(this,arguments);return this.parent=t,o};e[i]=o}}),t.prototype.implement=function(){var i=this.prototype;return e.each(Array.prototype.slice.call(arguments||[]),function(e){t.inherit(i,e)}),this},$jit.Class=t,$jit.json={prune:function(e,t){this.each(e,function(e,i){i==t&&e.children&&(delete e.children,e.children=[])})},getParent:function(e,t){if(e.id==t)return!1;var i=e.children;if(i&&i.length>0)for(var n=0;n<i.length;n++){if(i[n].id==t)return e;var a=this.getParent(i[n],t);if(a)return a}return!1},getSubtree:function(e,t){if(e.id==t)return e;for(var i=0,n=e.children;n&&i<n.length;i++){var a=this.getSubtree(n[i],t);if(null!=a)return a}return null},eachLevel:function(e,t,i,n){if(i>=t){if(n(e,t),!e.children)return;for(var a=0,o=e.children;a<o.length;a++)this.eachLevel(o[a],t+1,i,n)}},each:function(e,t){this.eachLevel(e,0,Number.MAX_VALUE,t)}},$jit.Trans={$extend:!0,linear:function(e){return e}};var i=$jit.Trans;!function(){var t=function(t,i){return i=e.splat(i),e.extend(t,{easeIn:function(e){return t(e,i)},easeOut:function(e){return 1-t(1-e,i)},easeInOut:function(e){return.5>=e?t(2*e,i)/2:(2-t(2*(1-e),i))/2}})},n={Pow:function(e,t){return Math.pow(e,t[0]||6)},Expo:function(e){return Math.pow(2,8*(e-1))},Circ:function(e){return 1-Math.sin(Math.acos(e))},Sine:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Back:function(e,t){return t=t[0]||1.618,Math.pow(e,2)*((t+1)*e-t)},Bounce:function(e){for(var t,i=0,n=1;1;i+=n,n/=2)if(e>=(7-4*i)/11){t=n*n-Math.pow((11-6*i-11*e)/4,2);break}return t},Elastic:function(e,t){return Math.pow(2,10*--e)*Math.cos(20*e*Math.PI*(t[0]||1)/3)}};e.each(n,function(e,n){i[n]=t(e)}),e.each(["Quad","Cubic","Quart","Quint"],function(e,n){i[e]=t(function(e){return Math.pow(e,[n+2])})})}();var n=new t({initialize:function(e){this.setOptions(e)},setOptions:function(t){var n={duration:2500,fps:40,transition:i.Quart.easeInOut,compute:e.empty,complete:e.empty,link:"ignore"};return this.opt=e.merge(n,t||{}),this},step:function(){var t=e.time(),i=this.opt;if(t<this.time+i.duration){var n=i.transition((t-this.time)/i.duration);i.compute(n)}else this.timer=clearInterval(this.timer),i.compute(1),i.complete()},start:function(){return this.check()?(this.time=0,this.startTimer(),this):this},startTimer:function(){var t=this,i=this.opt.fps;return this.timer?!1:(this.time=e.time()-this.time,this.timer=setInterval(function(){t.step()},Math.round(1e3/i)),!0)},pause:function(){return this.stopTimer(),this},resume:function(){return this.startTimer(),this},stopTimer:function(){return this.timer?(this.time=e.time()-this.time,this.timer=clearInterval(this.timer),!0):!1},check:function(){return this.timer?"cancel"==this.opt.link?(this.stopTimer(),!0):!1:!0}}),a=function(){for(var t=arguments,i=0,n=t.length,o={};n>i;i++){var s=a[t[i]];s.$extend?e.extend(o,s):o[t[i]]=s}return o};a.AreaChart={$extend:!0,animate:!0,labelOffset:3,type:"stacked",Tips:{enable:!1,onShow:e.empty,onHide:e.empty},Events:{enable:!1,onClick:e.empty},selectOnHover:!0,showAggregates:!0,showLabels:!0,filterOnClick:!1,restoreOnRightClick:!1},a.Margin={$extend:!1,top:0,left:0,right:0,bottom:0},a.Canvas={$extend:!0,injectInto:"id",type:"2D",width:!1,height:!1,useCanvas:!1,withLabels:!0,background:!1,Scene:{Lighting:{enable:!1,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[.5,.3,.1]}}}},a.Tree={$extend:!0,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:!1,align:"center",levelSpacing:"even"},a.Node={$extend:!1,overridable:!1,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:!1,autoWidth:!1,lineWidth:1,transform:!0,align:"center",angularWidth:1,span:1,CanvasStyles:{}},a.Edge={$extend:!1,overridable:!1,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}},a.Fx={$extend:!0,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:!0},a.Label={$extend:!1,overridable:!1,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"},a.Tips={$extend:!1,enable:!1,type:"auto",offsetX:20,offsetY:20,force:!1,onShow:e.empty,onHide:e.empty},a.NodeStyles={$extend:!1,enable:!1,type:"auto",stylesHover:!1,stylesClick:!1},a.Events={$extend:!1,enable:!1,enableForEdges:!1,type:"auto",onClick:e.empty,onRightClick:e.empty,onMouseMove:e.empty,onMouseEnter:e.empty,onMouseLeave:e.empty,onDragStart:e.empty,onDragMove:e.empty,onDragCancel:e.empty,onDragEnd:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onTouchCancel:e.empty,onMouseWheel:e.empty},a.Navigation={$extend:!1,enable:!1,type:"auto",panning:!1,zooming:!1},a.Controller={$extend:!0,onBeforeCompute:e.empty,onAfterCompute:e.empty,onCreateLabel:e.empty,onPlaceLabel:e.empty,onComplete:e.empty,onBeforePlotLine:e.empty,onAfterPlotLine:e.empty,onBeforePlotNode:e.empty,onAfterPlotNode:e.empty,onBeforeRemoveNode:e.empty,request:!1};var o={initialize:function(e,t){this.viz=t,this.canvas=t.canvas,this.config=t.config[e],this.nodeTypes=t.fx.nodeTypes;var i=this.config.type;this.dom="auto"==i?"Native"!=t.config.Label.type:"Native"!=i,this.labelContainer=this.dom&&t.labels.getLabelContainer(),this.isEnabled()&&this.initializePost()},initializePost:e.empty,setAsProperty:e.lambda(!1),isEnabled:function(){return this.config.enable},isLabel:function(t,i,n){t=e.event.get(t,i);var a=this.labelContainer,o=t.target||t.srcElement,s=t.relatedTarget;return n?s&&s==this.viz.canvas.getCtx().canvas&&!!o&&this.isDescendantOf(o,a):this.isDescendantOf(o,a)},isDescendantOf:function(e,t){for(;e&&e.parentNode;){if(e.parentNode==t)return e;e=e.parentNode}return!1}},s={onMouseUp:e.empty,onMouseDown:e.empty,onMouseMove:e.empty,onMouseOver:e.empty,onMouseOut:e.empty,onMouseWheel:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onTouchCancel:e.empty},r=new t({initialize:function(e){this.viz=e,this.canvas=e.canvas,this.node=!1,this.edge=!1,this.registeredObjects=[],this.attachEvents()},attachEvents:function(){var t=this.canvas.getElement(),i=this;t.oncontextmenu=e.lambda(!1),e.addEvents(t,{mouseup:function(t,n){var a=e.event.get(t,n);i.handleEvent("MouseUp",t,n,i.makeEventObject(t,n),e.event.isRightClick(a))},mousedown:function(t,n){var a=e.event.get(t,n);i.handleEvent("MouseDown",t,n,i.makeEventObject(t,n),e.event.isRightClick(a))},mousemove:function(e,t){i.handleEvent("MouseMove",e,t,i.makeEventObject(e,t))},mouseover:function(e,t){i.handleEvent("MouseOver",e,t,i.makeEventObject(e,t))},mouseout:function(e,t){i.handleEvent("MouseOut",e,t,i.makeEventObject(e,t))},touchstart:function(e,t){i.handleEvent("TouchStart",e,t,i.makeEventObject(e,t))},touchmove:function(e,t){i.handleEvent("TouchMove",e,t,i.makeEventObject(e,t))},touchend:function(e,t){i.handleEvent("TouchEnd",e,t,i.makeEventObject(e,t))}});var n=function(t,n){var a=e.event.get(t,n),o=e.event.getWheel(a);i.handleEvent("MouseWheel",t,n,o)};document.getBoxObjectFor||null!=window.mozInnerScreenX?t.addEventListener("DOMMouseScroll",n,!1):e.addEvent(t,"mousewheel",n)},register:function(e){this.registeredObjects.push(e)},handleEvent:function(){for(var e=Array.prototype.slice.call(arguments),t=e.shift(),i=0,n=this.registeredObjects,a=n.length;a>i;i++)n[i]["on"+t].apply(n[i],e)},makeEventObject:function(t,i){var n=this,a=this.viz.graph,o=this.viz.fx,s=o.nodeTypes,r=o.edgeTypes;return{pos:!1,node:!1,edge:!1,contains:!1,getNodeCalled:!1,getEdgeCalled:!1,getPos:function(){var a=n.viz.canvas,o=a.getSize(),s=a.getPos(),r=a.translateOffsetX,h=a.translateOffsetY,l=a.scaleOffsetX,c=a.scaleOffsetY,d=e.event.getPos(t,i);return this.pos={x:1*(d.x-s.x-o.width/2-r)/l,y:1*(d.y-s.y-o.height/2-h)/c},this.pos},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=!0;for(var e in a.nodes){var t=a.nodes[e],i=t&&s[t.getData("type")],r=i&&i.contains&&i.contains.call(o,t,this.getPos());if(r)return this.contains=r,n.node=this.node=t}return n.node=this.node=!1},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=!0;var e={};for(var t in a.edges){var i=a.edges[t];e[t]=!0;for(var s in i)if(!(s in e)){var h=i[s],l=h&&r[h.getData("type")],c=l&&l.contains&&l.contains.call(o,h,this.getPos());if(c)return this.contains=c,n.edge=this.edge=h}}return n.edge=this.edge=!1},getContains:function(){return this.getNodeCalled?this.contains:(this.getNode(),this.contains)}}}}),h={initializeExtras:function(){var t=new r(this),i=this;e.each(["NodeStyles","Tips","Navigation","Events"],function(e){var n=new h.Classes[e](e,i);n.isEnabled()&&t.register(n),n.setAsProperty()&&(i[e.toLowerCase()]=n)})}};h.Classes={},h.Classes.Events=new t({Implements:[o,s],initializePost:function(){this.fx=this.viz.fx,this.ntypes=this.viz.fx.nodeTypes,this.etypes=this.viz.fx.edgeTypes,this.hovered=!1,this.pressed=!1,this.touched=!1,this.touchMoved=!1,this.moved=!1},setAsProperty:e.lambda(!0),onMouseUp:function(t,i,n,a){var o=e.event.get(t,i);this.moved||(a?this.config.onRightClick(this.hovered,n,o):this.config.onClick(this.pressed,n,o)),this.pressed&&(this.moved?this.config.onDragEnd(this.pressed,n,o):this.config.onDragCancel(this.pressed,n,o),this.pressed=this.moved=!1)},onMouseOut:function(t,i,n){var a,o=e.event.get(t,i);if(this.dom&&(a=this.isLabel(t,i,!0)))return this.config.onMouseLeave(this.viz.graph.getNode(a.id),n,o),void(this.hovered=!1);for(var s=o.relatedTarget,r=this.canvas.getElement();s&&s.parentNode;){if(r==s.parentNode)return;s=s.parentNode}this.hovered&&(this.config.onMouseLeave(this.hovered,n,o),this.hovered=!1)},onMouseOver:function(t,i,n){var a,o=e.event.get(t,i);this.dom&&(a=this.isLabel(t,i,!0))&&(this.hovered=this.viz.graph.getNode(a.id),this.config.onMouseEnter(this.hovered,n,o))},onMouseMove:function(t,i,n){var a=e.event.get(t,i);if(this.pressed)return this.moved=!0,void this.config.onDragMove(this.pressed,n,a);if(this.dom)this.config.onMouseMove(this.hovered,n,a);else{if(this.hovered){var o=this.hovered,s=o.nodeFrom?this.etypes[o.getData("type")]:this.ntypes[o.getData("type")],r=s&&s.contains&&s.contains.call(this.fx,o,n.getPos());if(r)return void this.config.onMouseMove(o,n,a);this.config.onMouseLeave(o,n,a),this.hovered=!1}(this.hovered=n.getNode()||this.config.enableForEdges&&n.getEdge())?this.config.onMouseEnter(this.hovered,n,a):this.config.onMouseMove(!1,n,a)}},onMouseWheel:function(t,i,n){this.config.onMouseWheel(n,e.event.get(t,i))},onMouseDown:function(t,i,n){var a,o=e.event.get(t,i);this.dom?(a=this.isLabel(t,i))&&(this.pressed=this.viz.graph.getNode(a.id)):this.pressed=n.getNode()||this.config.enableForEdges&&n.getEdge(),this.pressed&&this.config.onDragStart(this.pressed,n,o)},onTouchStart:function(t,i,n){var a,o=e.event.get(t,i);this.dom&&(a=this.isLabel(t,i))?this.touched=this.viz.graph.getNode(a.id):this.touched=n.getNode()||this.config.enableForEdges&&n.getEdge(),this.touched&&this.config.onTouchStart(this.touched,n,o)},onTouchMove:function(t,i,n){var a=e.event.get(t,i);this.touched&&(this.touchMoved=!0,this.config.onTouchMove(this.touched,n,a))},onTouchEnd:function(t,i,n){var a=e.event.get(t,i);this.touched&&(this.touchMoved?this.config.onTouchEnd(this.touched,n,a):this.config.onTouchCancel(this.touched,n,a),this.touched=this.touchMoved=!1)}}),h.Classes.Tips=new t({Implements:[o,s],initializePost:function(){if(document.body){var t=e("_tooltip")||document.createElement("div");t.id="_tooltip",t.className="tip",e.extend(t.style,{position:"absolute",display:"none",zIndex:13e3}),document.body.appendChild(t),this.tip=t,this.node=!1}},setAsProperty:e.lambda(!0),onMouseOut:function(t,i){e.event.get(t,i);if(this.dom&&this.isLabel(t,i,!0))return void this.hide(!0);for(var n=t.relatedTarget,a=this.canvas.getElement();n&&n.parentNode;){if(a==n.parentNode)return;n=n.parentNode}this.hide(!1)},onMouseOver:function(e,t){var i;this.dom&&(i=this.isLabel(e,t,!1))&&(this.node=this.viz.graph.getNode(i.id),this.config.onShow(this.tip,this.node,i))},onMouseMove:function(t,i,n){if(this.dom&&this.isLabel(t,i)&&this.setTooltipPosition(e.event.getPos(t,i)),!this.dom){var a=n.getNode();if(!a)return void this.hide(!0);(this.config.force||!this.node||this.node.id!=a.id)&&(this.node=a,this.config.onShow(this.tip,a,n.getContains())),this.setTooltipPosition(e.event.getPos(t,i))}},setTooltipPosition:function(e){var t=this.tip,i=t.style,n=this.config;i.display="";var a="CSS1Compat"===document.compatMode&&document.documentElement||document.body||document.documentElement,o={width:a.clientWidth,height:a.clientHeight,x:window.pageXOffset||document.documentElement&&document.documentElement.scrollLeft||document.body&&document.body.scrollLeft||0,y:window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop||0},s={width:t.offsetWidth,height:t.offsetHeight},r=n.offsetX,h=n.offsetY;i.top=(e.y+s.height+h>o.height+o.y?e.y-s.height-h:e.y+h)+"px",i.left=(e.x+s.width+r>o.width+o.x?e.x-s.width-r:e.x+r)+"px"},hide:function(e){this.tip.style.display="none",e&&this.config.onHide()}}),h.Classes.NodeStyles=new t({Implements:[o,s],initializePost:function(){this.fx=this.viz.fx,this.types=this.viz.fx.nodeTypes,this.nStyles=this.config,this.nodeStylesOnHover=this.nStyles.stylesHover,this.nodeStylesOnClick=this.nStyles.stylesClick,this.hoveredNode=!1,this.fx.nodeFxAnimation=new n,this.down=!1,this.move=!1},onMouseOut:function(e,t){if(this.down=this.move=!1,this.hoveredNode){this.dom&&this.isLabel(e,t,!0)&&this.toggleStylesOnHover(this.hoveredNode,!1);for(var i=e.relatedTarget,n=this.canvas.getElement();i&&i.parentNode;){if(n==i.parentNode)return;i=i.parentNode}this.toggleStylesOnHover(this.hoveredNode,!1),this.hoveredNode=!1}},onMouseOver:function(e,t){var i;if(this.dom&&(i=this.isLabel(e,t,!0))){var n=this.viz.graph.getNode(i.id);if(n.selected)return;this.hoveredNode=n,this.toggleStylesOnHover(this.hoveredNode,!0)}},onMouseDown:function(e,t,i,n){if(!n){var a;this.dom&&(a=this.isLabel(e,t))?this.down=this.viz.graph.getNode(a.id):this.dom||(this.down=i.getNode()),this.move=!1}},onMouseUp:function(e,t,i,n){n||(this.move||this.onClick(i.getNode()),this.down=this.move=!1)},getRestoredStyles:function(e,t){var i={},n=this["nodeStylesOn"+t];for(var a in n)i[a]=e.styles["$"+a];return i},toggleStylesOnHover:function(e,t){this.nodeStylesOnHover&&this.toggleStylesOn("Hover",e,t)},toggleStylesOnClick:function(e,t){this.nodeStylesOnClick&&this.toggleStylesOn("Click",e,t)},toggleStylesOn:function(t,n,a){var o=this.viz;this.nStyles;if(a){var s=this;n.styles||(n.styles=e.merge(n.data,{}));for(var r in this["nodeStylesOn"+t]){var h="$"+r;h in n.styles||(n.styles[h]=n.getData(r))}o.fx.nodeFx(e.extend({elements:{id:n.id,properties:s["nodeStylesOn"+t]},transition:i.Quart.easeOut,duration:300,fps:40},this.config))}else{var l=this.getRestoredStyles(n,t);o.fx.nodeFx(e.extend({elements:{id:n.id,properties:l},transition:i.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(e){if(e){var t=this.nodeStylesOnClick;t&&(e.selected?(this.toggleStylesOnClick(e,!1),delete e.selected):(this.viz.graph.eachNode(function(e){if(e.selected){for(var i in t)e.setData(i,e.styles["$"+i],"end");delete e.selected}}),this.toggleStylesOnClick(e,!0),e.selected=!0,delete e.hovered,this.hoveredNode=!1))}},onMouseMove:function(e,t,i){if(this.down&&(this.move=!0),!this.dom||!this.isLabel(e,t)){var n=this.nodeStylesOnHover;if(n&&!this.dom){if(this.hoveredNode){var a=this.types[this.hoveredNode.getData("type")],o=a&&a.contains&&a.contains.call(this.fx,this.hoveredNode,i.getPos());if(o)return}var s=i.getNode();if(!this.hoveredNode&&!s)return;if(s.hovered)return;s&&!s.selected?(this.fx.nodeFxAnimation.stopTimer(),this.viz.graph.eachNode(function(e){if(e.hovered&&!e.selected){for(var t in n)e.setData(t,e.styles["$"+t],"end");delete e.hovered}}),s.hovered=!0,this.hoveredNode=s,this.toggleStylesOnHover(s,!0)):this.hoveredNode&&!this.hoveredNode.selected&&(this.fx.nodeFxAnimation.stopTimer(),this.toggleStylesOnHover(this.hoveredNode,!1),delete this.hoveredNode.hovered,this.hoveredNode=!1)}}}}),h.Classes.Navigation=new t({Implements:[o,s],initializePost:function(){this.pos=!1,this.pressed=!1},onMouseWheel:function(t,i,n){if(this.config.zooming){e.event.stop(e.event.get(t,i));var a=this.config.zooming/1e3,o=1+n*a;this.canvas.scale(o,o)}},onMouseDown:function(t,i,n){if(this.config.panning&&(t.preventDefault?t.preventDefault():t.returnValue=!1,e.addClass(this.canvas.getElement(),"grabbing"),"avoid nodes"!=this.config.panning||!(this.dom?this.isLabel(t,i):n.getNode()||n.getEdge()))){this.pressed=!0,this.pos=n.getPos();var a=this.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY;this.pos.x*=r,this.pos.x+=o,this.pos.y*=h,this.pos.y+=s}},onMouseMove:function(e,t,i){if(this.config.panning&&this.pressed&&("avoid nodes"!=this.config.panning||(this.dom?!this.isLabel(e,t):!i.getNode()))){var n=this.pos,a=i.getPos(),o=this.canvas,s=o.translateOffsetX,r=o.translateOffsetY,h=o.scaleOffsetX,l=o.scaleOffsetY;a.x*=h,a.y*=l,a.x+=s,a.y+=r;var c=a.x-n.x,d=a.y-n.y;this.pos=a,this.canvas.translate(1*c/h,1*d/l)}},onMouseUp:function(t,i,n,a){this.config.panning&&(e.removeClass(this.canvas.getElement(),"grabbing"),this.pressed=!1)}});var l;!function(){function i(t,i){var n=document.createElement(t);for(var o in i)"object"==typeof i[o]?e.extend(n[o],i[o]):n[o]=i[o];return"canvas"==t&&!a&&G_vmlCanvasManager&&(n=G_vmlCanvasManager.initElement(document.body.appendChild(n))),n}var n=typeof HTMLCanvasElement,a="object"==n||"function"==n;$jit.Canvas=l=new t({canvases:[],pos:!1,element:!1,labelContainer:!1,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(t,n){this.viz=t,this.opt=this.config=n;var a="string"==e.type(n.injectInto)?n.injectInto:n.injectInto.id,o=n.type,s=a+"-label",r=e(a),h=n.width||r.offsetWidth,c=n.height||r.offsetHeight;this.id=a;var d={injectInto:a,width:h,height:c};this.element=i("div",{id:a+"-canvaswidget",style:{position:"relative",width:h+"px",height:c+"px"}}),this.labelContainer=this.createLabelContainer(n.Label.type,s,d),this.canvases.push(new l.Base[o]({config:e.extend({idSuffix:"-canvas"},d),plot:function(e){t.fx.plot()},resize:function(){t.refresh()}}));var f=n.background;if(f){var u=new l.Background[f.type](t,e.extend(f,d));this.canvases.push(new l.Base[o](u))}for(var g=this.canvases.length;g--;)this.element.appendChild(this.canvases[g].canvas),g>0&&this.canvases[g].plot();this.element.appendChild(this.labelContainer),r.appendChild(this.element);var p=null,v=this;e.addEvent(window,"scroll",function(){clearTimeout(p),p=setTimeout(function(){v.getPos(!0)},500)})},getCtx:function(e){return this.canvases[e||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(e){return this.canvases[e||0].getSize()},resize:function(e,t){this.getPos(!0),this.translateOffsetX=this.translateOffsetY=0,this.scaleOffsetX=this.scaleOffsetY=1;for(var i=0,n=this.canvases.length;n>i;i++)this.canvases[i].resize(e,t);var a=this.element.style;a.width=e+"px",a.height=t+"px",this.labelContainer&&(this.labelContainer.style.width=e+"px")},translate:function(e,t,i){this.translateOffsetX+=e*this.scaleOffsetX,this.translateOffsetY+=t*this.scaleOffsetY;for(var n=0,a=this.canvases.length;a>n;n++)this.canvases[n].translate(e,t,i)},scale:function(e,t,i){var n=this.scaleOffsetX*e,a=this.scaleOffsetY*t,o=this.translateOffsetX*(e-1)/n,s=this.translateOffsetY*(t-1)/a;this.scaleOffsetX=n,this.scaleOffsetY=a;for(var r=0,h=this.canvases.length;h>r;r++)this.canvases[r].scale(e,t,!0);this.translate(o,s,!1)},getZoom:function(){return new u(this.scaleOffsetX,this.scaleOffsetY)},setZoom:function(e,t,i){var n=this.getZoom(),a=e/n.x,o=t/n.y;this.scale(a,o,i)},getPos:function(t){return t||!this.pos?this.pos=e.getPos(this.getElement()):this.pos},clear:function(e){this.canvases[e||0].clear()},path:function(e,t){var i=this.canvases[0].getCtx();i.beginPath(),t(i),i[e](),i.closePath()},createLabelContainer:function(e,t,n){var a="http://www.w3.org/2000/svg";if("HTML"==e||"Native"==e)return i("div",{id:t,style:{overflow:"visible",position:"absolute",top:0,left:0,width:n.width+"px",height:0}});if("SVG"==e){var o=document.createElementNS(a,"svg:svg");o.setAttribute("width",n.width),o.setAttribute("height",n.height);var s=o.style;s.position="absolute",s.left=s.top="0px";var r=document.createElementNS(a,"svg:g");return r.setAttribute("width",n.width),r.setAttribute("height",n.height),r.setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("id",t),o.appendChild(r),o}}}),l.Base={},l.Base["2D"]=new t({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(e){this.viz=e,this.opt=e.config,this.size=!1,this.createCanvas(),this.translateToCenter()},createCanvas:function(){var e=this.opt,t=e.width,n=e.height;this.canvas=i("canvas",{id:e.injectInto+e.idSuffix,width:t,height:n,style:{position:"absolute",top:0,left:0,width:t+"px",height:n+"px"}})},getCtx:function(){return this.ctx?this.ctx:this.ctx=this.canvas.getContext("2d")},getSize:function(){if(this.size)return this.size;var e=this.canvas;return this.size={width:e.width,height:e.height}},translateToCenter:function(e){var t=this.getSize(),i=e?t.width-e.width-2*this.translateOffsetX:t.width;height=e?t.height-e.height-2*this.translateOffsetY:t.height;var n=this.getCtx();e&&n.scale(1/this.scaleOffsetX,1/this.scaleOffsetY),n.translate(i/2,height/2)},resize:function(e,t){var i=this.getSize(),n=this.canvas,o=n.style;this.size=!1,n.width=e,n.height=t,o.width=e+"px",o.height=t+"px",a?this.translateToCenter():this.translateToCenter(i),this.translateOffsetX=this.translateOffsetY=0,this.scaleOffsetX=this.scaleOffsetY=1,this.clear(),this.viz.resize(e,t,this)},translate:function(e,t,i){var n=this.scaleOffsetX,a=this.scaleOffsetY;this.translateOffsetX+=e*n,this.translateOffsetY+=t*a,this.getCtx().translate(e,t),!i&&this.plot()},scale:function(e,t,i){this.scaleOffsetX*=e,this.scaleOffsetY*=t,this.getCtx().scale(e,t),!i&&this.plot()},clear:function(){var e=this.getSize(),t=this.translateOffsetX,i=this.translateOffsetY,n=this.scaleOffsetX,a=this.scaleOffsetY;this.getCtx().clearRect(1*(-e.width/2-t)/n,1*(-e.height/2-i)/a,1*e.width/n,1*e.height/a)},plot:function(){this.clear(),this.viz.plot(this)}}),l.Background={},l.Background.Circles=new t({initialize:function(t,i){this.viz=t,this.config=e.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},i)},resize:function(e,t,i){this.plot(i)},plot:function(e){var t=(e.canvas,e.getCtx()),i=this.config,n=i.CanvasStyles;for(var a in n)t[a]=n[a];for(var o=i.numberOfCircles,s=i.levelDistance,r=1;o>=r;r++)t.beginPath(),t.arc(0,0,s*r,0,2*Math.PI,!1),t.stroke(),t.closePath()}})}();var d=function(e,t){this.theta=e||0,this.rho=t||0};$jit.Polar=d,d.prototype={getc:function(e){return this.toComplex(e)},getp:function(){return this},set:function(e){e=e.getp(),this.theta=e.theta,this.rho=e.rho},setc:function(e,t){this.rho=Math.sqrt(e*e+t*t),this.theta=Math.atan2(t,e),this.theta<0&&(this.theta+=2*Math.PI)},setp:function(e,t){this.theta=e,this.rho=t},clone:function(){return new d(this.theta,this.rho)},toComplex:function(e){var t=Math.cos(this.theta)*this.rho,i=Math.sin(this.theta)*this.rho;return e?{x:t,y:i}:new u(t,i)},add:function(e){return new d(this.theta+e.theta,this.rho+e.rho)},scale:function(e){return new d(this.theta,this.rho*e)},equals:function(e){return this.theta==e.theta&&this.rho==e.rho},$add:function(e){return this.theta=this.theta+e.theta,this.rho+=e.rho,this},$madd:function(e){return this.theta=(this.theta+e.theta)%(2*Math.PI),this.rho+=e.rho,this},$scale:function(e){return this.rho*=e,this},isZero:function(){var e=1e-4,t=Math.abs;return t(this.theta)<e&&t(this.rho)<e},interpolate:function(e,t){var i,n=Math.PI,a=2*n,o=function(e){var t=0>e?e%a+a:e%a;return t},s=this.theta,r=e.theta,h=Math.abs(s-r);i=o(h==n?s>r?r+(s-a-r)*t:r-a+(s-r)*t:h>=n?s>r?r+(s-a-r)*t:r-a+(s-(r-a))*t:r+(s-r)*t);var l=(this.rho-e.rho)*t+e.rho;return{theta:i,rho:l}}};var f=function(e,t){return new d(e,t)};d.KER=f(0,0);var u=function(e,t){this.x=e||0,this.y=t||0};$jit.Complex=u,u.prototype={getc:function(){return this},getp:function(e){return this.toPolar(e)},set:function(e){e=e.getc(!0),this.x=e.x,this.y=e.y},setc:function(e,t){this.x=e,this.y=t},setp:function(e,t){this.x=Math.cos(e)*t,this.y=Math.sin(e)*t},clone:function(){return new u(this.x,this.y)},toPolar:function(e){var t=this.norm(),i=Math.atan2(this.y,this.x);return 0>i&&(i+=2*Math.PI),e?{theta:i,rho:t}:new d(i,t)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(e){return new u(this.x+e.x,this.y+e.y)},prod:function(e){return new u(this.x*e.x-this.y*e.y,this.y*e.x+this.x*e.y)},conjugate:function(){return new u(this.x,-this.y)},scale:function(e){return new u(this.x*e,this.y*e)},equals:function(e){return this.x==e.x&&this.y==e.y},$add:function(e){return this.x+=e.x,this.y+=e.y,this},$prod:function(e){var t=this.x,i=this.y;return this.x=t*e.x-i*e.y,this.y=i*e.x+t*e.y,this},$conjugate:function(){return this.y=-this.y,this},$scale:function(e){return this.x*=e,this.y*=e,this},$div:function(e){var t=this.x,i=this.y,n=e.squaredNorm();return this.x=t*e.x+i*e.y,this.y=i*e.x-t*e.y,this.$scale(1/n)},isZero:function(){var e=1e-4,t=Math.abs;return t(this.x)<e&&t(this.y)<e}};var g=function(e,t){return new u(e,t)};u.KER=g(0,0),u.IM=g(0,1),$jit.Graph=new t({initialize:function(t,i,n,a){var o={klass:u,Node:{}};this.Node=i,this.Edge=n,this.Label=a,this.opt=e.merge(o,t||{}),this.nodes={},this.edges={};var s=this;this.nodeList={};for(var r in p)s.nodeList[r]=function(e){return function(){var t=Array.prototype.slice.call(arguments);s.eachNode(function(i){i[e].apply(i,t)})}}(r)},getNode:function(e){return this.hasNode(e)?this.nodes[e]:!1},get:function(e){return this.getNode(e)},getByName:function(e){for(var t in this.nodes){var i=this.nodes[t];if(i.name==e)return i}return!1},getAdjacence:function(e,t){return e in this.edges?this.edges[e][t]:!1},addNode:function(t){if(!this.nodes[t.id]){var i=this.edges[t.id]={};this.nodes[t.id]=new v.Node(e.extend({id:t.id,name:t.name,data:e.merge(t.data||{},{}),adjacencies:i},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[t.id]},addAdjacence:function(e,t,i){if(this.hasNode(e.id)||this.addNode(e),this.hasNode(t.id)||this.addNode(t),e=this.nodes[e.id],t=this.nodes[t.id],!e.adjacentTo(t)){var n=this.edges[e.id]=this.edges[e.id]||{},a=this.edges[t.id]=this.edges[t.id]||{};return n[t.id]=a[e.id]=new v.Adjacence(e,t,i,this.Edge,this.Label),n[t.id]}return this.edges[e.id][t.id]},removeNode:function(e){if(this.hasNode(e)){delete this.nodes[e];var t=this.edges[e];for(var i in t)delete this.edges[i][e];delete this.edges[e]}},removeAdjacence:function(e,t){delete this.edges[e][t],delete this.edges[t][e]},hasNode:function(e){return e in this.nodes},empty:function(){this.nodes={},this.edges={}}});var p,v=$jit.Graph;!function(){var t=function(e,t,i,n,a){var o;i=i||"current",e="$"+(e?e+"-":""),"current"==i?o=this.data:"start"==i?o=this.startData:"end"==i&&(o=this.endData);var s=e+t;return n?o[s]:this.Config.overridable?s in o?o[s]:s in this.data?this.data[s]:a[t]||0:a[t]||0},i=function(e,t,i,n){n=n||"current",e="$"+(e?e+"-":"");var a;"current"==n?a=this.data:"start"==n?a=this.startData:"end"==n&&(a=this.endData),a[e+t]=i},n=function(t,i){t="$"+(t?t+"-":"");var n=this;e.each(i,function(e){var i=t+e;
delete n.data[i],delete n.endData[i],delete n.startData[i]})};p={getData:function(e,i,n){return t.call(this,"",e,i,n,this.Config)},setData:function(e,t,n){i.call(this,"",e,t,n)},setDataset:function(t,i){t=e.splat(t);for(var n in i)for(var a=0,o=e.splat(i[n]),s=t.length;s>a;a++)this.setData(n,o[a],t[a])},removeData:function(){n.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(e,i,n){return t.call(this,"canvas",e,i,n,this.Config.CanvasStyles)},setCanvasStyle:function(e,t,n){i.call(this,"canvas",e,t,n)},setCanvasStyles:function(t,i){t=e.splat(t);for(var n in i)for(var a=0,o=e.splat(i[n]),s=t.length;s>a;a++)this.setCanvasStyle(n,o[a],t[a])},removeCanvasStyle:function(){n.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(e,i,n){return t.call(this,"label",e,i,n,this.Label)},setLabelData:function(e,t,n){i.call(this,"label",e,t,n)},setLabelDataset:function(t,i){t=e.splat(t);for(var n in i)for(var a=0,o=e.splat(i[n]),s=t.length;s>a;a++)this.setLabelData(n,o[a],t[a])},removeLabelData:function(){n.call(this,"label",Array.prototype.slice.call(arguments))}}}(),v.Node=new t({initialize:function(t,i,n,a,o){var s={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:!1,drawn:!1,exist:!1,angleSpan:{begin:0,end:0},pos:new i,startPos:new i,endPos:new i};e.extend(this,e.extend(s,t)),this.Config=this.Node=n,this.Edge=a,this.Label=o},adjacentTo:function(e){return e.id in this.adjacencies},adjacentWithDirectionTo:function(e){var t=e.id in this.adjacencies;if(!t)return!1;var i=this.adjacencies[e.id].data.$direction;return i[0]===this.id},getAdjacency:function(e){return this.adjacencies[e]},getPos:function(e){return e=e||"current","current"==e?this.pos:"end"==e?this.endPos:"start"==e?this.startPos:void 0},setPos:function(e,t){t=t||"current";var i;"current"==t?i=this.pos:"end"==t?i=this.endPos:"start"==t&&(i=this.startPos),i.set(e)}}),v.Node.implement(p),v.Adjacence=new t({initialize:function(e,t,i,n,a){this.nodeFrom=e,this.nodeTo=t,this.data=i||{},this.startData={},this.endData={},this.Config=this.Edge=n,this.Label=a}}),v.Adjacence.implement(p),v.Util={filter:function(t){if(!t||"string"!=e.type(t))return function(){return!0};var i=t.split(" ");return function(e){for(var t=0;t<i.length;t++)if(e[i[t]])return!1;return!0}},getNode:function(e,t){return e.nodes[t]},eachNode:function(e,t,i){var n=this.filter(i);for(var a in e.nodes)n(e.nodes[a])&&t(e.nodes[a])},each:function(e,t,i){this.eachNode(e,t,i)},eachAdjacency:function(e,t,i){var n=e.adjacencies,a=this.filter(i);for(var o in n){var s=n[o];if(a(s)){if(s.nodeFrom!=e){var r=s.nodeFrom;s.nodeFrom=s.nodeTo,s.nodeTo=r}t(s,o)}}},computeLevels:function(e,t,i,n){i=i||0;var a=this.filter(n);this.eachNode(e,function(e){e._flag=!1,e._depth=-1},n);var o=e.getNode(t);o._depth=i;for(var s=[o];0!=s.length;){var r=s.pop();r._flag=!0,this.eachAdjacency(r,function(e){var t=e.nodeTo;0==t._flag&&a(t)&&!e._hiding&&(t._depth<0&&(t._depth=r._depth+1+i),s.unshift(t))},n)}},eachBFS:function(e,t,i,n){var a=this.filter(n);this.clean(e);for(var o=[e.getNode(t)];0!=o.length;){var s=o.pop();if(!s)return;s._flag=!0,i(s,s._depth),this.eachAdjacency(s,function(e){var t=e.nodeTo;0==t._flag&&a(t)&&!e._hiding&&(t._flag=!0,o.unshift(t))},n)}},eachLevel:function(e,t,i,n,a){var o=e._depth,s=this.filter(a),r=this,h=!0;i=i===!1?Number.MAX_VALUE-o:i,function l(e,t,i){if(h){var a,o=e._depth;o>=t&&i>=o&&s(e)&&(a=n(e,o)),"undefined"!=typeof a&&(h=a),h&&i>o&&r.eachAdjacency(e,function(e){var n=e.nodeTo;n._depth>o&&l(n,t,i)})}}(e,t+o,i+o)},eachSubgraph:function(e,t,i){this.eachLevel(e,0,!1,t,i)},eachSubnode:function(e,t,i){this.eachLevel(e,1,1,t,i)},anySubnode:function(t,i,n){var a=!1;i=i||e.lambda(!0);var o="string"==e.type(i)?function(e){return e[i]}:i;return this.eachSubnode(t,function(e){o(e)&&(a=!0)},n),a},getSubnodes:function(t,i,n){var a=[];i=i||0;var o,s;return"array"==e.type(i)?(o=i[0],s=i[1]):(o=i,s=Number.MAX_VALUE-t._depth),this.eachLevel(t,o,s,function(e){a.push(e)},n),a},getParents:function(e){var t=[];return this.eachAdjacency(e,function(i){var n=i.nodeTo;n._depth<e._depth&&t.push(n)}),t},isDescendantOf:function(e,t){if(e.id==t)return!0;for(var i=this.getParents(e),n=!1,a=0;!n&&a<i.length;a++)n=n||this.isDescendantOf(i[a],t);return n},clean:function(e){this.eachNode(e,function(e){e._flag=!1})},getClosestNodeToOrigin:function(e,t,i){return this.getClosestNodeToPos(e,d.KER,t,i)},getClosestNodeToPos:function(e,t,i,n){var a=null;i=i||"current",t=t&&t.getc(!0)||u.KER;var o=function(e,t){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n};return this.eachNode(e,function(e){a=null==a||o(e.getPos(i).getc(!0),t)<o(a.getPos(i).getc(!0),t)?e:a},n),a}},e.each(["get","getNode","each","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(e){v.prototype[e]=function(){return v.Util[e].apply(v.Util,[this].concat(Array.prototype.slice.call(arguments)))}}),e.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(e){v.Node.prototype[e]=function(){return v.Util[e].apply(v.Util,[this].concat(Array.prototype.slice.call(arguments)))}}),v.Op={options:{type:"nothing",duration:2e3,hideLabels:!0,fps:30},initialize:function(e){this.viz=e},removeNode:function(t,i){var n,a,o,s=this.viz,r=e.merge(this.options,s.controller,i),h=e.splat(t);switch(r.type){case"nothing":for(n=0;n<h.length;n++)r.onBeforeRemoveNode(s.graph.getNode(h[n])),s.graph.removeNode(h[n]);break;case"replot":this.removeNode(h,{type:"nothing"}),s.labels.clearLabels(),s.refresh(!0);break;case"fade:seq":case"fade":for(a=this,n=0;n<h.length;n++)o=s.graph.getNode(h[n]),o.setData("alpha",0,"end");s.fx.animate(e.merge(r,{modes:["node-property:alpha"],onComplete:function(){a.removeNode(h,{type:"nothing"}),s.labels.clearLabels(),s.reposition(),s.fx.animate(e.merge(r,{modes:["linear"]}))}}));break;case"fade:con":for(a=this,n=0;n<h.length;n++)o=s.graph.getNode(h[n]),o.setData("alpha",0,"end"),o.ignore=!0;s.reposition(),s.fx.animate(e.merge(r,{modes:["node-property:alpha","linear"],onComplete:function(){a.removeNode(h,{type:"nothing"}),r.onComplete&&r.onComplete()}}));break;case"iter":a=this,s.fx.sequence({condition:function(){return 0!=h.length},step:function(){a.removeNode(h.shift(),{type:"nothing"}),s.labels.clearLabels()},onComplete:function(){r.onComplete&&r.onComplete()},duration:Math.ceil(r.duration/h.length)});break;default:this.doError()}},removeEdge:function(t,i){var n,a,o,s=this.viz,r=e.merge(this.options,s.controller,i),h="string"==e.type(t[0])?[t]:t;switch(r.type){case"nothing":for(n=0;n<h.length;n++)s.graph.removeAdjacence(h[n][0],h[n][1]);break;case"replot":this.removeEdge(h,{type:"nothing"}),s.refresh(!0);break;case"fade:seq":case"fade":for(a=this,n=0;n<h.length;n++)o=s.graph.getAdjacence(h[n][0],h[n][1]),o&&o.setData("alpha",0,"end");s.fx.animate(e.merge(r,{modes:["edge-property:alpha"],onComplete:function(){a.removeEdge(h,{type:"nothing"}),s.reposition(),s.fx.animate(e.merge(r,{modes:["linear"]}))}}));break;case"fade:con":for(a=this,n=0;n<h.length;n++)o=s.graph.getAdjacence(h[n][0],h[n][1]),o&&(o.setData("alpha",0,"end"),o.ignore=!0);s.reposition(),s.fx.animate(e.merge(r,{modes:["edge-property:alpha","linear"],onComplete:function(){a.removeEdge(h,{type:"nothing"}),r.onComplete&&r.onComplete()}}));break;case"iter":a=this,s.fx.sequence({condition:function(){return 0!=h.length},step:function(){a.removeEdge(h.shift(),{type:"nothing"}),s.labels.clearLabels()},onComplete:function(){r.onComplete()},duration:Math.ceil(r.duration/h.length)});break;default:this.doError()}},sum:function(t,i){var n,a=this.viz,o=e.merge(this.options,a.controller,i),s=a.root;switch(a.root=i.id||a.root,o.type){case"nothing":n=a.construct(t),n.eachNode(function(e){e.eachAdjacency(function(e){a.graph.addAdjacence(e.nodeFrom,e.nodeTo,e.data)})});break;case"replot":a.refresh(!0),this.sum(t,{type:"nothing"}),a.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":that=this,n=a.construct(t);var r=this.preprocessSum(n),h=r?["node-property:alpha","edge-property:alpha"]:["node-property:alpha"];a.reposition(),"fade:con"!=o.type?a.fx.animate(e.merge(o,{modes:["linear"],onComplete:function(){a.fx.animate(e.merge(o,{modes:h,onComplete:function(){o.onComplete()}}))}})):(a.graph.eachNode(function(e){e.id!=s&&e.pos.isZero()&&(e.pos.set(e.endPos),e.startPos.set(e.endPos))}),a.fx.animate(e.merge(o,{modes:["linear"].concat(h)})));break;default:this.doError()}},morph:function(t,i,n){n=n||{};var a,o=this.viz,s=e.merge(this.options,o.controller,i),r=o.root;switch(o.root=i.id||o.root,s.type){case"nothing":a=o.construct(t),a.eachNode(function(e){var t=o.graph.hasNode(e.id);if(e.eachAdjacency(function(e){var t=!!o.graph.getAdjacence(e.nodeFrom.id,e.nodeTo.id);if(o.graph.addAdjacence(e.nodeFrom,e.nodeTo,e.data),t){var i=o.graph.getAdjacence(e.nodeFrom.id,e.nodeTo.id);for(var n in e.data||{})i.data[n]=e.data[n]}}),t){var i=o.graph.getNode(e.id);for(var n in e.data||{})i.data[n]=e.data[n]}}),o.graph.eachNode(function(e){e.eachAdjacency(function(e){a.getAdjacence(e.nodeFrom.id,e.nodeTo.id)||o.graph.removeAdjacence(e.nodeFrom.id,e.nodeTo.id)}),a.hasNode(e.id)||o.graph.removeNode(e.id)});break;case"replot":o.labels.clearLabels(!0),this.morph(t,{type:"nothing"}),o.refresh(!0),o.refresh(!0);break;case"fade:seq":case"fade":case"fade:con":that=this,a=o.construct(t);var h="node-property"in n&&e.map(e.splat(n["node-property"]),function(e){return"$"+e});o.graph.eachNode(function(t){var i=a.getNode(t.id);if(i){var n=i.data;for(var o in n)h&&e.indexOf(h,o)>-1?t.endData[o]=n[o]:t.data[o]=n[o]}else t.setData("alpha",1),t.setData("alpha",1,"start"),t.setData("alpha",0,"end"),t.ignore=!0}),o.graph.eachNode(function(e){e.ignore||e.eachAdjacency(function(e){if(!e.nodeFrom.ignore&&!e.nodeTo.ignore){var t=a.getNode(e.nodeFrom.id),i=a.getNode(e.nodeTo.id);if(t.adjacentTo(i))e.data.$direction&&e.data.$direction[0]===t.id&&(t.adjacentWithDirectionTo(i)||(e._reversing=!0));else{var e=o.graph.getAdjacence(t.id,i.id);l=!0,e.setData("alpha",1),e.setData("alpha",1,"start"),e.setData("alpha",0,"end"),e._hiding=!0}}})});var l=this.preprocessSum(a),c=l?["node-property:alpha","edge-property:alpha"]:["node-property:alpha"];c[0]=c[0]+("node-property"in n?":"+e.splat(n["node-property"]).join(":"):""),c[1]=(c[1]||"edge-property:alpha")+("edge-property"in n?":"+e.splat(n["edge-property"]).join(":"):""),"label-property"in n&&c.push("label-property:"+e.splat(n["label-property"]).join(":")),o.reposition?o.reposition():o.compute("end"),this._updateDirectedEdges(),o.graph.eachNode(function(e){e.id!=r&&e.pos.getp().equals(d.KER)&&(e.pos.set(e.endPos),e.startPos.set(e.endPos))}),o.fx.animate(e.merge(s,{modes:[n.position||"polar"].concat(c),onComplete:function(){o.graph.eachNode(function(e){e.ignore&&o.graph.removeNode(e.id)}),o.graph.eachNode(function(e){e.eachAdjacency(function(e){e.ignore&&o.graph.removeAdjacence(e.nodeFrom.id,e.nodeTo.id)})}),s.onComplete()}}))}},_updateDirectedEdges:function(){var e=this.viz.graph;e.eachNode(function(t){t.eachAdjacency(function(t){var i=t.data.$direction;if((!i||t.nodeFrom.id===t.data.$direction[0])&&(t._hiding&&e.removeAdjacence(t.nodeFrom.id,t.nodeTo.id),t._reversing)){var n=t.nodeFrom.id,a=t.nodeTo.id,o=e.edges[n][a],s=e.edges[a][n];o.data.$direction=[a,n],s.data.$direction=[a,n],t._reversing=void 0}})})},contract:function(t,i){var n=this.viz;!t.collapsed&&t.anySubnode(e.lambda(!0))&&(i=e.merge(this.options,n.config,i||{},{modes:["node-property:alpha:span","linear"]}),t.collapsed=!0,function a(e){e.eachSubnode(function(e){e.ignore=!0,e.setData("alpha",0,"animate"==i.type?"end":"current"),a(e)})}(t),"animate"==i.type?(n.compute("end"),n.rotated&&n.rotate(n.rotated,"none",{property:"end"}),function o(e){e.eachSubnode(function(e){e.setPos(t.getPos("end"),"end"),o(e)})}(t),n.fx.animate(i)):"replot"==i.type&&n.refresh())},expand:function(t,i){if("collapsed"in t){var n=this.viz;i=e.merge(this.options,n.config,i||{},{modes:["node-property:alpha:span","linear"]}),delete t.collapsed,function a(e){e.eachSubnode(function(e){delete e.ignore,e.setData("alpha",1,"animate"==i.type?"end":"current"),a(e)})}(t),"animate"==i.type?(n.compute("end"),n.rotated&&n.rotate(n.rotated,"none",{property:"end"}),n.fx.animate(i)):"replot"==i.type&&n.refresh()}},preprocessSum:function(e){var t=this.viz;e.eachNode(function(e){if(!t.graph.hasNode(e.id)){t.graph.addNode(e);var i=t.graph.getNode(e.id);i.setData("alpha",0),i.setData("alpha",0,"start"),i.setData("alpha",1,"end")}});var i=!1;return e.eachNode(function(e){e.eachAdjacency(function(e){var n=t.graph.getNode(e.nodeFrom.id),a=t.graph.getNode(e.nodeTo.id);if(!n.adjacentTo(a)){var e=t.graph.addAdjacence(n,a,e.data);n.startAlpha==n.endAlpha&&a.startAlpha==a.endAlpha&&(i=!0,e.setData("alpha",0),e.setData("alpha",0,"start"),e.setData("alpha",1,"end"))}})}),i}};var m={none:{render:e.empty,contains:e.lambda(!1)},circle:{render:function(e,t,i,n){var a=n.getCtx();a.beginPath(),a.arc(t.x,t.y,i,0,2*Math.PI,!0),a.closePath(),a[e]()},contains:function(e,t,i){var n=e.x-t.x,a=e.y-t.y,o=n*n+a*a;return i*i>=o}},ellipse:{render:function(e,t,i,n,a){var o=a.getCtx(),s=1,r=1,h=1,l=1,c=0;i>n?(c=i/2,r=n/i,l=i/n):(c=n/2,s=i/n,h=n/i),o.save(),o.scale(s,r),o.beginPath(),o.arc(t.x*h,t.y*l,c,0,2*Math.PI,!0),o.closePath(),o[e](),o.restore()},contains:function(e,t,i,n){var a=0,o=1,s=1,r=0,h=0,l=0;return i>n?(a=i/2,s=n/i):(a=n/2,o=i/n),r=(e.x-t.x)*(1/o),h=(e.y-t.y)*(1/s),l=r*r+h*h,a*a>=l}},square:{render:function(e,t,i,n){n.getCtx()[e+"Rect"](t.x-i,t.y-i,2*i,2*i)},contains:function(e,t,i){return Math.abs(t.x-e.x)<=i&&Math.abs(t.y-e.y)<=i}},rectangle:{render:function(e,t,i,n,a){a.getCtx()[e+"Rect"](t.x-i/2,t.y-n/2,i,n)},contains:function(e,t,i,n){return Math.abs(t.x-e.x)<=i/2&&Math.abs(t.y-e.y)<=n/2}},triangle:{render:function(e,t,i,n){var a=n.getCtx(),o=t.x,s=t.y-i,r=o-i,h=t.y+i,l=o+i,c=h;a.beginPath(),a.moveTo(o,s),a.lineTo(r,h),a.lineTo(l,c),a.closePath(),a[e]()},contains:function(e,t,i){return m.circle.contains(e,t,i)}},star:{render:function(e,t,i,n){var a=n.getCtx(),o=Math.PI/5;a.save(),a.translate(t.x,t.y),a.beginPath(),a.moveTo(i,0);for(var s=0;9>s;s++)a.rotate(o),s%2==0?a.lineTo(i/.525731*.200811,0):a.lineTo(i,0);a.closePath(),a[e](),a.restore()},contains:function(e,t,i){return m.circle.contains(e,t,i)}}},y={line:{render:function(e,t,i){var n=i.getCtx();n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.stroke()},contains:function(e,t,i,n){var a=Math.min,o=Math.max,s=a(e.x,t.x)-n,r=o(e.x,t.x)+n,h=a(e.y,t.y)-n,l=o(e.y,t.y)+n;if(i.x>=s&&i.x<=r&&i.y>=h&&i.y<=l){if(Math.abs(t.x-e.x)<=n)return!0;var c=(t.y-e.y)/(t.x-e.x)*(i.x-e.x)+e.y;return Math.abs(c-i.y)<=n}return!1}},arrow:{render:function(e,t,i,n,a,o){var s=a.getCtx();if(n){var r=e;e=t,t=r}var h=new u(t.x-e.x,t.y-e.y);h.$scale(i/h.norm());var l;switch(o){case"end":l=h;break;case"center":l=new u((t.x-e.x)/2,(t.y-e.y)/2)}var c=new u(t.x-l.x,t.y-l.y),d=new u(-h.y/2,h.x/2),f=c.add(h),g=c.add(d),p=c.$add(d.$scale(-1));s.beginPath(),s.moveTo(e.x,e.y),s.lineTo(t.x,t.y),s.stroke(),s.beginPath(),s.moveTo(g.x,g.y),s.moveTo(g.x,g.y),s.lineTo(p.x,p.y),s.lineTo(f.x,f.y),s.closePath(),s.fill()},contains:function(e,t,i,n){return y.line.contains(e,t,i,n)}},hyperline:{render:function(e,t,i,n){function a(e,t){var i=e.x*t.y-e.y*t.x,n=i,a=e.squaredNorm(),o=t.squaredNorm();if(0==i)return{x:0,y:0,ratio:-1};var s=(e.y*o-t.y*a+e.y-t.y)/i,r=(t.x*a-e.x*o+t.x-e.x)/n,h=-s/2,l=-r/2,c=(s*s+r*r)/4-1;if(0>c)return{x:0,y:0,ratio:-1};var d=Math.sqrt(c),f={x:h,y:l,ratio:d>1e3?-1:d,a:s,b:r};return f}function o(e,t){return t>e?e+Math.PI>t?!1:!0:t+Math.PI>e?!0:!1}var s=n.getCtx(),r=a(e,t);if(r.a>1e3||r.b>1e3||r.ratio<0)s.beginPath(),s.moveTo(e.x*i,e.y*i),s.lineTo(t.x*i,t.y*i),s.stroke();else{var h=Math.atan2(t.y-r.y,t.x-r.x),l=Math.atan2(e.y-r.y,e.x-r.x),o=o(h,l);s.beginPath(),s.arc(r.x*i,r.y*i,r.ratio*i,h,l,o),s.stroke()}},contains:e.lambda(!1)}};v.Plot={initialize:function(e,t){this.viz=e,this.config=e.config,this.node=e.config.Node,this.edge=e.config.Edge,this.animation=new n,this.nodeTypes=new t.Plot.NodeTypes,this.edgeTypes=new t.Plot.EdgeTypes,this.labels=e.labels},nodeHelper:m,edgeHelper:y,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number",vertices:"polygon"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(e,t,i){return e+(t-e)*i},moebius:function(e,t,i,n){var a=n.scale(-i);if(a.norm()<1){var o=a.x,s=a.y,r=e.startPos.getc().moebiusTransformation(a);e.pos.setc(r.x,r.y),a.x=o,a.y=s}},linear:function(e,t,i){var n=e.startPos.getc(!0),a=e.endPos.getc(!0);e.pos.setc(this.compute(n.x,a.x,i),this.compute(n.y,a.y,i))},polar:function(e,t,i){var n=e.startPos.getp(!0),a=e.endPos.getp(),o=a.interpolate(n,i);e.pos.setp(o.theta,o.rho)},number:function(e,t,i,n,a){var o=e[n](t,"start"),s=e[n](t,"end");e[a](t,this.compute(o,s,i))},color:function(t,i,n,a,o){var s=e.hexToRgb(t[a](i,"start")),r=e.hexToRgb(t[a](i,"end")),h=this.compute,l=e.rgbToHex([parseInt(h(s[0],r[0],n)),parseInt(h(s[1],r[1],n)),parseInt(h(s[2],r[2],n))]);t[o](i,l)},"array-number":function(e,t,i,n,a){for(var o=e[n](t,"start"),s=e[n](t,"end"),r=[],h=0,l=o.length;l>h;h++){var c=o[h],d=s[h];if(c.length){for(var f=0,u=c.length,g=[];u>f;f++)g.push(this.compute(c[f],d[f],i));r.push(g)}else r.push(this.compute(c,d,i))}e[a](t,r)},node:function(e,t,i,n,a,o){if(n=this[n],t)for(var s=t.length,r=0;s>r;r++){var h=t[r];this[n[h]](e,h,i,a,o)}else for(var h in n)this[n[h]](e,h,i,a,o)},edge:function(e,t,i,n,a,o){var s=e.adjacencies;for(var r in s)this.node(s[r],t,i,n,a,o)},"node-property":function(e,t,i){this.node(e,t,i,"map","getData","setData")},"edge-property":function(e,t,i){this.edge(e,t,i,"map","getData","setData")},"label-property":function(e,t,i){this.node(e,t,i,"label","getLabelData","setLabelData")},"node-style":function(e,t,i){this.node(e,t,i,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(e,t,i){this.edge(e,t,i,"canvas","getCanvasStyle","setCanvasStyle")},polygon:function(t,i,n,a,o){var s=t[a](i,"start"),r=t[a](i,"end"),h=[];if("undefined"==typeof s.offset)if(0===s)s=e.map(r,function(){return new $jit.Complex(0,0)}),s.offset=0;else{for(0==s.length&&s.push(new $jit.Complex(0,0));s.length<r.length;)s.push(s[0]);for(;s.length>r.length;)r.push(r[0]||new $jit.Complex(0,0));if(0==s.length)return;for(var l=s.length,c=1e300,d=0;l>d;d++){for(var f=0,u=0;l>u;u++)f+=Geometry.dist2(s[(d+u)%l],r[u]);c>f&&(s.offset=d,c=f)}}for(var u=0,l=s.length;l>u;u++){var g=s[(u+s.offset)%l],p=r[u];h.push(new $jit.Complex(this.compute(g.x,p.x,n),this.compute(g.y,p.y,n)))}t[o](i,h)}},sequence:function(t){var i=this;t=e.merge({condition:e.lambda(!1),step:e.empty,onComplete:e.empty,duration:200},t||{});var n=setInterval(function(){t.condition()?t.step():(clearInterval(n),t.onComplete()),i.viz.refresh(!0)},t.duration)},prepare:function(t){var i=this.viz.graph,n={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},a={};if("array"==e.type(t))for(var o=0,s=t.length;s>o;o++){var r=t[o].split(":");a[r.shift()]=r}else for(var h in t)"position"==h?a[t.position]=[]:a[h]=e.splat(t[h]);return i.eachNode(function(t){t.startPos.set(t.pos),e.each(["node-property","node-style"],function(e){if(e in a)for(var i=a[e],o=0,s=i.length;s>o;o++)t[n[e].setter](i[o],t[n[e].getter](i[o]),"start")}),e.each(["edge-property","edge-style"],function(e){if(e in a){var i=a[e];t.eachAdjacency(function(t){for(var a=0,o=i.length;o>a;a++)t[n[e].setter](i[a],t[n[e].getter](i[a]),"start")})}})}),a},animate:function(t,i){t=e.merge(this.viz.config,t||{});var n=this,a=this.viz,o=a.graph,s=this.Interpolator,r="nodefx"===t.type?this.nodeFxAnimation:this.animation,h=this.prepare(t.modes);t.hideLabels&&this.labels.hideLabels(!0),r.setOptions(e.extend(t,{$animating:!1,compute:function(e){o.eachNode(function(t){for(var n in h)s[n](t,h[n],e,i)}),n.plot(t,this.$animating,e),this.$animating=!0},complete:function(){t.hideLabels&&n.labels.hideLabels(!1),n.plot(t),t.onComplete()}})).start()},nodeFx:function(t){void 0==this.nodeFxAnimation&&(this.nodeFxAnimation=new n);var i=this.viz,a=i.graph,o=this.nodeFxAnimation,s=e.merge(this.viz.config,{elements:{id:!1,properties:{}},reposition:!1});t=e.merge(s,t||{},{onBeforeCompute:e.empty,onAfterCompute:e.empty}),o.stopTimer();var r=t.elements.properties;if(t.elements.id){var h=e.splat(t.elements.id);e.each(h,function(e){var t=a.getNode(e);if(t)for(var i in r)t.setData(i,r[i],"end")})}else a.eachNode(function(e){for(var t in r)e.setData(t,r[t],"end")});var l=[];for(var c in r)l.push(c);var d=["node-property:"+l.join(":")];t.reposition&&(d.push("linear"),i.compute("end")),this.animate(e.merge(t,{modes:d,type:"nodefx"}))},plot:function(e,t){var i=this.viz,n=i.graph,a=i.canvas,o=i.root,s=this,e=(a.getCtx(),Math.min,e||this.viz.controller);e.clearCanvas&&a.clear();var r=n.getNode(o);if(r){var h=!!r.visited;n.eachNode(function(i){var n=i.getData("alpha");i.eachAdjacency(function(n){var o=n.nodeTo;!!o.visited===h&&i.drawn&&o.drawn&&(!t&&e.onBeforePlotLine(n),s.plotLine(n,a,t),!t&&e.onAfterPlotLine(n))}),i.drawn&&(!t&&e.onBeforePlotNode(i),s.plotNode(i,a,t),!t&&e.onAfterPlotNode(i)),!s.labelsHidden&&e.withLabels&&(i.drawn&&n>=.95?s.labels.plotLabel(a,i,e):s.labels.hideLabel(i,!1)),i.visited=!h})}},plotTree:function(e,t,i){var n=this,a=this.viz,o=a.canvas,s=(this.config,o.getCtx(),e.getData("alpha"));e.eachSubnode(function(a){if(t.plotSubtree(e,a)&&a.exist&&a.drawn){var s=e.getAdjacency(a.id);!i&&t.onBeforePlotLine(s),n.plotLine(s,o,i),!i&&t.onAfterPlotLine(s),n.plotTree(a,t,i)}}),e.drawn?(!i&&t.onBeforePlotNode(e),this.plotNode(e,o,i),!i&&t.onAfterPlotNode(e),!t.hideLabels&&t.withLabels&&s>=.95?this.labels.plotLabel(o,e,t):this.labels.hideLabel(e,!1)):this.labels.hideLabel(e,!0)},plotNode:function(e,t,i){var n=e.getData("type"),a=this.node.CanvasStyles;if("none"!=n){var o=e.getData("lineWidth"),s=e.getData("color"),r=e.getData("alpha"),h=t.getCtx();h.save(),h.lineWidth=o,h.fillStyle=h.strokeStyle=s,h.globalAlpha=r;for(var l in a)h[l]=e.getCanvasStyle(l);this.nodeTypes[n].render.call(this,e,t,i),h.restore()}},plotLine:function(e,t,i){var n=e.getData("type"),a=this.edge.CanvasStyles;if("none"!=n){var o=e.getData("lineWidth"),s=e.getData("color"),r=t.getCtx(),h=e.nodeFrom,l=e.nodeTo;r.save(),r.lineWidth=o,r.fillStyle=r.strokeStyle=s,r.globalAlpha=Math.min(h.getData("alpha"),l.getData("alpha"),e.getData("alpha"));for(var c in a)r[c]=e.getCanvasStyle(c);this.edgeTypes[n].render.call(this,e,t,i),r.restore()}}},v.Plot3D=e.merge(v.Plot,{Interpolator:{linear:function(e,t,i){var n=e.startPos.getc(!0),a=e.endPos.getc(!0);e.pos.setc(this.compute(n.x,a.x,i),this.compute(n.y,a.y,i),this.compute(n.z,a.z,i))}},plotNode:function(e,t){"none"!=e.getData("type")&&this.plotElement(e,t,{getAlpha:function(){return e.getData("alpha")}})},plotLine:function(e,t){"none"!=e.getData("type")&&this.plotElement(e,t,{getAlpha:function(){return Math.min(e.nodeFrom.getData("alpha"),e.nodeTo.getData("alpha"),e.getData("alpha"))}})},plotElement:function(t,i,n){var a=i.getCtx(),o=new Matrix4,s=i.config.Scene.Lighting,r=i.canvases[0],h=r.program,l=r.camera;if(t.geometry||(t.geometry=new(O3D[t.getData("type")])),t.geometry.update(t),!t.webGLVertexBuffer){for(var c=[],d=[],f=[],u=0,g=t.geometry,p=0,v=g.vertices,m=g.faces,y=m.length;y>p;p++){var b=m[p],x=v[b.a],w=v[b.b],D=v[b.c],N=b.d?v[b.d]:!1,C=b.normal;c.push(x.x,x.y,x.z),c.push(w.x,w.y,w.z),c.push(D.x,D.y,D.z),N&&c.push(N.x,N.y,N.z),f.push(C.x,C.y,C.z),f.push(C.x,C.y,C.z),f.push(C.x,C.y,C.z),N&&f.push(C.x,C.y,C.z),d.push(u,u+1,u+2),N?(d.push(u,u+2,u+3),u+=4):u+=3}t.webGLVertexBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,t.webGLVertexBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW),t.webGLFaceBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t.webGLFaceBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),a.STATIC_DRAW),t.webGLFaceCount=d.length,t.webGLNormalBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,t.webGLNormalBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(f),a.STATIC_DRAW)}o.multiply(l.matrix,t.geometry.matrix),a.uniformMatrix4fv(h.viewMatrix,!1,o.flatten()),a.uniformMatrix4fv(h.projectionMatrix,!1,l.projectionMatrix.flatten());var L=Matrix4.makeInvert(o);L.$transpose(),a.uniformMatrix4fv(h.normalMatrix,!1,L.flatten());var T=e.hexToRgb(t.getData("color"));if(T.push(n.getAlpha()),a.uniform4f(h.color,T[0]/255,T[1]/255,T[2]/255,T[3]),a.uniform1i(h.enableLighting,s.enable),s.enable){if(s.ambient){var A=s.ambient;a.uniform3f(h.ambientColor,A[0],A[1],A[2])}if(s.directional){var S=s.directional,T=S.color,M=S.direction,z=new Vector3(M.x,M.y,M.z).normalize().$scale(-1);a.uniform3f(h.lightingDirection,z.x,z.y,z.z),a.uniform3f(h.directionalColor,T[0],T[1],T[2])}}a.bindBuffer(a.ARRAY_BUFFER,t.webGLVertexBuffer),a.vertexAttribPointer(h.position,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,t.webGLNormalBuffer),a.vertexAttribPointer(h.normal,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t.webGLFaceBuffer),a.drawElements(a.TRIANGLES,t.webGLFaceCount,a.UNSIGNED_SHORT,0)}}),v.Label={},v.Label.Native=new t({initialize:function(e){this.viz=e},plotLabel:function(e,t,i){var n=e.getCtx();t.pos.getc(!0);n.font=t.getLabelData("style")+" "+t.getLabelData("size")+"px "+t.getLabelData("family"),n.textAlign=t.getLabelData("textAlign"),n.fillStyle=n.strokeStyle=t.getLabelData("color"),n.textBaseline=t.getLabelData("textBaseline"),this.renderLabel(e,t,i)},renderLabel:function(e,t,i){var n=e.getCtx(),a=t.pos.getc(!0);n.fillText(t.name,a.x,a.y+t.getData("height")/2)},hideLabel:function(t,i){t=e.splat(t);var n=i?!1:!0;e.each(t,function(e){e._hideLabel=n})},hideLabels:e.empty}),v.Label.DOM=new t({labelsHidden:!1,labelContainer:!1,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(e){return e in this.labels&&null!=this.labels[e]?this.labels[e]:this.labels[e]=document.getElementById(e)},hideLabels:function(e){var t=this.getLabelContainer();e?t.style.display="none":t.style.display="",this.labelsHidden=e},clearLabels:function(e){for(var t in this.labels)(e||!this.viz.graph.hasNode(t))&&(this.disposeLabel(t),delete this.labels[t])},disposeLabel:function(e){var t=this.getLabel(e);t&&t.parentNode&&t.parentNode.removeChild(t)},hideLabel:function(t,i){t=e.splat(t);var n,a=i?"":"none",o=this;e.each(t,function(e){n=o.getLabel(e.id),n&&(n.style.display=a)})},fitsInCanvas:function(e,t){var i=t.getSize();if(e.w&&e.h){if(e.x>=i.width||e.x<-e.w||e.y>=i.height||e.y<-e.h)return!1}else if(e.x>=i.width||e.x<0||e.y>=i.height||e.y<0)return!1;return!0}}),v.Label.HTML=new t({Implements:v.Label.DOM,plotLabel:function(e,t,i){var n=t.id,a=this.getLabel(n);if(!a&&!(a=document.getElementById(n))){a=document.createElement("div");var o=this.getLabelContainer();a.id=n,a.className="node",a.style.position="absolute",i.onCreateLabel(a,t),o.appendChild(a),this.labels[t.id]=a}this.placeLabel(a,t,i)}}),v.Label.SVG=new t({Implements:v.Label.DOM,plotLabel:function(e,t,i){var n=t.id,a=this.getLabel(n);if(!a&&!(a=document.getElementById(n))){var o="http://www.w3.org/2000/svg";a=document.createElementNS(o,"svg:text");var s=document.createElementNS(o,"svg:tspan");a.appendChild(s);var r=this.getLabelContainer();a.setAttribute("id",n),a.setAttribute("class","node"),r.appendChild(a),i.onCreateLabel(a,t),this.labels[t.id]=a}this.placeLabel(a,t,i)}}),v.Geom=new t({initialize:function(e){this.viz=e,this.config=e.config,this.node=e.config.Node,this.edge=e.config.Edge},translate:function(t,i){i=e.splat(i),this.viz.graph.eachNode(function(n){e.each(i,function(e){n.getPos(e).$add(t)})})},setRightLevelToShow:function(t,i,n){var a=this.getRightLevelToShow(t,i),o=this.viz.labels,s=e.merge({execShow:!0,execHide:!0,onHide:e.empty,onShow:e.empty},n||{});t.eachLevel(0,this.config.levelsToShow,function(e){var i=e._depth-t._depth;i>a?(s.onHide(e),s.execHide&&(e.drawn=!1,e.exist=!1,o.hideLabel(e,!1))):(s.onShow(e),s.execShow&&(e.exist=!0))}),t.drawn=!0},getRightLevelToShow:function(e,t){var i=this.config,n=i.levelsToShow,a=i.constrained;if(!a)return n;for(;!this.treeFitsInCanvas(e,t,n)&&n>1;)n--;return n}});var b={construct:function(t){var i="array"==e.type(t),n=new v(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);return i?function(t,i){for(var n=function(e){for(var n=0,a=i.length;a>n;n++)if(i[n].id==e)return i[n];var o={id:e,name:e};return t.addNode(o)},a=0,o=i.length;o>a;a++){t.addNode(i[a]);var s=i[a].adjacencies;if(s)for(var r=0,h=s.length;h>r;r++){var l=s[r],c={};"string"!=typeof s[r]&&(c=e.merge(l.data,{}),l=l.nodeTo),t.addAdjacence(i[a],n(l),c)}}}(n,t):function(e,t){if(e.addNode(t),t.children)for(var i=0,n=t.children;i<n.length;i++)e.addAdjacence(t,n[i]),arguments.callee(e,n[i])}(n,t),n},loadJSON:function(t,i){this.json=t,this.labels&&this.labels.clearLabels&&this.labels.clearLabels(!0),this.graph=this.construct(t),"array"!=e.type(t)?this.root=t.id:this.root=t[i?i:0].id},toJSON:function(e){if(e=e||"tree","tree"==e){var t={},i=this.graph.getNode(this.root),t=function a(e){var t={};t.id=e.id,t.name=e.name,t.data=e.data;var i=[];return e.eachSubnode(function(e){i.push(a(e))}),t.children=i,t}(i);return t}var t=[],n=!!this.graph.getNode(this.root).visited;return this.graph.eachNode(function(e){var i={};i.id=e.id,i.name=e.name,i.data=e.data;var a=[];e.eachAdjacency(function(e){var t=e.nodeTo;if(!!t.visited===n){var i={};i.nodeTo=t.id,i.data=e.data,a.push(i)}}),i.adjacencies=a,t.push(i),e.visited=!n}),t}},x=$jit.Layouts={},w={label:null,compute:function(t,i,n){this.initializeLabel(n);var a=this.label,o=a.style;t.eachNode(function(t){var i=t.getData("autoWidth"),n=t.getData("autoHeight");if(i||n){delete t.data.$width,delete t.data.$height,delete t.data.$dim;var s=t.getData("width"),r=t.getData("height");o.width=i?"auto":s+"px",o.height=n?"auto":r+"px",a.innerHTML=t.name;var h=a.offsetWidth,l=a.offsetHeight,c=t.getData("type");if(-1===e.indexOf(["circle","square","triangle","star"],c))t.setData("width",h),t.setData("height",l);else{var d=h>l?h:l;t.setData("width",d),t.setData("height",d),t.setData("dim",d)}}})},initializeLabel:function(e){this.label||(this.label=document.createElement("div"),document.body.appendChild(this.label)),this.setLabelStyles(e)},setLabelStyles:function(t){e.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"}),this.label.className="jit-autoadjust-label"}};x.Tree=function(){function i(e,t,i,n,a){var o=t.Node,s=t.multitree;if(o.overridable){var r=-1,h=-1;return e.eachNode(function(e){if(e._depth==i&&(!s||"$orn"in e.data&&e.data.$orn==n)){var t=e.getData("width",a),o=e.getData("height",a);r=t>r?t:r,h=o>h?o:h}}),{width:0>r?o.width:r,height:0>h?o.height:h}}return o}function n(e,t,i,n){var a="left"==n||"right"==n?"y":"x";e.getPos(t)[a]+=i}function a(t,i){var n=[];return e.each(t,function(e){e=f.call(e),e[0]+=i,e[1]+=i,n.push(e)}),n}function o(e,t){if(0==e.length)return t;if(0==t.length)return e;var i=e.shift(),n=t.shift();return[[i[0],n[1]]].concat(o(e,t))}function s(e,t){if(t=t||[],0==e.length)return t;var i=e.pop();return s(e,o(i,t))}function r(e,t,i,n,a){if(e.length<=a||t.length<=a)return 0;var o=e[a][1],s=t[a][0];return Math.max(r(e,t,i,n,++a)+i,o-s+n)}function h(e,t,i){function n(e,s,h){if(s.length<=h)return[];var l=s[h],c=r(e,l,t,i,0);return[c].concat(n(o(e,a(l,c)),s,++h))}return n([],e,0)}function l(e,t,i){function n(e,s,h){if(s.length<=h)return[];var l=s[h],c=-r(l,e,t,i,0);
return[c].concat(n(o(a(l,c),e),s,++h))}e=f.call(e);var s=n([],e.reverse(),0);return s.reverse()}function c(e,t,i,n){var a=h(e,t,i),o=l(e,t,i);"left"==n?o=a:"right"==n&&(a=o);for(var s=0,r=[];s<a.length;s++)r[s]=(a[s]+o[s])/2;return r}function d(e,t,o,r,h){function l(t,f,u){var g=t.getData(m,o),D=f||t.getData(y,o),N=[],C=[],L=!1,T=D+r.levelDistance;t.eachSubnode(function(t){if(t.exist&&(!d||"$orn"in t.data&&t.data.$orn==h)){"even"==r.levelSpacing?L||(L=i(e,r,t._depth,h,o)):L={width:t.getData("width"),height:t.getData("height")};var n=l(t,L[y],u+T);N.push(n.tree),C.push(n.extent)}});for(var A=c(C,x,b,w),S=0,M=[];S<N.length;S++)n(N[S],o,A[S],h),M.push(a(C[S],A[S]));var z=[[-g/2,g/2]].concat(s(M));return t.getPos(o)[p]=0,"top"==h||"left"==h?t.getPos(o)[v]=u:t.getPos(o)[v]=-u,{tree:t,extent:z}}var d=r.multitree,f=["x","y"],u=["width","height"],g=+("left"==h||"right"==h),p=f[g],v=f[1-g],m=(r.Node,u[g]),y=u[1-g],b=r.siblingOffset,x=r.subtreeOffset,w=r.align;l(t,!1,0)}var f=Array.prototype.slice;return new t({compute:function(t,i){var n=t||"start",a=this.graph.getNode(this.root);e.extend(a,{drawn:!0,exist:!0,selected:!0}),w.compute(this.graph,n,this.config),!i&&"_depth"in a||this.graph.computeLevels(this.root,0,"ignore"),this.computePositions(a,n)},computePositions:function(t,i){var n=this.config,a=n.multitree,o=n.align,s="center"!==o&&n.indent,r=n.orientation,h=a?["top","right","bottom","left"]:[r],l=this;e.each(h,function(e){d(l.graph,t,i,l.config,e,i);var n=["x","y"][+("left"==e||"right"==e)];!function r(t){t.eachSubnode(function(h){h.exist&&(!a||"$orn"in h.data&&h.data.$orn==e)&&(h.getPos(i)[n]+=t.getPos(i)[n],s&&(h.getPos(i)[n]+="left"==o?s:-s),r(h))})}(t)})}})}(),$jit.ST=function(){function i(e){if(e=e||this.clickedNode,!this.config.constrained)return[];var t=this.geom,i=this.graph,n=this.canvas,a=e._depth,s=[];i.eachNode(function(t){t.exist&&!t.selected&&(t.isDescendantOf(e.id)?t._depth<=a&&s.push(t):s.push(t))});var r=t.getRightLevelToShow(e,n);e.eachLevel(r,r,function(e){e.exist&&!e.selected&&s.push(e)});for(var h=0;h<o.length;h++){var l=this.graph.getNode(o[h]);l.isDescendantOf(e.id)||s.push(l)}return s}function n(e){var t=[],i=this.config;return e=e||this.clickedNode,this.clickedNode.eachLevel(0,i.levelsToShow,function(e){!i.multitree||"$orn"in e.data||!e.anySubnode(function(e){return e.exist&&!e.drawn})?e.drawn&&!e.anySubnode("drawn")&&t.push(e):t.push(e)}),t}var o=[];return new t({Implements:[b,h,x.Tree],initialize:function(t){var i=$jit.ST,n={levelsToShow:2,levelDistance:30,constrained:!0,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0};this.controller=this.config=e.merge(a("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),n,t);var o=this.config;o.useCanvas?(this.canvas=o.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(o.background&&(o.background=e.merge({type:"Circles"},o.background)),this.canvas=new l(this,o),this.config.labelContainer=("string"==typeof o.injectInto?o.injectInto:o.injectInto.id)+"-label"),this.graphOptions={klass:u},this.graph=new v(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new i.Label[o.Label.type](this),this.fx=new i.Plot(this,i),this.op=new i.Op(this),this.group=new i.Group(this),this.geom=new i.Geom(this),this.clickedNode=null,this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(e,t,i){var n=this.geom,a=this.fx,o=this;a.busy||(a.busy=!0,this.contract({onComplete:function(){n.switchOrientation(e),o.compute("end",!1),a.busy=!1,"animate"==t?o.onClick(o.clickedNode.id,i):"replot"==t&&o.select(o.clickedNode.id,i)}},e))},switchAlignment:function(e,t,i){this.config.align=e,"animate"==t?this.select(this.clickedNode.id,i):"replot"==t&&this.onClick(this.clickedNode.id,i)},addNodeInPath:function(e){o.push(e),this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(e){o.length=0,this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition(),this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){if(this.graph.computeLevels(this.root,0,"ignore"),this.geom.setRightLevelToShow(this.clickedNode,this.canvas),this.graph.eachNode(function(e){e.exist&&(e.drawn=!0)}),this.compute("end"),this.clickedNode){var e={x:this.canvas.translateOffsetX+this.config.offsetX||0,y:this.canvas.translateOffsetY+this.config.offsetY||0};this.geom.translate(this.clickedNode.endPos.add(e).$scale(-1),"end")}},requestNodes:function(t,i){var n=e.merge(this.controller,i),a=this.config.levelsToShow;if(n.request){var o=[],s=t._depth;t.eachLevel(0,a,function(e){e.drawn&&!e.anySubnode()&&(o.push(e),e._level=a-(e._depth-s))}),this.group.requestNodes(o,n)}else n.onComplete()},contract:function(t,n){var a=this.config.orientation,o=this.geom,s=this.group;n&&o.switchOrientation(n);var r=i.call(this);n&&o.switchOrientation(a),s.contract(r,e.merge(this.controller,t))},move:function(t,i){this.compute("end",!1);var n=i.Move,a={x:n.offsetX,y:n.offsetY};n.enable?this.geom.translate(t.endPos.add(a).$scale(-1),"end"):this.geom.translate(g(a.x,a.y).$scale(-1),"end"),this.fx.animate(e.merge(this.controller,{modes:["linear"]},i))},expand:function(t,i){var a=n.call(this,t);this.group.expand(a,e.merge(this.controller,i))},selectPath:function(t){function i(t){if(null!=t&&!t.selected){t.selected=!0,e.each(n.group.getSiblings([t])[t.id],function(e){e.exist=!0,e.drawn=!0});var a=t.getParents();a=a.length>0?a[0]:null,i(a)}}var n=this;this.graph.eachNode(function(e){e.selected=!1});for(var a=0,s=[t.id].concat(o);a<s.length;a++)i(this.graph.getNode(s[a]))},setRoot:function(e,t,i){function n(){if(this.config.multitree&&r.data.$orn){var t=r.data.$orn,n={left:"right",right:"left",top:"bottom",bottom:"top"}[t];s.data.$orn=n,function h(t){t.eachSubnode(function(t){t.id!=e&&(t.data.$orn=n,h(t))})}(s),delete r.data.$orn}this.root=e,this.clickedNode=r,this.graph.computeLevels(this.root,0,"ignore"),this.geom.setRightLevelToShow(r,o,{execHide:!1,onShow:function(e){e.drawn||(e.drawn=!0,e.setData("alpha",1,"end"),e.setData("alpha",0),e.pos.setc(r.pos.x,r.pos.y))}}),this.compute("end"),this.busy=!0,this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){a.busy=!1,a.onClick(e,{onComplete:function(){i&&i.onComplete()}})}})}if(!this.busy){this.busy=!0;var a=this,o=this.canvas,s=this.graph.getNode(this.root),r=this.graph.getNode(e);delete s.data.$orns,"animate"==t?(n.call(this),a.selectPath(r)):"replot"==t&&(n.call(this),this.select(this.root))}},addSubtree:function(t,i,n){"replot"==i?this.op.sum(t,e.extend({type:"replot"},n||{})):"animate"==i&&this.op.sum(t,e.extend({type:"fade:seq"},n||{}))},removeSubtree:function(t,i,n,a){var o=this.graph.getNode(t),s=[];o.eachLevel(+!i,!1,function(e){s.push(e.id)}),"replot"==n?this.op.removeNode(s,e.extend({type:"replot"},a||{})):"animate"==n&&this.op.removeNode(s,e.extend({type:"fade:seq"},a||{}))},select:function(t,a){var o=this.group,s=this.geom,r=this.graph.getNode(t),h=this.canvas,l=(this.graph.getNode(this.root),e.merge(this.controller,a)),c=this;l.onBeforeCompute(r),this.selectPath(r),this.clickedNode=r,this.requestNodes(r,{onComplete:function(){o.hide(o.prepare(i.call(c)),l),s.setRightLevelToShow(r,h),c.compute("current"),c.graph.eachNode(function(e){var t=e.pos.getc(!0);e.startPos.setc(t.x,t.y),e.endPos.setc(t.x,t.y),e.visited=!1});var e={x:l.offsetX,y:l.offsetY};c.geom.translate(r.endPos.add(e).$scale(-1),["start","current","end"]),o.show(n.call(c)),c.plot(),l.onAfterCompute(c.clickedNode),l.onComplete()}})},onClick:function(t,i){var n=this.canvas,a=this,o=this.geom,s=this.config,r={Move:{enable:!0,offsetX:n.translateOffsetX+s.offsetX||0,offsetY:n.translateOffsetY+s.offsetY||0},setRightLevelToShowConfig:!1,onBeforeRequest:e.empty,onBeforeContract:e.empty,onBeforeMove:e.empty,onBeforeExpand:e.empty},h=e.merge(this.controller,r,i);if(!this.busy){this.busy=!0;var l=this.graph.getNode(t);this.selectPath(l,this.clickedNode),this.clickedNode=l,h.onBeforeCompute(l),h.onBeforeRequest(l),this.requestNodes(l,{onComplete:function(){h.onBeforeContract(l),a.contract({onComplete:function(){o.setRightLevelToShow(l,n,h.setRightLevelToShowConfig),h.onBeforeMove(l),a.move(l,{Move:h.Move,onComplete:function(){h.onBeforeExpand(l),a.expand(l,{onComplete:function(){a.busy=!1,h.onAfterCompute(t),h.onComplete()}})}})}})}})}}})}(),$jit.ST.$extend=!0,$jit.ST.Op=new t({Implements:v.Op}),$jit.ST.Group=new t({initialize:function(e){this.viz=e,this.canvas=e.canvas,this.config=e.config,this.animation=new n,this.nodes=null},requestNodes:function(e,t){var i=0,n=e.length,a={},o=function(){t.onComplete()},s=this.viz;0==n&&o();for(var r=0;n>r;r++)a[e[r].id]=e[r],t.request(e[r].id,e[r]._level,{onComplete:function(e,t){t&&t.children&&(t.id=e,s.op.sum(t,{type:"nothing"})),++i==n&&(s.graph.computeLevels(s.root,0),o())}})},contract:function(t,i){var n=(this.viz,this);t=this.prepare(t),this.animation.setOptions(e.merge(i,{$animating:!1,compute:function(e){1==e&&(e=.99),n.plotStep(1-e,i,this.$animating),this.$animating="contract"},complete:function(){n.hide(t,i)}})).start()},hide:function(t,i){for(var n=(this.viz,0);n<t.length;n++){t[n].eachLevel(1,!1,function(t){t.exist&&e.extend(t,{drawn:!1,exist:!1})})}i.onComplete()},expand:function(t,i){var n=this;this.show(t),this.animation.setOptions(e.merge(i,{$animating:!1,compute:function(e){n.plotStep(e,i,this.$animating),this.$animating="expand"},complete:function(){n.plotStep(void 0,i,!1),i.onComplete()}})).start()},show:function(t){var i=this.config;this.prepare(t),e.each(t,function(e){if(i.multitree&&!("$orn"in e.data)){delete e.data.$orns;var t=" ";e.eachSubnode(function(e){"$orn"in e.data&&t.indexOf(e.data.$orn)<0&&e.exist&&!e.drawn&&(t+=e.data.$orn+" ")}),e.data.$orns=t}e.eachLevel(0,i.levelsToShow,function(e){e.exist&&(e.drawn=!0)})})},prepare:function(e){return this.nodes=this.getNodesWithChildren(e),this.nodes},getNodesWithChildren:function(e){var t=[],i=this.config;this.viz.root;e.sort(function(e,t){return(e._depth<=t._depth)-(e._depth>=t._depth)});for(var n=0;n<e.length;n++)if(e[n].anySubnode("exist")){for(var a=n+1,o=!1;!o&&a<e.length;a++)(!i.multitree||"$orn"in e[a].data)&&(o=o||e[n].isDescendantOf(e[a].id));o||t.push(e[n])}return t},plotStep:function(t,i,n){var a,o,s=this.viz,r=this.config,h=s.canvas,l=h.getCtx(),c=this.nodes,d={};for(a=0;a<c.length;a++){o=c[a],d[o.id]=[];var f=r.multitree&&!("$orn"in o.data),u=f&&o.data.$orns;o.eachSubgraph(function(e){f&&u&&u.indexOf(e.data.$orn)>0&&e.drawn?(e.drawn=!1,d[o.id].push(e)):f&&u||!e.drawn||(e.drawn=!1,d[o.id].push(e))}),o.drawn=!0}c.length>0&&s.fx.plot();for(a in d)e.each(d[a],function(e){e.drawn=!0});for(a=0;a<c.length;a++)o=c[a],l.save(),s.fx.plotSubtree(o,i,t,n),l.restore()},getSiblings:function(t){var i={};return e.each(t,function(e){var t=e.getParents();if(0==t.length)i[e.id]=[e];else{var n=[];t[0].eachSubnode(function(e){n.push(e)}),i[e.id]=n}}),i}}),$jit.ST.Geom=new t({Implements:v.Geom,switchOrientation:function(e){this.config.orientation=e},dispatch:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),i=e.length,n=function(e){return"function"==typeof e?e():e};if(2==i)return n("top"==t||"bottom"==t?e[0]:e[1]);if(4==i)switch(t){case"top":return n(e[0]);case"right":return n(e[1]);case"bottom":return n(e[2]);case"left":return n(e[3])}return void 0},getSize:function(e,t){var i=e.data,n=this.config,a=n.siblingOffset,o=n.multitree&&"$orn"in i&&i.$orn||n.orientation,s=e.getData("width")+a,r=e.getData("height")+a;return t?this.dispatch(o,s,r):this.dispatch(o,r,s)},getTreeBaseSize:function(e,t,i){var n=this.getSize(e,!0),a=0,o=this;return i(t,e)?n:0===t?0:(e.eachSubnode(function(e){a+=o.getTreeBaseSize(e,t-1,i)}),(n>a?n:a)+this.config.subtreeOffset)},getEdge:function(e,t,i){var n=function(t,i){return function(){return e.pos.add(new u(t,i))}},a=this.node,o=e.getData("width"),s=e.getData("height");if("begin"==t){if("center"==a.align)return this.dispatch(i,n(0,s/2),n(-o/2,0),n(0,-s/2),n(o/2,0));if("left"==a.align)return this.dispatch(i,n(0,s),n(0,0),n(0,0),n(o,0));if("right"==a.align)return this.dispatch(i,n(0,0),n(-o,0),n(0,-s),n(0,0));throw"align: not implemented"}if("end"==t){if("center"==a.align)return this.dispatch(i,n(0,-s/2),n(o/2,0),n(0,s/2),n(-o/2,0));if("left"==a.align)return this.dispatch(i,n(0,0),n(o,0),n(0,s),n(0,0));if("right"==a.align)return this.dispatch(i,n(0,-s),n(0,0),n(0,0),n(-o,0));throw"align: not implemented"}},getScaledTreePosition:function(e,t){var i=this.node,n=e.getData("width"),a=e.getData("height"),o=this.config.multitree&&"$orn"in e.data&&e.data.$orn||this.config.orientation,s=function(i,n){return function(){return e.pos.add(new u(i,n)).$scale(1-t)}};if("left"==i.align)return this.dispatch(o,s(0,a),s(0,0),s(0,0),s(n,0));if("center"==i.align)return this.dispatch(o,s(0,a/2),s(-n/2,0),s(0,-a/2),s(n/2,0));if("right"==i.align)return this.dispatch(o,s(0,0),s(-n,0),s(0,-a),s(0,0));throw"align: not implemented"},treeFitsInCanvas:function(e,t,i){var n=t.getSize(),a=this.config.multitree&&"$orn"in e.data&&e.data.$orn||this.config.orientation,o=this.dispatch(a,n.width,n.height),s=this.getTreeBaseSize(e,i,function(e,t){return 0===e||!t.anySubnode()});return o>s}}),$jit.ST.Plot=new t({Implements:v.Plot,plotSubtree:function(t,i,n,a){var o=this.viz,s=o.canvas,r=o.config;if(n=Math.min(Math.max(.001,n),1),n>=0){t.drawn=!1;var h=s.getCtx(),l=o.geom.getScaledTreePosition(t,n);h.translate(l.x,l.y),h.scale(n,n)}this.plotTree(t,e.merge(i,{withLabels:!0,hideLabels:!!n,plotSubtree:function(e,i){var n=r.multitree&&!("$orn"in t.data),a=n&&t.getData("orns");return!n||a.indexOf(t.getData("orn"))>-1}}),a),n>=0&&(t.drawn=!0)},getAlignedPos:function(e,t,i){var n,a,o=this.node;if("center"==o.align)n={x:e.x-t/2,y:e.y-i/2};else if("left"==o.align)a=this.config.orientation,n="bottom"==a||"top"==a?{x:e.x-t/2,y:e.y}:{x:e.x,y:e.y-i/2};else{if("right"!=o.align)throw"align: not implemented";a=this.config.orientation,n="bottom"==a||"top"==a?{x:e.x-t/2,y:e.y-i}:{x:e.x-t,y:e.y-i/2}}return n},getOrientation:function(e){var t=this.config,i=t.orientation;if(t.multitree){var n=e.nodeFrom,a=e.nodeTo;i="$orn"in n.data&&n.data.$orn||"$orn"in a.data&&a.data.$orn}return i}}),$jit.ST.Label={},$jit.ST.Label.Native=new t({Implements:v.Label.Native,renderLabel:function(e,t,i){var n=e.getCtx(),a=t.pos.getc(!0),o=t.getData("width"),s=t.getData("height"),r=this.viz.fx.getAlignedPos(a,o,s);n.fillText(t.name,r.x+o/2,r.y+s/2)}}),$jit.ST.Label.DOM=new t({Implements:v.Label.DOM,placeLabel:function(e,t,i){var n,a,o=t.pos.getc(!0),s=this.viz.config,r=s.Node,h=this.viz.canvas,l=t.getData("width"),c=t.getData("height"),d=h.getSize(),f=h.translateOffsetX,u=h.translateOffsetY,g=h.scaleOffsetX,p=h.scaleOffsetY,v=o.x*g+f,m=o.y*p+u;if("center"==r.align)n={x:Math.round(v-l/2+d.width/2),y:Math.round(m-c/2+d.height/2)};else if("left"==r.align)a=s.orientation,n="bottom"==a||"top"==a?{x:Math.round(v-l/2+d.width/2),y:Math.round(m+d.height/2)}:{x:Math.round(v+d.width/2),y:Math.round(m-c/2+d.height/2)};else{if("right"!=r.align)throw"align: not implemented";a=s.orientation,n="bottom"==a||"top"==a?{x:Math.round(v-l/2+d.width/2),y:Math.round(m-c+d.height/2)}:{x:Math.round(v-l+d.width/2),y:Math.round(m-c/2+d.height/2)}}n.w=l,n.h=c;var y=e.style;y.left=n.x+"px",y.top=n.y+"px",y.display=this.fitsInCanvas(n,h)?"":"none",i.onPlaceLabel(e,t)}}),$jit.ST.Label.SVG=new t({Implements:[$jit.ST.Label.DOM,v.Label.SVG],initialize:function(e){this.viz=e}}),$jit.ST.Label.HTML=new t({Implements:[$jit.ST.Label.DOM,v.Label.HTML],initialize:function(e){this.viz=e}}),$jit.ST.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(!1)},circle:{render:function(e,t){var i=e.getData("dim"),n=this.getAlignedPos(e.pos.getc(!0),i,i),a=i/2;this.nodeHelper.circle.render("fill",{x:n.x+a,y:n.y+a},a,t)},contains:function(e,t){var i=e.getData("dim"),n=this.getAlignedPos(e.pos.getc(!0),i,i),a=i/2;return this.nodeHelper.circle.contains({x:n.x+a,y:n.y+a},t,a)}},square:{render:function(e,t){var i=e.getData("dim"),n=i/2,a=this.getAlignedPos(e.pos.getc(!0),i,i);this.nodeHelper.square.render("fill",{x:a.x+n,y:a.y+n},n,t)},contains:function(e,t){var i=e.getData("dim"),n=this.getAlignedPos(e.pos.getc(!0),i,i),a=i/2;return this.nodeHelper.square.contains({x:n.x+a,y:n.y+a},t,a)}},ellipse:{render:function(e,t){var i=e.getData("width"),n=e.getData("height"),a=this.getAlignedPos(e.pos.getc(!0),i,n);this.nodeHelper.ellipse.render("fill",{x:a.x+i/2,y:a.y+n/2},i,n,t)},contains:function(e,t){var i=e.getData("width"),n=e.getData("height"),a=this.getAlignedPos(e.pos.getc(!0),i,n);return this.nodeHelper.ellipse.contains({x:a.x+i/2,y:a.y+n/2},t,i,n)}},rectangle:{render:function(e,t){var i=e.getData("width"),n=e.getData("height"),a=this.getAlignedPos(e.pos.getc(!0),i,n);this.nodeHelper.rectangle.render("fill",{x:a.x+i/2,y:a.y+n/2},i,n,t)},contains:function(e,t){var i=e.getData("width"),n=e.getData("height"),a=this.getAlignedPos(e.pos.getc(!0),i,n);return this.nodeHelper.rectangle.contains({x:a.x+i/2,y:a.y+n/2},t,i,n)}}}),$jit.ST.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var i=this.getOrientation(e),n=e.nodeFrom,a=e.nodeTo,o=n._depth<a._depth,s=this.viz.geom.getEdge(o?n:a,"begin",i),r=this.viz.geom.getEdge(o?a:n,"end",i);this.edgeHelper.line.render(s,r,t)},contains:function(e,t){var i=this.getOrientation(e),n=e.nodeFrom,a=e.nodeTo,o=n._depth<a._depth,s=this.viz.geom.getEdge(o?n:a,"begin",i),r=this.viz.geom.getEdge(o?a:n,"end",i);return this.edgeHelper.line.contains(s,r,t,this.edge.epsilon)}},arrow:{render:function(e,t){var i=this.getOrientation(e),n=e.nodeFrom,a=e.nodeTo,o=n._depth<a._depth,s=e.getData("dim"),r=this.viz.geom.getEdge(o?n:a,"begin",i),h=this.viz.geom.getEdge(o?a:n,"end",i),l=e.data.$direction,c=l&&l.length>1&&l[0]!=n.id;this.edgeHelper.arrow.render(r,h,s,c,t)},contains:function(e,t){var i=this.getOrientation(e),n=e.nodeFrom,a=e.nodeTo,o=n._depth<a._depth,s=this.viz.geom.getEdge(o?n:a,"begin",i),r=this.viz.geom.getEdge(o?a:n,"end",i);return this.edgeHelper.arrow.contains(s,r,t,this.edge.epsilon)}},"quadratic:begin":{render:function(e,t){var i=this.getOrientation(e),n=e.nodeFrom,a=e.nodeTo,o=n._depth<a._depth,s=this.viz.geom.getEdge(o?n:a,"begin",i),r=this.viz.geom.getEdge(o?a:n,"end",i),h=e.getData("dim"),l=t.getCtx();switch(l.beginPath(),l.moveTo(s.x,s.y),i){case"left":l.quadraticCurveTo(s.x+h,s.y,r.x,r.y);break;case"right":l.quadraticCurveTo(s.x-h,s.y,r.x,r.y);break;case"top":l.quadraticCurveTo(s.x,s.y+h,r.x,r.y);break;case"bottom":l.quadraticCurveTo(s.x,s.y-h,r.x,r.y)}l.stroke()}},"quadratic:end":{render:function(e,t){var i=this.getOrientation(e),n=e.nodeFrom,a=e.nodeTo,o=n._depth<a._depth,s=this.viz.geom.getEdge(o?n:a,"begin",i),r=this.viz.geom.getEdge(o?a:n,"end",i),h=e.getData("dim"),l=t.getCtx();switch(l.beginPath(),l.moveTo(s.x,s.y),i){case"left":l.quadraticCurveTo(r.x-h,r.y,r.x,r.y);break;case"right":l.quadraticCurveTo(r.x+h,r.y,r.x,r.y);break;case"top":l.quadraticCurveTo(r.x,r.y-h,r.x,r.y);break;case"bottom":l.quadraticCurveTo(r.x,r.y+h,r.x,r.y)}l.stroke()}},bezier:{render:function(e,t){var i=this.getOrientation(e),n=e.nodeFrom,a=e.nodeTo,o=n._depth<a._depth,s=this.viz.geom.getEdge(o?n:a,"begin",i),r=this.viz.geom.getEdge(o?a:n,"end",i),h=e.getData("dim"),l=t.getCtx();switch(l.beginPath(),l.moveTo(s.x,s.y),i){case"left":l.bezierCurveTo(s.x+h,s.y,r.x-h,r.y,r.x,r.y);break;case"right":l.bezierCurveTo(s.x-h,s.y,r.x+h,r.y,r.x,r.y);break;case"top":l.bezierCurveTo(s.x,s.y+h,r.x,r.y-h,r.x,r.y);break;case"bottom":l.bezierCurveTo(s.x,s.y-h,r.x,r.y+h,r.x,r.y)}l.stroke()}}}),$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(t,i){var n=t.pos.getc(!0),a=t.getData("width"),o=t.getData("height"),s=this.getAlignedPos(n,a,o),r=s.x,h=s.y,l=t.getData("stringArray"),c=t.getData("dimArray"),d=t.getData("valueArray"),f=e.reduce(d,function(e,t){return e+t[0]},0),u=e.reduce(d,function(e,t){return e+t[1]},0),g=t.getData("colorArray"),p=g.length,v=t.getData("config"),m=t.getData("gradient"),y=v.showLabels,b=v.showAggregates,x=v.Label,w=t.getData("prev"),D=i.getCtx(),N=t.getData("border");if(g&&c&&l){for(var C=0,L=c.length,T=0,A=0,S=0;L>C;C++){if(D.fillStyle=D.strokeStyle=g[C%p],D.save(),m&&(c[C][0]>0||c[C][1]>0)){var M=T+c[C][0],z=A+c[C][1],O=Math.atan((z-M)/a),P=55,E=D.createLinearGradient(r+a/2,h-(M+z)/2,r+a/2+P*Math.sin(O),h-(M+z)/2+P*Math.cos(O)),$=e.rgbToHex(e.map(e.hexToRgb(g[C%p].slice(1)),function(e){return.85*e>>0}));E.addColorStop(0,g[C%p]),E.addColorStop(1,$),D.fillStyle=E}if(D.beginPath(),D.moveTo(r,h-T),D.lineTo(r+a,h-A),D.lineTo(r+a,h-A-c[C][1]),D.lineTo(r,h-T-c[C][0]),D.lineTo(r,h-T),D.fill(),D.restore(),N){var I=N.name==l[C],_=I?.7:.8,$=e.rgbToHex(e.map(e.hexToRgb(g[C%p].slice(1)),function(e){return e*_>>0}));D.strokeStyle=$,D.lineWidth=I?4:1,D.save(),D.beginPath(),0===N.index?(D.moveTo(r,h-T),D.lineTo(r,h-T-c[C][0])):(D.moveTo(r+a,h-A),D.lineTo(r+a,h-A-c[C][1])),D.stroke(),D.restore()}T+=c[C][0]||0,A+=c[C][1]||0,c[C][0]>0&&(S+=d[C][0]||0)}if(w&&"Native"==x.type){D.save(),D.beginPath(),D.fillStyle=D.strokeStyle=x.color,D.font=x.style+" "+x.size+"px "+x.family,D.textAlign="center",D.textBaseline="middle";var k=b(t.name,f,u,t,S);k!==!1&&D.fillText(k!==!0?k:S,r,h-T-v.labelOffset-x.size/2,a);var j=y(t.name,f,u,t);j!==!1&&D.fillText(j!==!0?j:t.name,r,h+x.size/2+v.labelOffset),D.restore()}}},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height"),o=this.getAlignedPos(i,n,a),s=o.x,r=o.y,h=e.getData("dimArray"),l=t.x-s;if(t.x<s||t.x>s+n||t.y>r||t.y<r-a)return!1;for(var c=0,d=h.length,f=r,u=r;d>c;c++){var g=h[c];f-=g[0],u-=g[1];var p=f+(u-f)*l/n;if(t.y>=p){var v=+(l>n/2);return{name:e.getData("stringArray")[c],color:e.getData("colorArray")[c],value:e.getData("valueArray")[c][v],index:v}}}return!1}}}),$jit.AreaChart=new t({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:!1,initialize:function(t){this.controller=this.config=e.merge(a("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},t);var i=this.config.showLabels,n=e.type(i),o=this.config.showAggregates,s=e.type(o);this.config.showLabels="function"==n?i:e.lambda(i),this.config.showAggregates="function"==s?o:e.lambda(o),this.initializeViz()},initializeViz:function(){var t=this.config,i=this,n=t.type.split(":")[0],a={},o=new $jit.ST({injectInto:t.injectInto,width:t.width,height:t.height,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:"Native"!=t.Label.type,useCanvas:t.useCanvas,Label:{type:t.Label.type},Node:{overridable:!0,type:"areachart-"+n,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:t.Tips.enable,type:"Native",force:!0,onShow:function(e,i,n){var a=n;t.Tips.onShow(e,a,i)}},Events:{enable:!0,type:"Native",onClick:function(e,n,a){if(t.filterOnClick||t.Events.enable){var o=n.getContains();o&&t.filterOnClick&&i.filter(o.name),t.Events.enable&&t.Events.onClick(o,n,a)}},onRightClick:function(e,n,a){t.restoreOnRightClick&&i.restore()},onMouseMove:function(e,n,a){if(t.selectOnHover)if(e){var o=n.getContains();i.select(e.id,o.name,o.index)}else i.select(!1,!1,!1)}},onCreateLabel:function(i,n){var o=t.Label,s=n.getData("valueArray"),r=e.reduce(s,function(e,t){return e+t[0]},0),h=e.reduce(s,function(e,t){return e+t[1]},0);if(n.getData("prev")){var l={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},c=l.wrapper,d=l.label,f=l.aggregate,u=c.style,g=d.style,p=f.style;a[n.id]=l,c.appendChild(d),c.appendChild(f),t.showLabels(n.name,r,h,n)||(d.style.display="none"),t.showAggregates(n.name,r,h,n)||(f.style.display="none"),u.position="relative",u.overflow="visible",u.fontSize=o.size+"px",u.fontFamily=o.family,u.color=o.color,u.textAlign="center",p.position=g.position="absolute",i.style.width=n.getData("width")+"px",i.style.height=n.getData("height")+"px",d.innerHTML=n.name,i.appendChild(c)}},onPlaceLabel:function(i,n){if(n.getData("prev")){var o=a[n.id],s=o.wrapper.style,r=o.label.style,h=o.aggregate.style,l=n.getData("width"),c=(n.getData("height"),n.getData("dimArray")),d=n.getData("valueArray"),f=e.reduce(d,function(e,t){return e+t[0]},0),u=e.reduce(d,function(e,t){return e+t[1]},0),g=parseInt(s.fontSize,10);i.style;if(c&&d){t.showLabels(n.name,f,u,n)?r.display="":r.display="none";var p=t.showAggregates(n.name,f,u,n);p!==!1?h.display="":h.display="none",s.width=h.width=r.width=i.style.width=l+"px",h.left=r.left=-l/2+"px";for(var v=0,m=d.length,y=0,b=0;m>v;v++)c[v][0]>0&&(y+=d[v][0],b+=c[v][0]);h.top=-g-t.labelOffset+"px",r.top=t.labelOffset+b+"px",i.style.top=parseInt(i.style.top,10)-b+"px",i.style.height=s.height=b+"px",o.aggregate.innerHTML=p!==!0?p:y}}}}),s=o.canvas.getSize(),r=t.Margin;o.config.offsetY=-s.height/2+r.bottom+(t.showLabels&&t.labelOffset+t.Label.size),o.config.offsetX=(r.right-r.left)/2,this.delegate=o,this.canvas=this.delegate.canvas},loadJSON:function(t){for(var i=e.time(),n=[],a=this.delegate,o=e.splat(t.label),s=e.splat(t.color||this.colors),r=this.config,h=!!r.type.split(":")[1],l=r.animate,c=0,d=t.values,f=d.length;f-1>c;c++){var u=d[c],g=d[c-1],p=d[c+1],v=e.splat(d[c].values),m=e.splat(d[c+1].values),y=e.zip(v,m);n.push({id:i+u.label,name:u.label,data:{value:y,$valueArray:y,$colorArray:s,$stringArray:o,$next:p.label,$prev:g?g.label:!1,$config:r,$gradient:h},children:[]})}var b={id:i+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:n};a.loadJSON(b),this.normalizeDims(),a.compute(),a.select(a.root),l&&a.fx.animate({modes:["node-property:height:dimArray"],duration:1500})},updateJSON:function(t,i){if(!this.busy){this.busy=!0;for(var n=this.delegate,a=n.graph,o=t.label&&e.splat(t.label),s=t.values,r=this.config.animate,h=this,l={},c=0,d=s.length;d>c;c++)l[s[c].label]=s[c];a.eachNode(function(t){var i=l[t.name],n=t.getData("stringArray"),a=t.getData("valueArray"),s=t.getData("next");i&&(i.values=e.splat(i.values),e.each(a,function(e,t){e[0]=i.values[t],o&&(n[t]=o[t])}),t.setData("valueArray",a)),s&&(i=l[s],i&&e.each(a,function(e,t){e[1]=i.values[t]}))}),this.normalizeDims(),n.compute(),n.select(n.root),r&&n.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){h.busy=!1,i&&i.onComplete()}})}},filter:function(t,i){if(!this.busy){this.busy=!0,this.config.Tips.enable&&this.delegate.tips.hide(),this.select(!1,!1,!1);var n=e.splat(t),a=this.delegate.graph.getNode(this.delegate.root),o=this;this.normalizeDims(),a.eachAdjacency(function(t){var i=t.nodeTo,a=i.getData("dimArray","end"),o=i.getData("stringArray");i.setData("dimArray",e.map(a,function(t,i){return e.indexOf(n,o[i])>-1?t:[0,0]}),"end")}),this.delegate.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){o.busy=!1,i&&i.onComplete()}})}},restore:function(e){if(!this.busy){this.busy=!0,this.config.Tips.enable&&this.delegate.tips.hide(),this.select(!1,!1,!1),this.normalizeDims();var t=this;this.delegate.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){t.busy=!1,e&&e.onComplete()}})}},select:function(e,t,i){if(this.config.selectOnHover){var n=this.selected;if(n.id!=e||n.name!=t||n.index!=i){if(n.id=e,n.name=t,n.index=i,this.delegate.graph.eachNode(function(e){e.setData("border",!1)}),e){var a=this.delegate.graph.getNode(e);a.setData("border",n);var o=0===i?"prev":"next";o=a.getData(o),o&&(a=this.delegate.graph.getByName(o),a&&a.setData("border",{name:t,index:1-i}))}this.delegate.plot()}}},getLegend:function(){var t,i={};this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(e){t=e.nodeTo});var n=t.getData("colorArray"),a=n.length;return e.each(t.getData("stringArray"),function(e,t){i[e]=n[t%a]}),i},getMaxValue:function(){var t=0;return this.delegate.graph.eachNode(function(i){var n=i.getData("valueArray"),a=0,o=0;e.each(n,function(e){a+=+e[0],o+=+e[1]});var s=o>a?o:a;t=t>s?t:s}),t},normalizeDims:function(){var t=this.delegate.graph.getNode(this.delegate.root),i=0;t.eachAdjacency(function(){i++});var n=this.getMaxValue()||1,a=this.delegate.canvas.getSize(),o=this.config,s=o.Margin,r=o.labelOffset+o.Label.size,h=(a.width-(s.left+s.right))/i,l=o.animate,c=a.height-(s.top+s.bottom)-(o.showAggregates&&r)-(o.showLabels&&r);this.delegate.graph.eachNode(function(t){var i=0,a=0,o=[];e.each(t.getData("valueArray"),function(e){i+=+e[0],a+=+e[1],o.push([0,0])});var s=a>i?a:i;if(t.setData("width",h),l){t.setData("height",s*c/n,"end"),t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return[e[0]*c/n,e[1]*c/n]}),"end");var r=t.getData("dimArray");r||t.setData("dimArray",o)}else t.setData("height",s*c/n),t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return[e[0]*c/n,e[1]*c/n]}))})}}),a.BarChart={$extend:!0,animate:!0,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:!0,showLabels:!0,Tips:{enable:!1,onShow:e.empty,onHide:e.empty},Events:{enable:!1,onClick:e.empty}},$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(t,i){var n=t.pos.getc(!0),a=t.getData("width"),o=t.getData("height"),s=this.getAlignedPos(n,a,o),r=s.x,h=s.y,l=t.getData("dimArray"),c=t.getData("valueArray"),d=t.getData("colorArray"),f=d.length,u=t.getData("stringArray"),g=i.getCtx(),p={},v=t.getData("border"),m=t.getData("gradient"),y=t.getData("config"),b="horizontal"==y.orientation,x=y.showAggregates,w=y.showLabels,D=y.Label;if(d&&l&&u){for(var N=0,C=l.length,L=0,T=0;C>N;N++){if(g.fillStyle=g.strokeStyle=d[N%f],m){var A;A=b?g.createLinearGradient(r+L+l[N]/2,h,r+L+l[N]/2,h+o):g.createLinearGradient(r,h-L-l[N]/2,r+a,h-L-l[N]/2);var S=e.rgbToHex(e.map(e.hexToRgb(d[N%f].slice(1)),function(e){return.5*e>>0}));A.addColorStop(0,S),A.addColorStop(.5,d[N%f]),A.addColorStop(1,S),g.fillStyle=A}b?g.fillRect(r+L,h,l[N],o):g.fillRect(r,h-L-l[N],a,l[N]),v&&v.name==u[N]&&(p.acum=L,p.dimValue=l[N]),L+=l[N]||0,T+=c[N]||0}if(v&&(g.save(),g.lineWidth=2,g.strokeStyle=v.color,b?g.strokeRect(r+p.acum+1,h+1,p.dimValue-2,o-2):g.strokeRect(r+1,h-p.acum-p.dimValue+1,a-2,p.dimValue-2),g.restore()),"Native"==D.type){g.save(),g.fillStyle=g.strokeStyle=D.color,g.font=D.style+" "+D.size+"px "+D.family,g.textBaseline="middle";var M=x(t.name,T,t);M!==!1&&(M=M!==!0?M:T,b?(g.textAlign="right",g.fillText(M,r+L-y.labelOffset,h+o/2)):(g.textAlign="center",g.fillText(M,r+a/2,h-o-D.size/2-y.labelOffset))),w(t.name,T,t)&&(b?(g.textAlign="center",g.translate(r-y.labelOffset-D.size/2,h+o/2),g.rotate(Math.PI/2),g.fillText(t.name,0,0)):(g.textAlign="center",g.fillText(t.name,r+a/2,h+D.size/2+y.labelOffset))),g.restore()}}},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height"),o=this.getAlignedPos(i,n,a),s=o.x,r=o.y,h=e.getData("dimArray"),l=e.getData("config"),c=(t.x-s,"horizontal"==l.orientation);if(c){if(t.x<s||t.x>s+n||t.y>r+a||t.y<r)return!1}else if(t.x<s||t.x>s+n||t.y>r||t.y<r-a)return!1;for(var d=0,f=h.length,u=c?s:r;f>d;d++){var g=h[d];if(c){u+=g;var p=u;if(t.x<=p)return{name:e.getData("stringArray")[d],color:e.getData("colorArray")[d],value:e.getData("valueArray")[d],label:e.name}}else{u-=g;var p=u;if(t.y>=p)return{name:e.getData("stringArray")[d],color:e.getData("colorArray")[d],value:e.getData("valueArray")[d],label:e.name}}}return!1}},"barchart-grouped":{render:function(t,i){var n=t.pos.getc(!0),a=t.getData("width"),o=t.getData("height"),s=this.getAlignedPos(n,a,o),r=s.x,h=s.y,l=t.getData("dimArray"),c=t.getData("valueArray"),d=c.length,f=t.getData("colorArray"),u=f.length,g=t.getData("stringArray"),p=i.getCtx(),v={},m=t.getData("border"),y=t.getData("gradient"),b=t.getData("config"),x="horizontal"==b.orientation,w=b.showAggregates,D=b.showLabels,N=b.Label,C=(x?o:a)/d;if(f&&l&&g){for(var L=0,T=d,A=0,S=0;T>L;L++){if(p.fillStyle=p.strokeStyle=f[L%u],y){var M;M=x?p.createLinearGradient(r+l[L]/2,h+C*L,r+l[L]/2,h+C*(L+1)):p.createLinearGradient(r+C*L,h-l[L]/2,r+C*(L+1),h-l[L]/2);var z=e.rgbToHex(e.map(e.hexToRgb(f[L%u].slice(1)),function(e){
return.5*e>>0}));M.addColorStop(0,z),M.addColorStop(.5,f[L%u]),M.addColorStop(1,z),p.fillStyle=M}x?p.fillRect(r,h+C*L,l[L],C):p.fillRect(r+C*L,h-l[L],C,l[L]),m&&m.name==g[L]&&(v.acum=C*L,v.dimValue=l[L]),A+=l[L]||0,S+=c[L]||0}if(m&&(p.save(),p.lineWidth=2,p.strokeStyle=m.color,x?p.strokeRect(r+1,h+v.acum+1,v.dimValue-2,C-2):p.strokeRect(r+v.acum+1,h-v.dimValue+1,C-2,v.dimValue-2),p.restore()),"Native"==N.type){p.save(),p.fillStyle=p.strokeStyle=N.color,p.font=N.style+" "+N.size+"px "+N.family,p.textBaseline="middle";var O=w(t.name,S,t);O!==!1&&(O=O!==!0?O:S,x?(p.textAlign="right",p.fillText(O,r+Math.max.apply(null,l)-b.labelOffset,h+o/2)):(p.textAlign="center",p.fillText(O,r+a/2,h-Math.max.apply(null,l)-N.size/2-b.labelOffset)));var P=D(t.name,S,t);P!==!1&&(P=P!==!0?P:t.name,x?(p.textAlign="center",p.translate(r-b.labelOffset-N.size/2,h+o/2),p.rotate(Math.PI/2),p.fillText(P,0,0)):(p.textAlign="center",p.fillText(P,r+a/2,h+N.size/2+b.labelOffset))),p.restore()}}},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height"),o=this.getAlignedPos(i,n,a),s=o.x,r=o.y,h=e.getData("dimArray"),l=h.length,c=e.getData("config"),d=(t.x-s,"horizontal"==c.orientation),f=(d?a:n)/l;if(d){if(t.x<s||t.x>s+n||t.y>r+a||t.y<r)return!1}else if(t.x<s||t.x>s+n||t.y>r||t.y<r-a)return!1;for(var u=0,g=h.length;g>u;u++){var p=h[u];if(d){var v=r+f*u;if(t.x<=s+p&&t.y>=v&&t.y<=v+f)return{name:e.getData("stringArray")[u],color:e.getData("colorArray")[u],value:e.getData("valueArray")[u],label:e.name}}else{var v=s+f*u;if(t.x>=v&&t.x<=v+f&&t.y>=r-p)return{name:e.getData("stringArray")[u],color:e.getData("colorArray")[u],value:e.getData("valueArray")[u],label:e.name}}}return!1}}}),$jit.BarChart=new t({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:!1,initialize:function(t){this.controller=this.config=e.merge(a("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},t);var i=this.config.showLabels,n=e.type(i),o=this.config.showAggregates,s=e.type(o);this.config.showLabels="function"==n?i:e.lambda(i),this.config.showAggregates="function"==s?o:e.lambda(o),this.initializeViz()},initializeViz:function(){var t=this.config,i=this,n=t.type.split(":")[0],a="horizontal"==t.orientation,o={},s=new $jit.ST({injectInto:t.injectInto,width:t.width,height:t.height,orientation:a?"left":"bottom",levelDistance:0,siblingOffset:t.barsOffset,subtreeOffset:0,withLabels:"Native"!=t.Label.type,useCanvas:t.useCanvas,Label:{type:t.Label.type},Node:{overridable:!0,type:"barchart-"+n,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:t.Tips.enable,type:"Native",force:!0,onShow:function(e,i,n){var a=n;t.Tips.onShow(e,a,i)}},Events:{enable:!0,type:"Native",onClick:function(e,i,n){if(t.Events.enable){var a=i.getContains();t.Events.onClick(a,i,n)}},onMouseMove:function(e,n,a){if(t.hoveredColor)if(e){var o=n.getContains();i.select(e.id,o.name,o.index)}else i.select(!1,!1,!1)}},onCreateLabel:function(i,n){var a=t.Label,s=n.getData("valueArray"),r=e.reduce(s,function(e,t){return e+t},0),h={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},l=h.wrapper,c=h.label,d=h.aggregate,f=l.style,u=c.style,g=d.style;o[n.id]=h,l.appendChild(c),l.appendChild(d),t.showLabels(n.name,r,n)||(u.display="none"),t.showAggregates(n.name,r,n)||(g.display="none"),f.position="relative",f.overflow="visible",f.fontSize=a.size+"px",f.fontFamily=a.family,f.color=a.color,f.textAlign="center",g.position=u.position="absolute",i.style.width=n.getData("width")+"px",i.style.height=n.getData("height")+"px",g.left=u.left="0px",c.innerHTML=n.name,i.appendChild(l)},onPlaceLabel:function(e,i){if(o[i.id]){var n=o[i.id],a=n.wrapper.style,s=n.label.style,r=n.aggregate.style,h="grouped"==t.type.split(":")[0],l="horizontal"==t.orientation,c=i.getData("dimArray"),d=i.getData("valueArray"),f=h&&l?Math.max.apply(null,c):i.getData("width"),u=h&&!l?Math.max.apply(null,c):i.getData("height"),g=parseInt(a.fontSize,10);e.style;if(c&&d){a.width=r.width=s.width=e.style.width=f+"px";for(var p=0,v=d.length,m=0;v>p;p++)c[p]>0&&(m+=d[p]);t.showLabels(i.name,m,i)?s.display="":s.display="none";var y=t.showAggregates(i.name,m,i);y!==!1?r.display="":r.display="none","horizontal"==t.orientation?(r.textAlign="right",s.textAlign="left",s.textIndex=r.textIndent=t.labelOffset+"px",r.top=s.top=(u-g)/2+"px",e.style.height=a.height=u+"px"):(r.top=-g-t.labelOffset+"px",s.top=t.labelOffset+u+"px",e.style.top=parseInt(e.style.top,10)-u+"px",e.style.height=a.height=u+"px"),n.aggregate.innerHTML=y!==!0?y:m}}}}),r=s.canvas.getSize(),h=t.Margin;a?(s.config.offsetX=r.width/2-h.left-(t.showLabels&&t.labelOffset+t.Label.size),s.config.offsetY=(h.bottom-h.top)/2):(s.config.offsetY=-r.height/2+h.bottom+(t.showLabels&&t.labelOffset+t.Label.size),s.config.offsetX=(h.right-h.left)/2),this.delegate=s,this.canvas=this.delegate.canvas},loadJSON:function(t){if(!this.busy){this.busy=!0;for(var i=e.time(),n=[],a=this.delegate,o=e.splat(t.label),s=e.splat(t.color||this.colors),r=this.config,h=!!r.type.split(":")[1],l=r.animate,c="horizontal"==r.orientation,d=this,f=0,u=t.values,g=u.length;g>f;f++){var p=u[f],v=e.splat(u[f].values);"undefined"==typeof p.id&&(p.id=p.label),n.push({id:i+p.id,name:p.label,data:{value:v,$valueArray:v,$colorArray:s,$stringArray:o,$gradient:h,$config:r},children:[]})}var m={id:i+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:n};a.loadJSON(m),this.normalizeDims(),a.compute(),a.select(a.root),l?c?a.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){d.busy=!1}}):a.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){d.busy=!1}}):this.busy=!1}},updateJSON:function(t,i){if(!this.busy){this.busy=!0,this.select(!1,!1,!1);var n=this.delegate,a=n.graph,o=t.values,s=this.config.animate,r=this,h="horizontal"==this.config.orientation;e.each(o,function(i){var n=a.getByName(i.label);n&&(n.setData("valueArray",e.splat(i.values)),t.label&&n.setData("stringArray",e.splat(t.label)))}),this.normalizeDims(),n.compute(),n.select(n.root),s&&(h?n.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){r.busy=!1,i&&i.onComplete()}}):n.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){r.busy=!1,i&&i.onComplete()}}))}},select:function(e,t){if(this.config.hoveredColor){var i=this.selected;(i.id!=e||i.name!=t)&&(i.id=e,i.name=t,i.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(t){e==t.id?t.setData("border",i):t.setData("border",!1)}),this.delegate.plot())}},getLegend:function(){var t,i={};this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(e){t=e.nodeTo});var n=t.getData("colorArray"),a=n.length;return e.each(t.getData("stringArray"),function(e,t){i[e]=n[t%a]}),i},getMaxValue:function(){var t=0,i="stacked"==this.config.type.split(":")[0];return this.delegate.graph.eachNode(function(n){var a=n.getData("valueArray"),o=0;a&&(i?e.each(a,function(e){o+=+e}):o=Math.max.apply(null,a),t=t>o?t:o)}),t},setBarType:function(e){this.config.type=e,this.delegate.config.Node.type="barchart-"+e.split(":")[0]},normalizeDims:function(){var t=this.delegate.graph.getNode(this.delegate.root),i=0;t.eachAdjacency(function(){i++});var n=this.getMaxValue()||1,a=this.delegate.canvas.getSize(),o=this.config,s=o.Margin,r=s.left+s.right,h=s.top+s.bottom,l="horizontal"==o.orientation,c=(a[l?"height":"width"]-(l?h:r)-(i-1)*o.barsOffset)/i,d=o.animate,f=a[l?"width":"height"]-(l?r:h)-(!l&&o.showAggregates&&o.Label.size+o.labelOffset)-(o.showLabels&&o.Label.size+o.labelOffset),u=l?"height":"width",g=l?"width":"height";this.delegate.graph.eachNode(function(t){var i=0,a=[];if(e.each(t.getData("valueArray"),function(e){i+=+e,a.push(0)}),t.setData(u,c),d){t.setData(g,i*f/n,"end"),t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return e*f/n}),"end");var o=t.getData("dimArray");o||t.setData("dimArray",a)}else t.setData(g,i*f/n),t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return e*f/n}))})}}),a.PieChart={$extend:!0,animate:!0,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:!1,onClick:e.empty},Tips:{enable:!1,onShow:e.empty,onHide:e.empty},showLabels:!0,resizeLabels:!1,updateHeights:!1},x.Radial=new t({compute:function(t){var i=e.splat(t||["current","start","end"]);w.compute(this.graph,i,this.config),this.graph.computeLevels(this.root,0,"ignore");var n=this.createLevelDistanceFunc();this.computeAngularWidths(i),this.computePositions(i,n)},computePositions:function(e,t){for(var i=e,n=this.graph,a=n.getNode(this.root),o=this.parent,s=(this.config,0),r=i.length;r>s;s++){var h=i[s];a.setPos(f(0,0),h),a.setData("span",2*Math.PI,h)}a.angleSpan={begin:0,end:2*Math.PI},n.eachBFS(this.root,function(e){var n=e.angleSpan.end-e.angleSpan.begin,a=e.angleSpan.begin,s=t(e),r=0,h=[],l={};e.eachSubnode(function(e){r+=e._treeAngularWidth;for(var t=0,n=i.length;n>t;t++){var a=i[t],o=e.getData("dim",a);l[a]=a in l?o>l[a]?o:l[a]:o}h.push(e)},"ignore"),o&&o.id==e.id&&h.length>0&&h[0].dist&&h.sort(function(e,t){return(e.dist>=t.dist)-(e.dist<=t.dist)});for(var c=0,d=h.length;d>c;c++){var u=h[c];if(!u._flag){for(var g=u._treeAngularWidth/r*n,p=a+g/2,v=0,m=i.length;m>v;v++){var y=i[v];u.setPos(f(p,s),y),u.setData("span",g,y),u.setData("dim-quotient",u.getData("dim",y)/l[y],y)}u.angleSpan={begin:a,end:a+g},a+=g}}},"ignore")},setAngularWidthForNodes:function(e){this.graph.eachBFS(this.root,function(t,i){var n=t.getData("angularWidth",e[0])||5;t._angularWidth=n/i},"ignore")},setSubtreesAngularWidth:function(){var e=this;this.graph.eachNode(function(t){e.setSubtreeAngularWidth(t)},"ignore")},setSubtreeAngularWidth:function(e){var t=this,i=e._angularWidth,n=0;e.eachSubnode(function(e){t.setSubtreeAngularWidth(e),n+=e._treeAngularWidth},"ignore"),e._treeAngularWidth=Math.max(i,n)},computeAngularWidths:function(e){this.setAngularWidthForNodes(e),this.setSubtreesAngularWidth()}}),$jit.Sunburst=new t({Implements:[b,h,x.Radial],initialize:function(t){var i=$jit.Sunburst,n={interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}};this.controller=this.config=e.merge(a("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),n,t);var o=this.config;o.useCanvas?(this.canvas=o.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(o.background&&(o.background=e.merge({type:"Circles"},o.background)),this.canvas=new l(this,o),this.config.labelContainer=("string"==typeof o.injectInto?o.injectInto:o.injectInto.id)+"-label"),this.graphOptions={klass:d,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new v(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new i.Label[o.Label.type](this),this.fx=new i.Plot(this,i),this.op=new i.Op(this),this.json=null,this.root=null,this.rotated=null,this.busy=!1,this.initializeExtras()},createLevelDistanceFunc:function(){var e=this.config.levelDistance;return function(t){return(t._depth+1)*e}},refresh:function(){this.compute(),this.plot()},reposition:function(){this.compute("end")},rotate:function(e,t,i){var n=e.getPos(i.property||"current").getp(!0).theta;this.rotated=e,this.rotateAngle(-n,t,i)},rotateAngle:function(t,i,n){var a=e.merge(this.config,n||{},{modes:["polar"]}),o=n.property||("animate"===i?"end":"current");"animate"===i&&this.fx.animation.pause(),this.graph.eachNode(function(e){var i=e.getPos(o);i.theta+=t,i.theta<0&&(i.theta+=2*Math.PI)}),"animate"==i?this.fx.animate(a):"replot"==i&&(this.fx.plot(),this.busy=!1)},plot:function(){this.fx.plot()}}),$jit.Sunburst.$extend=!0,function(i){i.Op=new t({Implements:v.Op}),i.Plot=new t({Implements:v.Plot}),i.Label={},i.Label.Native=new t({Implements:v.Label.Native,initialize:function(e){this.viz=e,this.label=e.config.Label,this.config=e.config},renderLabel:function(e,t,i){var n=t.getData("span");if(!(n<Math.PI/2&&Math.tan(n)*this.config.levelDistance*t._depth<10)){var a=e.getCtx(),o=a.measureText(t.name);if(t.id==this.viz.root)var s=-o.width/2,r=0,h=0;else{var l=5,c=(i.levelDistance-l,t.pos.clone());c.rho+=l;var d=c.getp(!0),f=c.getc(!0),s=f.x,r=f.y,u=Math.PI,g=d.theta>u/2&&d.theta<3*u/2,h=g?d.theta+u:d.theta;g?(s-=Math.abs(Math.cos(d.theta)*o.width),r+=Math.sin(d.theta)*o.width):t.id==this.viz.root&&(s-=o.width/2)}a.save(),a.translate(s,r),a.rotate(h),a.fillText(t.name,0,0),a.restore()}}}),i.Label.SVG=new t({Implements:v.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz,o=this.viz.canvas,s=o.getSize(),r={x:Math.round(n.x+s.width/2),y:Math.round(n.y+s.height/2)};e.setAttribute("x",r.x),e.setAttribute("y",r.y);var h=e.getBBox();if(h){var l=e.getAttribute("x"),c=e.getAttribute("y"),d=t.pos.getp(!0),f=Math.PI,u=d.theta>f/2&&d.theta<3*f/2;u?(e.setAttribute("x",l-h.width),e.setAttribute("y",c-h.height)):t.id==a.root&&e.setAttribute("x",l-h.width/2);var g=u?d.theta+f:d.theta;t._depth&&e.setAttribute("transform","rotate("+360*g/(2*f)+" "+l+" "+c+")")}i.onPlaceLabel(e,t)}}),i.Label.HTML=new t({Implements:v.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.clone(),a=this.viz.canvas,o=t.getData("height"),s=(o||0==t._depth?o:this.viz.config.levelDistance)/2,r=a.getSize();n.rho+=s,n=n.getc(!0);var h={x:Math.round(n.x+r.width/2),y:Math.round(n.y+r.height/2)},l=e.style;l.left=h.x+"px",l.top=h.y+"px",l.display=this.fitsInCanvas(h,a)?"":"none",i.onPlaceLabel(e,t)}}),i.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(!1),anglecontains:function(e,t){var i=e.getData("span")/2,n=e.pos.theta,a=n-i,o=n+i;0>a&&(a+=2*Math.PI);var s=Math.atan2(t.y,t.x);return 0>s&&(s+=2*Math.PI),a>o?s>a&&s<=2*Math.PI||o>s:s>a&&o>s}},pie:{render:function(e,t){var i=e.getData("span")/2,n=e.pos.theta,a=n-i,o=n+i,s=e.pos.getp(!0),r=new d(s.rho,a),h=r.getc(!0);r.theta=o;var l=r.getc(!0),c=t.getCtx();c.beginPath(),c.moveTo(0,0),c.lineTo(h.x,h.y),c.moveTo(0,0),c.lineTo(l.x,l.y),c.moveTo(0,0),c.arc(0,0,s.rho*e.getData("dim-quotient"),a,o,!1),c.fill()},contains:function(e,t){if(this.nodeTypes.none.anglecontains.call(this,e,t)){var i=Math.sqrt(t.x*t.x+t.y*t.y),n=this.config.levelDistance,a=e._depth;return n*a>=i}return!1}},multipie:{render:function(e,t){var i=e.getData("height"),n=i?i:this.config.levelDistance,a=e.getData("span")/2,o=e.pos.theta,s=o-a,r=o+a,h=e.pos.getp(!0),l=new d(h.rho,s),c=l.getc(!0);l.theta=r;var f=l.getc(!0);l.rho+=n;var u=l.getc(!0);l.theta=s;var g=l.getc(!0),p=t.getCtx();p.moveTo(0,0),p.beginPath(),p.arc(0,0,h.rho,s,r,!1),p.arc(0,0,h.rho+n,r,s,!0),p.moveTo(c.x,c.y),p.lineTo(g.x,g.y),p.moveTo(f.x,f.y),p.lineTo(u.x,u.y),p.fill(),e.collapsed&&(p.save(),p.lineWidth=2,p.moveTo(0,0),p.beginPath(),p.arc(0,0,h.rho+n+5,r-.01,s+.01,!0),p.stroke(),p.restore())},contains:function(e,t){if(this.nodeTypes.none.anglecontains.call(this,e,t)){var i=Math.sqrt(t.x*t.x+t.y*t.y),n=e.getData("height"),a=n?n:this.config.levelDistance,o=this.config.levelDistance,s=e._depth;return i>=o*s&&o*s+a>=i}return!1}},"gradient-multipie":{render:function(t,i){var n=i.getCtx(),a=t.getData("height"),o=a?a:this.config.levelDistance,s=n.createRadialGradient(0,0,t.getPos().rho,0,0,t.getPos().rho+o),r=e.hexToRgb(t.getData("color")),h=[];e.each(r,function(e){h.push(parseInt(.5*e,10))});var l=e.rgbToHex(h);s.addColorStop(0,l),s.addColorStop(1,t.getData("color")),n.fillStyle=s,this.nodeTypes.multipie.render.call(this,t,i)},contains:function(e,t){return this.nodeTypes.multipie.contains.call(this,e,t)}},"gradient-pie":{render:function(t,i){var n=i.getCtx(),a=n.createRadialGradient(0,0,0,0,0,t.getPos().rho),o=e.hexToRgb(t.getData("color")),s=[];e.each(o,function(e){s.push(parseInt(.5*e,10))});var r=e.rgbToHex(s);a.addColorStop(1,r),a.addColorStop(0,t.getData("color")),n.fillStyle=a,this.nodeTypes.pie.render.call(this,t,i)},contains:function(e,t){return this.nodeTypes.pie.contains.call(this,e,t)}}}),i.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);this.edgeHelper.line.render(i,n,t)},contains:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(i,n,t,this.edge.epsilon)}},arrow:{render:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0),a=e.getData("dim"),o=e.data.$direction,s=o&&o.length>1&&o[0]!=e.nodeFrom.id;this.edgeHelper.arrow.render(i,n,a,s,t)},contains:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(i,n,t,this.edge.epsilon)}},hyperline:{render:function(e,t){var i=e.nodeFrom.pos.getc(),n=e.nodeTo.pos.getc(),a=Math.max(i.norm(),n.norm());this.edgeHelper.hyperline.render(i.$scale(1/a),n.$scale(1/a),a,t)},contains:e.lambda(!1)}})}($jit.Sunburst),$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(t,i){var n=(t.pos.getp(!0),t.getData("dimArray")),a=t.getData("valueArray"),o=t.getData("colorArray"),s=o.length,r=t.getData("stringArray"),h=t.getData("span")/2,l=t.pos.theta,c=l-h,f=l+h,u=new d,g=i.getCtx(),p={},v=t.getData("gradient"),m=t.getData("border"),y=t.getData("config"),b=y.showLabels,x=y.resizeLabels,w=y.Label,D=y.sliceOffset*Math.cos((c+f)/2),N=y.sliceOffset*Math.sin((c+f)/2);if(o&&n&&r){for(var C=0,L=n.length,T=0,A=0;L>C;C++){var S=n[C],M=o[C%s];if(!(0>=S)){if(g.fillStyle=g.strokeStyle=M,v&&S){var z=g.createRadialGradient(D,N,T+y.sliceOffset,D,N,T+S+y.sliceOffset),O=e.hexToRgb(M),P=e.map(O,function(e){return.8*e>>0}),E=e.rgbToHex(P);z.addColorStop(0,M),z.addColorStop(.5,M),z.addColorStop(1,E),g.fillStyle=z}u.rho=T+y.sliceOffset,u.theta=c;u.getc(!0);u.theta=f;u.getc(!0);u.rho+=S;u.getc(!0);u.theta=c;u.getc(!0);g.beginPath(),g.arc(D,N,T+.01,c,f,!1),g.arc(D,N,T+S+.01,f,c,!0),g.fill(),m&&m.name==r[C]&&(p.acum=T,p.dimValue=n[C],p.begin=c,p.end=f),T+=S||0,A+=a[C]||0}}if(m){g.save(),g.globalCompositeOperation="source-over",g.lineWidth=2,g.strokeStyle=m.color;g.beginPath(),g.arc(D,N,p.acum+.01+1,p.begin,p.end,!1),g.arc(D,N,p.acum+p.dimValue+.01-1,p.end,p.begin,!0),g.closePath(),g.stroke(),g.restore()}if(b&&"Native"==w.type){g.save(),g.fillStyle=g.strokeStyle=w.color;var $=x?t.getData("normalizedDim"):1,I=w.size*$>>0;I=+x>I?+x:I,g.font=w.style+" "+I+"px "+w.family,g.textBaseline="middle",g.textAlign="center",u.rho=T+y.labelOffset+y.sliceOffset,u.theta=t.pos.theta;var _=u.getc(!0);g.fillText(t.name,_.x,_.y),g.restore()}}},contains:function(e,t){if(this.nodeTypes.none.anglecontains.call(this,e,t)){var i=Math.sqrt(t.x*t.x+t.y*t.y),n=this.config.levelDistance,a=e._depth,o=e.getData("config");if(i<=n*a+o.sliceOffset)for(var s=e.getData("dimArray"),r=0,h=s.length,l=o.sliceOffset;h>r;r++){var c=s[r];if(i>=l&&l+c>=i)return{name:e.getData("stringArray")[r],color:e.getData("colorArray")[r],value:e.getData("valueArray")[r],label:e.name};l+=c}return!1}return!1}}}),$jit.PieChart=new t({sb:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:!1,initialize:function(t){this.controller=this.config=e.merge(a("Canvas","PieChart","Label"),{Label:{type:"Native"}},t),this.initializeViz()},initializeViz:function(){var e=this.config,t=this,i=e.type.split(":")[0],n=new $jit.Sunburst({injectInto:e.injectInto,width:e.width,height:e.height,useCanvas:e.useCanvas,withLabels:"Native"!=e.Label.type,Label:{type:e.Label.type},Node:{overridable:!0,type:"piechart-"+i,width:1,height:1},Edge:{type:"none"},Tips:{enable:e.Tips.enable,type:"Native",force:!0,onShow:function(t,i,n){var a=n;e.Tips.onShow(t,a,i)}},Events:{enable:!0,type:"Native",onClick:function(t,i,n){if(e.Events.enable){var a=i.getContains();e.Events.onClick(a,i,n)}},onMouseMove:function(i,n,a){if(e.hoveredColor)if(i){var o=n.getContains();t.select(i.id,o.name,o.index)}else t.select(!1,!1,!1)}},onCreateLabel:function(t,i){var n=e.Label;if(e.showLabels){var a=t.style;a.fontSize=n.size+"px",a.fontFamily=n.family,a.color=n.color,a.textAlign="center",t.innerHTML=i.name}},onPlaceLabel:function(i,n){if(e.showLabels){var a=n.pos.getp(!0),o=n.getData("dimArray"),s=n.getData("span")/2,r=n.pos.theta,h=r-s,l=r+s,c=new d,f=(e.showLabels,e.resizeLabels),u=e.Label;if(o){for(var g=0,p=o.length,v=0;p>g;g++)v+=o[g];var m=f?n.getData("normalizedDim"):1,y=u.size*m>>0;y=+f>y?+f:y,i.style.fontSize=y+"px",c.rho=v+e.labelOffset+e.sliceOffset,c.theta=(h+l)/2;var a=c.getc(!0),b=t.canvas.getSize(),x={x:Math.round(a.x+b.width/2),y:Math.round(a.y+b.height/2)};i.style.left=x.x+"px",i.style.top=x.y+"px"}}}}),a=n.canvas.getSize(),o=Math.min;n.config.levelDistance=o(a.width,a.height)/2-e.offset-e.sliceOffset,this.delegate=n,this.canvas=this.delegate.canvas,this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(t){for(var i=e.time(),n=[],a=this.delegate,o=e.splat(t.label),s=o.length,r=e.splat(t.color||this.colors),h=r.length,l=this.config,c=!!l.type.split(":")[1],d=l.animate,f=1==s,u=0,g=t.values,p=g.length;p>u;u++){var v=g[u],m=e.splat(v.values);n.push({id:i+v.label,name:v.label,data:{value:m,$valueArray:m,$colorArray:f?e.splat(r[u%h]):r,$stringArray:o,$gradient:c,$config:l,$angularWidth:e.reduce(m,function(e,t){return e+t})},children:[]})}var y={id:i+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:n};a.loadJSON(y),this.normalizeDims(),a.refresh(),d&&a.fx.animate({modes:["node-property:dimArray"],duration:1500})},updateJSON:function(t,i){if(!this.busy){this.busy=!0;var n=this.delegate,a=n.graph,o=t.values,s=this.config.animate,r=this;e.each(o,function(i){var n=a.getByName(i.label),o=e.splat(i.values);n&&(n.setData("valueArray",o),n.setData("angularWidth",e.reduce(o,function(e,t){return e+t})),t.label&&n.setData("stringArray",e.splat(t.label)))}),this.normalizeDims(),s?(n.compute("end"),n.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){r.busy=!1,i&&i.onComplete()}})):n.refresh()}},select:function(e,t){if(this.config.hoveredColor){var i=this.selected;(i.id!=e||i.name!=t)&&(i.id=e,i.name=t,i.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(t){e==t.id?t.setData("border",i):t.setData("border",!1)}),this.delegate.plot())}},getLegend:function(){var t,i={};this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(e){t=e.nodeTo});var n=t.getData("colorArray"),a=n.length;return e.each(t.getData("stringArray"),function(e,t){i[e]=n[t%a]}),i},getMaxValue:function(){var t=0;return this.delegate.graph.eachNode(function(i){var n=i.getData("valueArray"),a=0;e.each(n,function(e){a+=+e}),t=t>a?t:a}),t},normalizeDims:function(){var t=this.delegate.graph.getNode(this.delegate.root),i=0;t.eachAdjacency(function(){i++});var n=this.getMaxValue()||1,a=this.config,o=a.animate,s=this.delegate.config.levelDistance;this.delegate.graph.eachNode(function(t){var i=0,r=[];e.each(t.getData("valueArray"),function(e){i+=+e,r.push(1)});var h=1==r.length&&!a.updateHeights;if(o){t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return h?s:e*s/n}),"end");var l=t.getData("dimArray");l||t.setData("dimArray",r)}else t.setData("dimArray",e.map(t.getData("valueArray"),function(e){return h?s:e*s/n}));t.setData("normalizedDim",i/n)})}}),x.TM={},x.TM.SliceAndDice=new t({compute:function(e){var t=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(t);var i=this.canvas.getSize(),n=this.config,a=i.width,o=i.height;this.graph.computeLevels(this.root,0,"ignore"),t.getPos(e).setc(-a/2,-o/2),t.setData("width",a,e),t.setData("height",o+n.titleHeight,e),this.computePositions(t,t,this.layout.orientation,e),this.controller.onAfterCompute(t)},computePositions:function(e,t,i,n){var a=0;e.eachSubnode(function(e){a+=e.getData("area",n)});var o,s,r,h,l,c,d,f=this.config,u=(f.offset,e.getData("width",n)),g=Math.max(e.getData("height",n)-f.titleHeight,0),p=e==t?1:t.getData("area",n)/a,v="h"==i;v?(i="v",o=g,s=u*p,r="height",h="y",l="x",c=f.titleHeight,d=0):(i="h",o=g*p,s=u,r="width",h="x",l="y",c=0,d=f.titleHeight);var m=t.getPos(n);t.setData("width",s,n),t.setData("height",o,n);var y=0,b=this;t.eachSubnode(function(e){var a=e.getPos(n);a[h]=y+m[h]+c,a[l]=m[l]+d,b.computePositions(t,e,i,n),y+=e.getData(r,n)})}}),x.TM.Area={compute:function(e){e=e||"current";var t=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(t);var i=this.config,n=this.canvas.getSize(),a=n.width,o=n.height,s=i.offset,r=a-s,h=o-s;this.graph.computeLevels(this.root,0,"ignore"),t.getPos(e).setc(-a/2,-o/2),t.setData("width",a,e),t.setData("height",o,e);var l={top:-o/2+i.titleHeight+s/2,left:-a/2+s/2,width:r,height:h-i.titleHeight};this.computePositions(t,l,e),this.controller.onAfterCompute(t)},computeDim:function(e,t,i,n,a,o){if(e.length+t.length==1){var s=1==e.length?e:t;return void this.layoutLast(s,i,n,o)}if(e.length>=2&&0==t.length&&(t=[e.shift()]),0==e.length)return void(t.length>0&&this.layoutRow(t,i,n,o));var r=e[0];if(a(t,i)>=a([r].concat(t),i))this.computeDim(e.slice(1),t.concat([r]),i,n,a,o);else{var h=this.layoutRow(t,i,n,o);this.computeDim(e,[],h.dim,h,a,o)}},worstAspectRatio:function(e,t){if(!e||0==e.length)return Number.MAX_VALUE;for(var i=0,n=0,a=Number.MAX_VALUE,o=0,s=e.length;s>o;o++){var r=e[o]._area;i+=r,a=r>a?a:r,n=n>r?n:r}var h=t*t,l=i*i;return Math.max(h*n/l,l/(h*a))},avgAspectRatio:function(e,t){if(!e||0==e.length)return Number.MAX_VALUE;for(var i=0,n=0,a=e.length;a>n;n++){var o=e[n]._area,s=o/t;i+=t>s?t/s:s/t}return i/a},layoutLast:function(e,t,i,n){var a=e[0];a.getPos(n).setc(i.left,i.top),a.setData("width",i.width,n),a.setData("height",i.height,n)}},x.TM.Squarified=new t({Implements:x.TM.Area,computePositions:function(e,t,i){var n=this.config,a=Math.max;t.width>=t.height?this.layout.orientation="h":this.layout.orientation="v";var o=e.getSubnodes([1,1],"ignore");if(o.length>0){this.processChildrenLayout(e,o,t,i);for(var s=0,r=o.length;r>s;s++){var h=o[s],l=n.offset,c=a(h.getData("height",i)-l-n.titleHeight,0),d=a(h.getData("width",i)-l,0),f=h.getPos(i);t={width:d,height:c,top:f.y+n.titleHeight+l/2,left:f.x+l/2},this.computePositions(h,t,i)}}},processChildrenLayout:function(e,t,i,n){var a,o=i.width*i.height,s=t.length,r=0,h=[];for(a=0;s>a;a++)h[a]=parseFloat(t[a].getData("area",n)),r+=h[a];for(a=0;s>a;a++)t[a]._area=o*h[a]/r;var l=this.layout.horizontal()?i.height:i.width;t.sort(function(e,t){var i=t._area-e._area;return i?i:t.id==e.id?0:t.id<e.id?1:-1});var c=[t[0]],d=t.slice(1);this.squarify(d,c,l,i,n)},squarify:function(e,t,i,n,a){this.computeDim(e,t,i,n,this.worstAspectRatio,a)},layoutRow:function(e,t,i,n){return this.layout.horizontal()?this.layoutV(e,t,i,n):this.layoutH(e,t,i,n)},layoutV:function(t,i,n,a){var o=0,s=function(e){return e};e.each(t,function(e){o+=e._area});for(var r=s(o/i)||0,h=0,l=0,c=t.length;c>l;l++){var d=s(t[l]._area/r)||0,f=t[l];f.getPos(a).setc(n.left,n.top+h),f.setData("width",r,a),f.setData("height",d,a),h+=d}var u={height:n.height,width:n.width-r,top:n.top,left:n.left+r};return u.dim=Math.min(u.width,u.height),u.dim!=u.height&&this.layout.change(),u},layoutH:function(t,i,n,a){var o=0;e.each(t,function(e){o+=e._area});for(var s=o/i||0,r=n.top,h=0,l=0,c=t.length;c>l;l++){var d=t[l],i=d._area/s||0;d.getPos(a).setc(n.left+h,r),d.setData("width",i,a),d.setData("height",s,a),h+=i}var f={height:n.height-s,width:n.width,top:n.top+s,left:n.left};return f.dim=Math.min(f.width,f.height),f.dim!=f.width&&this.layout.change(),f}}),x.TM.Strip=new t({Implements:x.TM.Area,computePositions:function(e,t,i){var n=e.getSubnodes([1,1],"ignore"),a=this.config,o=Math.max;if(n.length>0){this.processChildrenLayout(e,n,t,i);for(var s=0,r=n.length;r>s;s++){var h=n[s],l=a.offset,c=o(h.getData("height",i)-l-a.titleHeight,0),d=o(h.getData("width",i)-l,0),f=h.getPos(i);t={width:d,height:c,top:f.y+a.titleHeight+l/2,left:f.x+l/2},this.computePositions(h,t,i)}}},processChildrenLayout:function(e,t,i,n){var a,o=i.width*i.height,s=t.length,r=0,h=[];for(a=0;s>a;a++)h[a]=+t[a].getData("area",n),r+=h[a];for(a=0;s>a;a++)t[a]._area=o*h[a]/r;var l=this.layout.horizontal()?i.width:i.height,c=[t[0]],d=t.slice(1);this.stripify(d,c,l,i,n)},stripify:function(e,t,i,n,a){this.computeDim(e,t,i,n,this.avgAspectRatio,a)},layoutRow:function(e,t,i,n){return this.layout.horizontal()?this.layoutH(e,t,i,n):this.layoutV(e,t,i,n)},layoutV:function(t,i,n,a){var o=0;e.each(t,function(e){o+=e._area});for(var s=o/i||0,r=0,h=0,l=t.length;l>h;h++){var c=t[h],d=c._area/s||0;c.getPos(a).setc(n.left,n.top+(i-d-r)),c.setData("width",s,a),c.setData("height",d,a),r+=d}return{height:n.height,width:n.width-s,top:n.top,left:n.left+s,dim:i}},layoutH:function(t,i,n,a){var o=0;e.each(t,function(e){o+=e._area});for(var s=o/i||0,r=n.height-s,h=0,l=0,c=t.length;c>l;l++){var d=t[l],f=d._area/s||0;d.getPos(a).setc(n.left+h,n.top+r),d.setData("width",f,a),d.setData("height",s,a),h+=f}return{height:n.height-s,width:n.width,top:n.top,left:n.left,dim:i}}}),x.TM.Voronoi=new t({Implements:x.TM.Area,compute:function(e){this.controller.onBeforeCompute(t);var t=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root),i=this.canvas.getSize(),n=this.config,a=n.offset,o=i.width,s=i.height;this.graph.computeLevels(this.root,0,0),t.getPos(e).setc(-5,-5),t.histoPos||(t.histoPos=[]),t.histoPos[0]=g(0,0);var r=[g(.5*-o,.5*-s),g(.5*o,.5*-s),g(.5*o,.5*s),g(.5*-o,.5*s)];r=Geometry.offsetConvex(r,.5*-a),t.setData("vertices",r,e),t.setData("width",0,e),t.setData("height",0,e),r=Geometry.offsetConvex(r,1.5*-a),this.computePositions(t,r,e,0),this.controller.onAfterCompute(t)},computePositions:function(e,t,i,n){var a,o,s=this,r=e.getSubnodes([1,1],"ignore"),h=this.config,l=h.offset,d=e.histoPos[n]||c(0,0);e.setData("width",0,i),e.setData("height",0,i),e.getPos(i).setc(d.x,d.y),r.length>0&&(r[0].histoPos&&r[0].histoPos[n+1]||(a=$jit.util.map(r,function(e){var i=Geometry.randPointInPolygon(t);return e.data&&e.data.$area&&(i.area=e.data.$area),i}),a=s[s.config.centroidType](a,t),$jit.util.each(a,function(e,t){r[t].histoPos||(r[t].histoPos=[]),r[t].histoPos[n+1]=e})),a=$jit.util.map(r,function(e){return e.histoPos[n+1]}),o=Geometry.voronoi(a,t),$jit.util.each(r,function(e,t){var a=o[t],r=a.slice(0);Geometry.area(a)<0&&a.reverse(),l&&(r=Geometry.offsetConvex(a,2*-l),a=Geometry.offsetConvex(a,.5*-l),e.offset=l),e.setData("vertices",a,i),s.computePositions(e,r,i,n+1)}))},centroid:function(e,t){for(var i,n=2;n>.001;)i=Geometry.voronoi(e,t),n=0,e=i.map(function(t,i){var a=Geometry.centroid(t);return n+=Geometry.dist2(a,e[i]),a});return e},doLayoutPressure:function(){var e=this,t=e.graph.getNode(e.clickedNode&&e.clickedNode.id||e.root);t.eachNode(function(){})},weightedCentroid:function(t,i){var n,a,o=[],s=2,r=Geometry.area(i),h=0;e.each(t,function(e,t){h+=e.area}),a=r/h,n=Geometry.voronoi(t,i),e.each(n,function(e,i){o[i]=t[i].area*a/Geometry.area(e)});var l=0,c=0;for(e.each(o,function(e,t){l+=e,c+=e*e}),console.log("from "+(c-l*l/o.length)/o.length);s>.001;)n=Geometry.voronoi(t,i),e.each(n,function(e,i){o[i]=t[i].area*a/Geometry.area(e)}),s=0,t=n.map(function(i,n){var a=g(0,0),r=0;return e.each(i,function(e,s){var h=[t[n],e,i[s+1]||i[0]],l=e.attached?o[e.attached[0]]:1,c=Geometry.area(h)*Math.exp(2*(o[n]-l));r+=c,a.$add(e.add(h[2]).scale(.5*c))}),a.$scale(1/r),a.area=t[n].area,s+=Geometry.dist(a,t[n]),a});var l=0,c=0;return e.each(o,function(e,t){l+=e,c+=e*e}),console.log("to "+(c-l*l/o.length)/o.length),t},byArea:function(e,t){e=this.centroid(e,t);var i,n,i,a=0,o=0;for($jit.util.each(e,function(e){a+=e.area}),a=Geometry.area(t)/a;100>o;o++){i=Geometry.voronoi(e,t);for(var s=0;s<e.length;s++)if(0==i[s].length){e=i.map(function(e,t){return Geometry.centroid(e)});break}n=i.map(function(e,t){return e.area*a/(Geometry.area(e)+1e-10)}),i=Geometry.voronoi(e,t),e=i.map(function(t,i){var a,o=g(e[i].x,e[i].y);return o.area=e[i].area,a=g(0,0),$jit.util.each(t,function(e,o){var s=(e.attached?e.attached:-1,e.attached?n[e.attached[0]]:1),r=e,h=t[o+1]||t[0],l=n[i]-s,c=h.x-r.x,d=h.y-r.y;
a.x+=d*l,a.y-=c*l}),o.x+=a.x/10,o.y+=a.y/10,o.tp=a,o})}return e}}),x.Icicle=new t({compute:function(e){e=e||"current";var t=this.graph.getNode(this.root),i=this.config,n=this.canvas.getSize(),a=n.width,o=n.height,s=(i.offset,i.constrained?i.levelsToShow:Number.MAX_VALUE);this.controller.onBeforeCompute(t),v.Util.computeLevels(this.graph,t.id,0,"ignore");var r=0;v.Util.eachLevel(t,0,!1,function(e,t){t>r&&(r=t)});var h=this.graph.getNode(this.clickedNode&&this.clickedNode.id||t.id),l=Math.min(r,s-1),c=h._depth;this.layout.horizontal()?this.computeSubtree(h,-a/2,-o/2,a/(l+1),o,c,l,e):this.computeSubtree(h,-a/2,-o/2,a,o/(l+1),c,l,e)},computeSubtree:function(t,i,n,a,o,s,r,h){t.getPos(h).setc(i,n),t.setData("width",a,h),t.setData("height",o,h);var l,c=0,d=v.Util.getSubnodes(t,[1,1],"ignore");if(d.length){e.each(d,function(e){c+=e.getData("dim")});for(var f=0,u=d.length;u>f;f++)this.layout.horizontal()?(l=o*d[f].getData("dim")/c,this.computeSubtree(d[f],i+a,n,a,l,s,r,h),n+=l):(l=a*d[f].getData("dim")/c,this.computeSubtree(d[f],i,n+o,l,o,s,r,h),i+=l)}}}),$jit.Icicle=new t({Implements:[b,h,x.Icicle],layout:{orientation:"h",vertical:function(){return"v"==this.orientation},horizontal:function(){return"h"==this.orientation},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(t){var i={animate:!1,orientation:"h",offset:2,levelsToShow:Number.MAX_VALUE,constrained:!1,Node:{type:"rectangle",overridable:!0},Edge:{type:"none"},Label:{type:"Native"},duration:700,fps:45},n=a("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label");this.controller=this.config=e.merge(n,i,t),this.layout.orientation=this.config.orientation;var o=this.config;o.useCanvas?(this.canvas=o.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(this.canvas=new l(this,o),this.config.labelContainer=("string"==typeof o.injectInto?o.injectInto:o.injectInto.id)+"-label"),this.graphOptions={klass:u,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new v(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label),this.labels=new $jit.Icicle.Label[this.config.Label.type](this),this.fx=new $jit.Icicle.Plot(this,$jit.Icicle),this.op=new $jit.Icicle.Op(this),this.group=new $jit.Icicle.Group(this),this.clickedNode=null,this.initializeExtras()},refresh:function(){var e=this.config.Label.type;if("Native"!=e){var t=this;this.graph.eachNode(function(e){t.labels.hideLabel(e,!1)})}this.compute(),this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(e){if(!this.busy){this.busy=!0;var t=this,i=this.config,n={onComplete:function(){i.request&&t.compute(),i.animate?(t.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]}),v.Util.eachSubgraph(e,function(e){e.setData("alpha",1,"end")},"ignore"),t.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){t.clickedNode=e,t.compute("end"),t.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){t.busy=!1,t.clickedNode=e}})}})):(t.clickedNode=e,t.busy=!1,t.refresh())}};i.request?this.requestNodes(e,n):n.onComplete()}},out:function(){if(!this.busy){var e,t=this,i=v.Util,n=this.config,a=this.graph,o=i.getParents(a.getNode(this.clickedNode&&this.clickedNode.id||this.root)),s=o[0],r=s,h=this.clickedNode;if(this.busy=!0,this.events.hoveredNode=!1,!s)return void(this.busy=!1);e={onComplete:function(){t.clickedNode=s,n.request?t.requestNodes(s,{onComplete:function(){t.compute(),t.plot(),t.busy=!1}}):(t.compute(),t.plot(),t.busy=!1)}},n.animate?(this.clickedNode=r,this.compute("end"),this.clickedNode=h,this.fx.animate({modes:["linear","node-property:width:height"],duration:1e3,onComplete:function(){t.clickedNode=r,a.nodeList.setDataset(["current","end"],{alpha:[0,1]}),i.eachSubgraph(h,function(e){e.setData("alpha",1)},"ignore"),t.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){e.onComplete()}})}})):e.onComplete()}},requestNodes:function(t,i){var n=e.merge(this.controller,i),a=this.config.constrained?this.config.levelsToShow:Number.MAX_VALUE;if(n.request){var o=[],s=t._depth;v.Util.eachLevel(t,0,a,function(e){e.drawn&&!v.Util.anySubnode(e)&&(o.push(e),e._level=e._depth-s)}),this.group.requestNodes(o,n)}else n.onComplete()}}),$jit.Icicle.Op=new t({Implements:v.Op}),$jit.Icicle.Group=new t({initialize:function(e){this.viz=e,this.canvas=e.canvas,this.config=e.config},requestNodes:function(e,t){var i=0,n=e.length,a={},o=function(){t.onComplete()},s=this.viz;0==n&&o();for(var r=0;n>r;r++)a[e[r].id]=e[r],t.request(e[r].id,e[r]._level,{onComplete:function(e,t){t&&t.children&&(t.id=e,s.op.sum(t,{type:"nothing"})),++i==n&&(v.Util.computeLevels(s.graph,s.root,0),o())}})}}),$jit.Icicle.Plot=new t({Implements:v.Plot,plot:function(t,i){t=t||this.viz.controller;var n=this.viz,a=n.graph,o=a.getNode(n.clickedNode&&n.clickedNode.id||n.root),s=o._depth;n.canvas.clear(),this.plotTree(o,e.merge(t,{withLabels:!0,hideLabels:!1,plotSubtree:function(e,t){return!n.config.constrained||t._depth-s<n.config.levelsToShow}}),i)}}),$jit.Icicle.Label={},$jit.Icicle.Label.Native=new t({Implements:v.Label.Native,renderLabel:function(e,t,i){var n=e.getCtx(),a=t.getData("width"),o=t.getData("height"),s=t.getLabelData("size"),r=n.measureText(t.name);if(!(1.5*s>o||a<r.width)){var h=t.pos.getc(!0);n.fillText(t.name,h.x+a/2,h.y+o/2)}}}),$jit.Icicle.Label.SVG=new t({Implements:v.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz.canvas,o=a.getSize(),s={x:Math.round(n.x+o.width/2),y:Math.round(n.y+o.height/2)};e.setAttribute("x",s.x),e.setAttribute("y",s.y),i.onPlaceLabel(e,t)}}),$jit.Icicle.Label.HTML=new t({Implements:v.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz.canvas,o=a.getSize(),s={x:Math.round(n.x+o.width/2),y:Math.round(n.y+o.height/2)},r=e.style;r.left=s.x+"px",r.top=s.y+"px",r.display="",i.onPlaceLabel(e,t)}}),$jit.Icicle.Plot.NodeTypes=new t({none:{render:e.empty},rectangle:{render:function(t,i,n){var a=this.viz.config,o=a.offset,s=t.getData("width"),r=t.getData("height"),h=t.getData("border"),l=t.pos.getc(!0),c=l.x+o/2,d=l.y+o/2,f=i.getCtx();if(!(2>s-o||2>r-o)){if(a.cushion){var u=t.getData("color"),g=f.createRadialGradient(c+(s-o)/2,d+(r-o)/2,1,c+(s-o)/2,d+(r-o)/2,r>s?r:s),p=e.rgbToHex(e.map(e.hexToRgb(u),function(e){return.3*e>>0}));g.addColorStop(0,u),g.addColorStop(1,p),f.fillStyle=g}h&&(f.strokeStyle=h,f.lineWidth=3),f.fillRect(c,d,Math.max(0,s-o),Math.max(0,r-o)),h&&f.strokeRect(l.x,l.y,s,r)}},contains:function(e,t){if(this.viz.clickedNode&&!$jit.Graph.Util.isDescendantOf(e,this.viz.clickedNode.id))return!1;var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");return this.nodeHelper.rectangle.contains({x:i.x+n/2,y:i.y+a/2},t,n,a)}}}),$jit.Icicle.Plot.EdgeTypes=new t({none:e.empty}),QuadTreeNode=new t({com:[0,0],children:[null,null,null,null],hasChildren:!1,mass:null,fItem:null}),QuadTreeNodeFactory=new t({maxNodes:5e4,nodes:null,setup:function(){this.nodes=new Array},getQuadTreeNode:function(){return this.nodes.length>0?this.nodes.pop():new QuadTreeNode},reclaim:function(e){e.mass=0,e.com[0]=0,e.com[1]=0,e.fItem=null,e.hasChildren=!1,e.children=[null,null,null,null],this.nodes.length<this.maxNodes&&this.nodes.push(e)}}),NBodyForce=new t({pnames:["GravitationalConstant","Distance","BarnesHutTheta"],DEFAULT_GRAV_CONSTANT:-1,DEFAULT_MIN_GRAV_CONSTANT:-10,DEFAULT_MAX_GRAV_CONSTANT:10,DEFAULT_DISTANCE:-1,DEFAULT_MIN_DISTANCE:-1,DEFAULT_MAX_DISTANCE:500,DEFAULT_THETA:.9,DEFAULT_MIN_THETA:0,DEFAULT_MAX_THETA:1,GRAVITATIONAL_CONST:0,MIN_DISTANCE:1,BARNES_HUT_THETA:2,xMin:null,xMax:null,yMin:null,yMax:null,params:null,minValues:null,maxValues:null,factory:null,root:null,setup:function(){this.params=[this.DEFAULT_GRAV_CONSTANT,this.DEFAULT_DISTANCE,this.DEFAULT_THETA],this.minValues=[this.DEFAULT_MIN_GRAV_CONSTANT,this.DEFAULT_MIN_DISTANCE,this.DEFAULT_MIN_THETA],this.maxValues=[this.DEFAULT_MAX_GRAV_CONSTANT,this.DEFAULT_MAX_DISTANCE,this.DEFAULT_MAX_THETA],this.factory=new QuadTreeNodeFactory,this.factory.setup(),this.root=this.factory.getQuadTreeNode()},setBounds:function(e,t,i,n){this.xMin=e,this.yMin=t,this.xMax=i,this.yMax=n},insertHelper:function(e,t,i,n,a,o){var s=e.location[0],r=e.location[1],h=(i+a)/2,l=(n+o)/2,c=(s>=h?1:0)+(r>=l?2:0);null==t.children[c]&&(t.children[c]=this.factory.getQuadTreeNode(),t.hasChildren=!0),1==c||3==c?i=h:a=h,c>1?n=l:o=l,this.insert(e,t.children[c],i,n,a,o)},isSameLocation:function(e,t){var i=Math.abs(e.location[0]-t.location[0]),n=Math.abs(e.location[1]-t.location[1]);return.01>i&&.01>n},insert:function(e,t,i,n,a,o){if(t.hasChildren)this.insertHelper(e,t,i,n,a,o);else if(null!=t.fItem)if(this.isSameLocation(t.fItem,e))this.insertHelper(e,t,i,n,a,o);else{var s=t.fItem;t.fItem=null,this.insertHelper(s,t,i,n,a,o),this.insertHelper(e,t,i,n,a,o)}else t.fItem=e},calcMass:function(e){var t=0,i=0;if(e.mass=0,e.hasChildren)for(var n=0;n<e.children.length;n++)null!=e.children[n]&&(this.calcMass(e.children[n]),e.mass+=e.children[n].mass,t+=e.children[n].mass*e.children[n].com[0],i+=e.children[n].mass*e.children[n].com[1]);null!=e.fItem&&(e.mass+=e.fItem.mass,t+=e.fItem.mass*e.fItem.location[0],i+=e.fItem.mass*e.fItem.location[1]),e.com[0]=t/e.mass,e.com[1]=i/e.mass},insertRoot:function(e){this.insert(e,this.root,this.xMin,this.yMin,this.xMax,this.yMax)},clearHelper:function(e){for(var t=0;t<e.children.length;t++)null!=e.children[t]&&this.clearHelper(e.children[t]);this.factory.reclaim(e)},clear:function(){this.clearHelper(this.root),this.root=this.factory.getQuadTreeNode()},init:function(e){this.clear();for(var t=Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MIN_VALUE,a=Number.MIN_VALUE,o=0;o<e.items.length;o++){var s=e.items[o].location[0],r=e.items[o].location[1];t>s&&(t=s),i>r&&(i=r),s>n&&(n=s),r>a&&(a=r)}var h=n-t,l=a-i;h>l?a=i+h:n=t+l,this.setBounds(t,i,n,a);for(var o=0;o<e.items.length;o++)this.insertRoot(e.items[o]);this.calcMass(this.root)},getForce:function(e){this.forceHelper(e,this.root,this.xMin,this.yMin,this.xMax,this.yMax)},forceHelper:function(e,t,i,n,a,o){var s=t.com[0]-e.location[0],r=t.com[1]-e.location[1],h=Math.sqrt(s*s+r*r),l=!1;0==h&&(s=(Math.random()-.5)/50,r=(Math.random()-.5)/50,h=Math.sqrt(s*s+r*r),l=!0);var c=this.params[this.MIN_DISTANCE]>0&&h>this.params[this.MIN_DISTANCE];if(!t.hasChildren&&t.fItem!=e||!l&&(a-i)/h<this.params[this.BARNES_HUT_THETA]){if(c)return;var d=this.params[this.GRAVITATIONAL_CONST]*e.mass*t.mass/(h*h*h);e.force[0]+=d*s,e.force[1]+=d*r}else if(t.hasChildren){for(var f=(i+a)/2,u=(n+o)/2,g=0;g<t.children.length;g++)null!=t.children[g]&&this.forceHelper(e,t.children[g],1==g||3==g?f:i,g>1?u:n,1==g||3==g?a:f,g>1?o:u);if(c)return;if(null!=t.fItem&&t.fItem!=e){var d=this.params[this.GRAVITATIONAL_CONST]*e.mass*t.fItem.mass/(h*h*h);e.force[0]+=d*s,e.force[1]+=d*r}}}}),SpringForce=new t({pnames:["SpringCoefficient","DefaultSpringLength"],DEFAULT_SPRING_COEFF:1e-4,DEFAULT_MAX_SPRING_COEFF:.001,DEFAULT_MIN_SPRING_COEFF:1e-5,DEFAULT_SPRING_LENGTH:50,DEFAULT_MIN_SPRING_LENGTH:0,DEFAULT_MAX_SPRING_LENGTH:200,SPRING_COEFF:0,SPRING_LENGTH:1,params:null,minValues:null,maxValues:null,setup:function(){this.params=[this.DEFAULT_SPRING_COEFF,this.DEFAULT_SPRING_LENGTH],this.minValues=[this.DEFAULT_MIN_SPRING_COEFF,this.DEFAULT_MIN_SPRING_LENGTH],this.maxValues=[this.DEFAULT_MAX_SPRING_COEFF,this.DEFAULT_MAX_SPRING_LENGTH]},getForce:function(e){var t=e.item1,i=e.item2,n=e.length<0?this.params[this.SPRING_LENGTH]:e.length,a=t.location[0],o=t.location[1],s=i.location[0],r=i.location[1],h=s-a,l=r-o,c=Math.sqrt(h*h+l*l);0==c&&(h=(Math.random()-.5)/50,l=(Math.random()-.5)/50,c=Math.sqrt(h*h+l*l));var d=c-n,f=(e.coeff<0?this.params[this.SPRING_COEFF]:e.coeff)*d/c;t.force[0]+=f*h,t.force[1]+=f*l,i.force[0]+=-f*h,i.force[1]+=-f*l},init:function(){}}),DragForce=new t({pnames:["DragCoefficient"],DEFAULT_DRAG_COEFF:.01,DEFAULT_MIN_DRAG_COEFF:0,DEFAULT_MAX_DRAG_COEFF:.1,DRAG_COEFF:0,params:null,minValues:null,maxValues:null,setup:function(){this.params=[this.DEFAULT_DRAG_COEFF],this.minValues=[this.DEFAULT_MIN_DRAG_COEFF],this.maxValues=[this.DEFAULT_MAX_DRAG_COEFF]},getForce:function(e){e.force[0]-=this.params[this.DRAG_COEFF]*e.velocity[0],e.force[1]-=this.params[this.DRAG_COEFF]*e.velocity[1]},init:function(){}}),RungeKuttaIntegrator=new t({integrate:function(e,t){for(var i,n,a,o,s,r,h=e.speedLimit,l=0;l<e.items.length;l++){var c=e.items[l];o=t/c.mass,s=c.k,r=c.l,c.plocation[0]=c.location[0],c.plocation[1]=c.location[1],s[0][0]=t*c.velocity[0],s[0][1]=t*c.velocity[1],r[0][0]=o*c.force[0],r[0][1]=o*c.force[1],c.location[0]+=.5*s[0][0],c.location[1]+=.5*s[0][1]}e.accumulate();for(var l=0;l<e.items.length;l++){var c=e.items[l];o=t/c.mass,s=c.k,r=c.l,i=c.velocity[0]+.5*r[0][0],n=c.velocity[1]+.5*r[0][1],a=Math.sqrt(i*i+n*n),a>h&&(i=h*i/a,n=h*n/a),s[1][0]=t*i,s[1][1]=t*n,r[1][0]=o*c.force[0],r[1][1]=o*c.force[1],c.location[0]=c.plocation[0]+.5*s[1][0],c.location[1]=c.plocation[1]+.5*s[1][1]}e.accumulate();for(var l=0;l<e.items.length;l++){var c=e.items[l];o=t/c.mass,s=c.k,r=c.l,i=c.velocity[0]+.5*r[1][0],n=c.velocity[1]+.5*r[1][1],a=Math.sqrt(i*i+n*n),a>h&&(i=h*i/a,n=h*n/a),s[2][0]=t*i,s[2][1]=t*n,r[2][0]=o*c.force[0],r[2][1]=o*c.force[1],c.location[0]=c.plocation[0]+.5*s[2][0],c.location[1]=c.plocation[1]+.5*s[2][1]}e.accumulate();for(var l=0;l<e.items.length;l++){var c=e.items[l];o=t/c.mass,s=c.k,r=c.l;var d=c.plocation;i=c.velocity[0]+r[2][0],n=c.velocity[1]+r[2][1],a=Math.sqrt(i*i+n*n),a>h&&(i=h*i/a,n=h*n/a),s[3][0]=t*i,s[3][1]=t*n,r[3][0]=o*c.force[0],r[3][1]=o*c.force[1],c.location[0]=d[0]+(s[0][0]+s[3][0])/6+(s[1][0]+s[2][0])/3,c.location[1]=d[1]+(s[0][1]+s[3][1])/6+(s[1][1]+s[2][1])/3,i=(r[0][0]+r[3][0])/6+(r[1][0]+r[2][0])/3,n=(r[0][1]+r[3][1])/6+(r[1][1]+r[2][1])/3,a=Math.sqrt(i*i+n*n),a>h&&(i=h*i/a,n=h*n/a),c.velocity[0]+=i,c.velocity[1]+=n}}}),ForceSimulator=new t({speedLimit:1,iflen:0,sflen:0,integrator:null,items:null,springs:null,iforces:null,sforces:null,setup:function(){this.items=new Array,this.springs=new Array,this.iforces=new Array,this.sforces=new Array,this.integrator=new RungeKuttaIntegrator},accumulate:function(){for(var e=0;e<this.iforces.length;e++)this.iforces[e].init(this);for(var e=0;e<this.sforces.length;e++)this.sforces[e].init(this);for(var e=0;e<this.items.length;e++){this.items[e].force[0]=0,this.items[e].force[1]=0;for(var t=0;t<this.iforces.length;t++)this.iforces[t].getForce(this.items[e])}for(var e=0;e<this.springs.length;e++)for(var t=0;t<this.sforces.length;t++)this.sforces[t].getForce(this.springs[e])},runSimulator:function(e){this.accumulate(),this.integrator.integrate(this,e)},addForce:function(e,t){t?(this.iforces.push(e),this.iflen++):(this.sforces.push(e),this.sflen++)},addItem:function(e){this.items.push(e)},addSpring:function(e){this.springs.push(e)}}),Spring=new t({item1:null,item2:null,coeff:null,length:null,setup:function(e,t,i,n){this.item1=e,this.item2=t,this.coeff=i,this.length=n}}),ForceItem=new t({mass:1,force:null,velocity:null,location:null,plocation:null,k:[[0,0],[0,0],[0,0],[0,0]],l:[[0,0],[0,0],[0,0],[0,0]],setup:function(){this.force=new Array,this.velocity=new Array,this.location=new Array,this.plocation=new Array},init:function(e,t){this.force[0]=0,this.force[1]=0,this.velocity[0]=0,this.velocity[1]=0,this.location[0]=e,this.location[1]=t,this.plocation[0]=0,this.plocation[1]=0}}),x.ForceDirected=new t({getOptions:function(e){var t=this.canvas.getSize(),i=t.width,n=t.height,a=0;this.graph.eachNode(function(e){a++});var o=i*n/a,s=Math.sqrt(o),r=this.config.levelDistance;return{width:i-r,height:n-r,tstart:.1*i,nodef:function(e){return o/(e||1)},edgef:function(e){return s*(e-r)}}},compute:function(t,i){var n=e.splat(t||["current","start","end"]),a=this.getOptions();w.compute(this.graph,n,this.config),this.graph.computeLevels(this.root,0,"ignore"),this.graph.eachNode(function(t){e.each(n,function(i){var o=t.getPos(i);o.equals(u.KER)&&(o.x=a.width/5*(Math.random()-.5),o.y=a.height/5*(Math.random()-.5)),t.disp={},e.each(n,function(e){t.disp[e]=g(0,0)})})}),this.computePositions(n,a,i)},computePositions:function(e,t,i){var n=this.config.iterations,a=0,o=this;if(i)!function s(){for(var r=i.iter,h=0;r>h;h++)if(t.t=t.tstart,n&&(t.t*=1-a++/(n-1)),o.computePositionStep(e,t),n&&a>=n)return void i.onComplete();i.onStep(Math.round(a/(n-1)*100)),setTimeout(s,1)}();else for(;n>a;a++)t.t=t.tstart*(1-a/(n-1)),this.computePositionStep(e,t)},computePositionStep:function(t,i){var n=this.graph,a=Math.min,o=Math.max,s=g(0,0);n.eachNode(function(a){e.each(t,function(e){a.disp[e].x=0,a.disp[e].y=0}),n.eachNode(function(n){n.id!=a.id&&e.each(t,function(e){var t=a.getPos(e),o=n.getPos(e);s.x=t.x-o.x,s.y=t.y-o.y;var r=s.norm()||1;a.disp[e].$add(s.$scale(i.nodef(r)/r))})})});var r=!!n.getNode(this.root).visited;n.eachNode(function(n){n.eachAdjacency(function(a){var o=a.nodeTo;!!o.visited===r&&e.each(t,function(e){var t=n.getPos(e),a=o.getPos(e);s.x=t.x-a.x,s.y=t.y-a.y;var r=s.norm()||1;n.disp[e].$add(s.$scale(-i.edgef(r)/r)),o.disp[e].$add(s.$scale(-1))})}),n.visited=!r});var h=i.t,l=i.width/2,c=i.height/2;n.eachNode(function(i){e.each(t,function(e){var t=i.disp[e],n=t.norm()||1,e=i.getPos(e);e.$add(g(t.x*a(Math.abs(t.x),h)/n,t.y*a(Math.abs(t.y),h)/n)),e.x=a(l,o(-l,e.x)),e.y=a(c,o(-c,e.y))})})},computeFast:function(t,i){var n=new ForceSimulator;n.setup();var a=new NBodyForce;a.setup();var o=new SpringForce;o.setup();var s=new DragForce;s.setup(),n.addForce(a,!0),n.addForce(o,!1),n.addForce(s,!0);var r=1e3,h=e.splat(t||["current","start","end"]),l=this.getOptions(),c=[];w.compute(this.graph,h,this.config),this.graph.computeLevels(this.root,0,"ignore"),this.graph.eachNode(function(t){e.each(h,function(i){var a=t.getPos(i);a.x=l.width/2,a.y=l.height/2,t.forceItem=new ForceItem,t.forceItem.setup(),t.forceItem.init(a.x,a.y),n.addItem(t.forceItem),t.disp={},e.each(h,function(e){t.disp[e]=g(0,0)})})}),this.graph.eachNode(function(e){e.eachAdjacency(function(e){if(void 0===c[e.nodeTo.id]){var t=new Spring;t.setup(e.nodeFrom.forceItem,e.nodeTo.forceItem,-1,-1),n.addSpring(t),c[e.nodeFrom.id]=[],c[e.nodeFrom.id][e.nodeTo.id]=!0}})});var d=(Math.ceil(this.config.iterations/i.iter),this.config.iterations),f=0,u=this.graph;!function p(){for(var t=i.iter,a=0;t>a;a++){l.t=l.tstart,d&&(l.t*=1-f++/(d-1)),r*=1-f/d;var o=r+50;if(n.runSimulator(o),d&&f>=d){var s=l.width/2,c=l.height/2;u.eachNode(function(t){e.each(h,function(e){var i=t.forceItem.location[0],n=t.forceItem.location[1],a=(2*t.getData("dim"),2*t.getData("dim"),t.disp[e]),o=(a.norm()||1,t.getPos(e));o.x=i,o.y=n})}),i.onComplete();var g=-Number.MAX_VALUE,v=Number.MAX_VALUE,m=-Number.MAX_VALUE,y=Number.MAX_VALUE;u.eachNode(function(t){e.each(h,function(e){var i=t.getPos(e);i.x>g&&(g=i.x),i.x<v&&(v=i.x),i.y>m&&(m=i.y),i.y<y&&(y=i.y)})});var b,x;x=0>g?Math.ceil(Math.floor(Math.abs(v))-Math.floor(Math.abs(g))):v>=0?Math.ceil(g-v):Math.ceil(g+Math.abs(v)),b=0>m?Math.ceil(Math.floor(Math.abs(y))-Math.floor(Math.abs(m))):y>=0?Math.ceil(m-y):Math.ceil(m+Math.abs(y));var s=l.width/2,c=l.height/2;return void u.eachNode(function(t){e.each(h,function(e){var i=t.getPos(e),n=t.getData("dim");0>v?i.x=(i.x+Math.abs(v))*(l.width/x)-l.width/2:i.x=(i.x-v)*(l.width/x)-l.width/2,i.x<=-s+n&&(i.x=-s+2*n),i.x>=s-n&&(i.x=s-2*n),0>y?i.y=(i.y+Math.abs(y))*(l.height/b)-l.height/2:i.y=(i.y-y)*(l.height/b)-l.height/2,i.y<=-c+n&&(i.y=-c+2*n),i.y>=c-n&&(i.y=c-2*n)})})}}i.onStep(Math.round(f/(d-1)*100)),setTimeout(p,1)}()}}),$jit.ForceDirected=new t({Implements:[b,h,x.ForceDirected],initialize:function(t){var i=$jit.ForceDirected,n={iterations:50,levelDistance:50};this.controller=this.config=e.merge(a("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),n,t);var o=this.config;o.useCanvas?(this.canvas=o.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(o.background&&(o.background=e.merge({type:"Circles"},o.background)),this.canvas=new l(this,o),this.config.labelContainer=("string"==typeof o.injectInto?o.injectInto:o.injectInto.id)+"-label"),this.graphOptions={klass:u,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new v(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new i.Label[o.Label.type](this),this.fx=new i.Plot(this,i),this.op=new i.Op(this),this.json=null,this.busy=!1,this.initializeExtras()},refresh:function(){this.compute(),this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(t){t=e.merge({iter:20,property:"end",onStep:e.empty,onComplete:e.empty},t||{}),this.config.onBeforeCompute(this.graph.getNode(this.root)),this.compute(t.property,t)},computePrefuse:function(t){t=e.merge({iter:20,property:"end",onStep:e.empty,onComplete:e.empty},t||{}),this.config.onBeforeCompute(this.graph.getNode(this.root)),this.computeFast(t.property,t)},plot:function(){this.fx.plot()},animate:function(t){this.fx.animate(e.merge({modes:["linear"]},t||{}))}}),$jit.ForceDirected.$extend=!0,function(i){i.Op=new t({Implements:v.Op}),i.Plot=new t({Implements:v.Plot}),i.Label={},i.Label.Native=new t({Implements:v.Label.Native}),i.Label.SVG=new t({Implements:v.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY,l=a.getSize(),c={x:Math.round(n.x*r+o+l.width/2),y:Math.round(n.y*h+s+l.height/2)};e.setAttribute("x",c.x),e.setAttribute("y",c.y),i.onPlaceLabel(e,t)}}),i.Label.HTML=new t({Implements:v.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY,l=a.getSize(),c={x:Math.round(n.x*r+o+l.width/2),y:Math.round(n.y*h+s+l.height/2)},d=e.style;d.left=c.x+"px",d.top=c.y+"px",d.display=this.fitsInCanvas(c,a)?"":"none",i.onPlaceLabel(e,t)}}),i.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(!1)},circle:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");this.nodeHelper.circle.render("fill",i,n,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");return this.nodeHelper.circle.contains(i,t,n)}},ellipse:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");this.nodeHelper.ellipse.render("fill",i,n,a,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");return this.nodeHelper.ellipse.contains(i,t,n,a)}},square:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");this.nodeHelper.square.render("fill",i,n,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");return this.nodeHelper.square.contains(i,t,n)}},rectangle:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");this.nodeHelper.rectangle.render("fill",i,n,a,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");return this.nodeHelper.rectangle.contains(i,t,n,a)}},triangle:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");this.nodeHelper.triangle.render("fill",i,n,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");return this.nodeHelper.triangle.contains(i,t,n)}},star:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");this.nodeHelper.star.render("fill",i,n,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");return this.nodeHelper.star.contains(i,t,n)}}}),i.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);this.edgeHelper.line.render(i,n,t)},contains:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(i,n,t,this.edge.epsilon)}},arrow:{render:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0),a=e.getData("dim"),o=e.data.$direction,s=o&&o.length>1&&o[0]!=e.nodeFrom.id;this.edgeHelper.arrow.render(i,n,a,s,t)},contains:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(i,n,t,this.edge.epsilon)}}})}($jit.ForceDirected),$jit.TM={};var D=$jit.TM;$jit.TM.$extend=!0,D.Base={layout:{orientation:"h",vertical:function(){return"v"==this.orientation},horizontal:function(){return"h"==this.orientation},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(t){var i={orientation:"h",titleHeight:13,offset:2,levelsToShow:0,labelsToShow:[0,-1],constrained:!1,animate:!1,Node:{type:"rectangle",overridable:!0,width:3,height:3,color:"#444",props:"node-property:width:height"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45};this.controller=this.config=e.merge(a("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),i,t),this.layout.orientation=this.config.orientation;var n=this.config;n.useCanvas?(this.canvas=n.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(n.background&&(n.background=e.merge({type:"Circles"},n.background)),this.canvas=new l(this,n),this.config.labelContainer=("string"==typeof n.injectInto?n.injectInto:n.injectInto.id)+"-label"),this.graphOptions={klass:u,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new v(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new D.Label[n.Label.type](this),this.fx=new D.Plot(this),this.op=new D.Op(this),this.group=new D.Group(this),this.geom=new D.Geom(this),this.clickedNode=null,this.busy=!1,this.initializeExtras()},refresh:function(){if(!this.busy){this.busy=!0;var t=this;if(this.config.animate)this.compute("end"),this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.fx.animate(e.merge(this.config,{modes:["linear",this.config.Node.props],onComplete:function(){t.busy=!1}}));else{var i=this.config.Label.type;"Native"!=i&&this.graph.eachNode(function(e){t.labels.hideLabel(e,!1)}),this.busy=!1,this.compute(),this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root)),this.plot()}}},plot:function(){this.fx.plot()},leaf:function(e){return 0==e.getSubnodes([1,1],"ignore").length},enter:function(e){if(!this.busy){this.busy=!0;var t=this,i=this.config,n=this.graph,a=e,o=this.clickedNode,s={onComplete:function(){t.geom.setRightLevelToShow(e),i.request&&t.compute(),i.animate?(n.nodeList.setData("alpha",0,"end"),e.eachSubgraph(function(e){e.setData("alpha",1,"end"),e.selected=!1},"ignore"),a.selected=!0,t.fx.animate({duration:t.config.duration/3,modes:["node-property:alpha"],onComplete:function(){t.clickedNode=a,t.compute("end"),t.clickedNode=o,t.fx.animate({duration:2*t.config.duration/3,modes:["linear",t.config.Node.props],onComplete:function(){t.busy=!1,t.clickedNode=a,t.geom.setRightLevelToShow(a)}})}})):(t.busy=!1,t.clickedNode=e,t.refresh())}};this.geom.setRightLevelToShow(e),i.request?this.requestNodes(a,s):s.onComplete()}},out:function(){if(!this.busy){this.busy=!0,this.events.hoveredNode=!1;var e=this,t=this.config,i=this.graph,n=i.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents(),a=n[0],o=a,s=this.clickedNode;if(!a)return void(this.busy=!1);a.selected=!0;var r={onComplete:function(){s.selected=!1,e.clickedNode=a,t.request?e.requestNodes(a,{onComplete:function(){e.compute(),e.plot(),e.busy=!1}}):(e.compute(),e.plot(),e.busy=!1),e.geom.setRightLevelToShow(a),e.plot()}};this.geom.setRightLevelToShow(a),t.animate?(this.clickedNode=o,this.compute("end"),this.clickedNode=s,this.fx.animate({duration:2*this.config.duration/3,modes:["linear",this.config.Node.props],onComplete:function(){e.clickedNode=o,o.eachSubgraph(function(e){e.setDataset(["current","end"],{alpha:[0,1]})},"ignore"),s.eachSubgraph(function(e){e.setData("alpha",1)},"ignore"),e.geom.setRightLevelToShow(a),e.fx.animate({duration:e.config.duration/3,modes:["node-property:alpha"],onComplete:function(){r.onComplete()}})}})):r.onComplete()}},requestNodes:function(t,i){var n=e.merge(this.controller,i),a=this.config.levelsToShow;if(n.request){var o=[],s=t._depth;t.eachLevel(0,a,function(e){var t=a-(e._depth-s);e.drawn&&!e.anySubnode()&&t>0&&(o.push(e),e._level=t)}),this.group.requestNodes(o,n)}else n.onComplete()},reposition:function(){this.compute("end")}},D.Op=new t({Implements:v.Op,initialize:function(e){this.viz=e}}),D.Geom=new t({Implements:v.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(e){var t=this.getRightLevelToShow(),i=this.viz.config.labelsToShow,n=this.viz.labels,a={};e.eachLevel(0,!1,function(o){var s=o._depth-e._depth;o._hideLabel=i[0]>=0&&s<i[0]||i[1]>=0&&s>i[1],t>0&&s>t?(o.drawn=!1,o.exist=!1,o.ignore=!0,n.hideLabel(o,!1)):(o.drawn=!0,o.exist=!0,delete o.ignore),a[o.name]=o._hideLabel}),e.drawn=!0,delete e.ignore}}),D.Group=new t({initialize:function(e){this.viz=e,this.canvas=e.canvas,this.config=e.config},requestNodes:function(e,t){var i=0,n=e.length,a={},o=function(){t.onComplete()},s=this.viz;0==n&&o();for(var r=0;n>r;r++)a[e[r].id]=e[r],t.request(e[r].id,e[r]._level,{onComplete:function(e,t){t&&t.children&&(t.id=e,s.op.sum(t,{type:"nothing"})),++i==n&&(s.graph.computeLevels(s.root,0),o())}})}}),D.Plot=new t({Implements:v.Plot,initialize:function(e){this.viz=e,this.config=e.config,this.node=this.config.Node,this.edge=this.config.Edge,this.animation=new n,this.nodeTypes=new D.Plot.NodeTypes,this.edgeTypes=new D.Plot.EdgeTypes,this.labels=e.labels},plot:function(t,i){var n=this.viz,a=n.graph;n.canvas.clear(),this.plotTree(a.getNode(n.clickedNode&&n.clickedNode.id||n.root),e.merge(n.config,t||{},{withLabels:!0,hideLabels:!1,plotSubtree:function(e,t){return e.anySubnode("exist")}}),i)}}),D.Label={},D.Label.Native=new t({Implements:v.Label.Native,initialize:function(e){this.config=e.config,this.leaf=e.leaf},renderLabel:function(e,t,i){if(!t._hideLabel&&(this.leaf(t)||this.config.titleHeight)){var n=t.pos.getc(!0),a=e.getCtx(),o=t.getData("width"),s=(t.getData("height"),n.x+o/2),r=n.y;isNaN(o)||0===o?a.fillText(t.name,s,r):a.fillText(t.name,s,r,o)}}}),D.Label.SVG=new t({Implements:v.Label.SVG,initialize:function(e){this.viz=e,this.leaf=e.leaf,this.config=e.config},placeLabel:function(e,t,i){i=i||this.viz.controller;var n=t.pos.getc(!0),a=this.viz.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY,l=a.getSize(),c={x:Math.round(n.x*r+o+l.width/2),y:Math.round(n.y*h+s+l.height/2)};e.setAttribute("x",c.x),e.setAttribute("y",c.y),(t._hideLabel||!this.leaf(t)&&!this.config.titleHeight)&&(e.style.display="none"),i.onPlaceLabel(e,t)}}),D.Label.HTML=new t({Implements:v.Label.HTML,initialize:function(e){this.viz=e,this.leaf=e.leaf,this.config=e.config},placeLabel:function(e,t,i){i=i||this.viz.controller;var n=t.pos.getc(!0),a=this.viz.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY,l=a.getSize(),c={x:Math.round(n.x*r+o+l.width/2),y:Math.round(n.y*h+s+l.height/2)},d=e.style;d.left=c.x+"px",d.top=c.y+"px",d.width=Math.max(0,t.getData("width")*r)+"px",d.height=Math.max(0,t.getData("height")*h)+"px",d.zIndex=100*t._depth,d.display="",(t._hideLabel||!this.leaf(t)&&!this.config.titleHeight)&&(e.style.display="none"),i.onPlaceLabel(e,t)}}),D.Plot.NodeTypes=new t({none:{render:e.empty},rectangle:{render:function(t,i,n){var a=this.viz.leaf(t),o=this.config,s=o.offset,r=o.titleHeight,h=t.pos.getc(!0),l=t.getData("width"),c=t.getData("height"),d=t.getData("border"),f=i.getCtx(),u=h.x+s/2,g=h.y+s/2;if(!(s>=l||s>=c))if(a){if(o.cushion){var p=f.createRadialGradient(u+(l-s)/2,g+(c-s)/2,1,u+(l-s)/2,g+(c-s)/2,c>l?c:l),v=t.getData("color"),m=e.rgbToHex(e.map(e.hexToRgb(v),function(e){return.2*e>>0}));p.addColorStop(0,v),p.addColorStop(1,m),f.fillStyle=p}f.fillRect(u,g,l-s,c-s),d&&(f.save(),f.strokeStyle=d,f.strokeRect(u,g,l-s,c-s),f.restore())}else r>0&&(f.fillRect(h.x+s/2,h.y+s/2,l-s,r-s),d&&(f.save(),f.strokeStyle=d,f.strokeRect(h.x+s/2,h.y+s/2,l-s,c-s),f.restore()))},contains:function(e,t){if(this.viz.clickedNode&&!e.isDescendantOf(this.viz.clickedNode.id)||e.ignore)return!1;
var i=e.pos.getc(!0),n=e.getData("width"),a=this.viz.leaf(e),o=a?e.getData("height"):this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:i.x+n/2,y:i.y+o/2},t,n,o)}}}),D.Plot.EdgeTypes=new t({none:e.empty}),D.SliceAndDice=new t({Implements:[b,h,D.Base,x.TM.SliceAndDice]}),D.Squarified=new t({Implements:[b,h,D.Base,x.TM.Squarified]}),D.Strip=new t({Implements:[b,h,D.Base,x.TM.Strip]}),$jit.RGraph=new t({Implements:[b,h,x.Radial],initialize:function(t){var i=$jit.RGraph,n={interpolation:"linear",levelDistance:100};this.controller=this.config=e.merge(a("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),n,t);var o=this.config;o.useCanvas?(this.canvas=o.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(o.background&&(o.background=e.merge({type:"Circles"},o.background)),this.canvas=new l(this,o),this.config.labelContainer=("string"==typeof o.injectInto?o.injectInto:o.injectInto.id)+"-label"),this.graphOptions={klass:d,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new v(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new i.Label[o.Label.type](this),this.fx=new i.Plot(this,i),this.op=new i.Op(this),this.json=null,this.root=null,this.busy=!1,this.parent=!1,this.initializeExtras()},createLevelDistanceFunc:function(){var e=this.config.levelDistance;return function(t){return(t._depth+1)*e}},refresh:function(){this.compute(),this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(e){var t=!1,i=this.graph.getNode(e),n=i.getParents(),a=n.length>0?n[0]:!1;if(a){var o=a.pos.getc(),s=i.pos.getc(),r=o.add(s.scale(-1));t=Math.atan2(r.y,r.x),0>t&&(t+=2*Math.PI)}return{parent:a,theta:t}},tagChildren:function(e,t){if(e.angleSpan){var i=[];e.eachAdjacency(function(e){i.push(e.nodeTo)},"ignore");for(var n=i.length,a=0;n>a&&t!=i[a].id;a++);for(var o=(a+1)%n,s=0;t!=i[o].id;o=(o+1)%n)i[o].dist=s++}},onClick:function(t,i){if(this.root!=t&&!this.busy){this.busy=!0,this.root=t;var n=this;this.controller.onBeforeCompute(this.graph.getNode(t));var a=this.getNodeAndParentAngle(t);this.tagChildren(a.parent,t),this.parent=a.parent,this.compute("end");var o=a.theta-a.parent.endPos.theta;this.graph.eachNode(function(e){e.endPos.set(e.endPos.getp().add(f(o,0)))});var s=this.config.interpolation;i=e.merge({onComplete:e.empty},i||{}),this.fx.animate(e.merge({hideLabels:!0,modes:[s]},i,{onComplete:function(){n.busy=!1,i.onComplete()}}))}}}),$jit.RGraph.$extend=!0,function(i){i.Op=new t({Implements:v.Op}),i.Plot=new t({Implements:v.Plot}),i.Label={},i.Label.Native=new t({Implements:v.Label.Native}),i.Label.SVG=new t({Implements:v.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY,l=a.getSize(),c={x:Math.round(n.x*r+o+l.width/2),y:Math.round(n.y*h+s+l.height/2)};e.setAttribute("x",c.x),e.setAttribute("y",c.y),i.onPlaceLabel(e,t)}}),i.Label.HTML=new t({Implements:v.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY,l=a.getSize(),c={x:Math.round(n.x*r+o+l.width/2),y:Math.round(n.y*h+s+l.height/2)},d=e.style;d.left=c.x+"px",d.top=c.y+"px",d.display=this.fitsInCanvas(c,a)?"":"none",i.onPlaceLabel(e,t)}}),i.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(!1)},circle:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");this.nodeHelper.circle.render("fill",i,n,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");return this.nodeHelper.circle.contains(i,t,n)}},ellipse:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");this.nodeHelper.ellipse.render("fill",i,n,a,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");return this.nodeHelper.ellipse.contains(i,t,n,a)}},square:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");this.nodeHelper.square.render("fill",i,n,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");return this.nodeHelper.square.contains(i,t,n)}},rectangle:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");this.nodeHelper.rectangle.render("fill",i,n,a,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("width"),a=e.getData("height");return this.nodeHelper.rectangle.contains(i,t,n,a)}},triangle:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");this.nodeHelper.triangle.render("fill",i,n,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");return this.nodeHelper.triangle.contains(i,t,n)}},star:{render:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");this.nodeHelper.star.render("fill",i,n,t)},contains:function(e,t){var i=e.pos.getc(!0),n=e.getData("dim");return this.nodeHelper.star.contains(i,t,n)}}}),i.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);this.edgeHelper.line.render(i,n,t)},contains:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);return this.edgeHelper.line.contains(i,n,t,this.edge.epsilon)}},arrow:{render:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0),a=e.getData("dim"),o=e.data.$direction,s=o&&o.length>1&&o[0]!=e.nodeFrom.id,r=this.edge.arrowPosition||"end";this.edgeHelper.arrow.render(i,n,a,s,t,r)},contains:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0);return this.edgeHelper.arrow.contains(i,n,t,this.edge.epsilon)}}})}($jit.RGraph),u.prototype.moebiusTransformation=function(e){var t=this.add(e),i=e.$conjugate().$prod(this);return i.x++,t.$div(i)},v.Util.moebiusTransformation=function(e,t,i,n,a){this.eachNode(e,function(e){for(var a=0;a<i.length;a++){var o=t[a].scale(-1),s=n?n:i[a];e.getPos(i[a]).set(e.getPos(s).getc().moebiusTransformation(o))}},a)},$jit.Hypertree=new t({Implements:[b,h,x.Radial],initialize:function(t){var i=$jit.Hypertree,n={radius:"auto",offset:0,Edge:{type:"hyperline"},duration:1500,fps:35};this.controller=this.config=e.merge(a("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),n,t);var o=this.config;o.useCanvas?(this.canvas=o.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(o.background&&(o.background=e.merge({type:"Circles"},o.background)),this.canvas=new l(this,o),this.config.labelContainer=("string"==typeof o.injectInto?o.injectInto:o.injectInto.id)+"-label"),this.graphOptions={klass:d,Node:{selected:!1,exist:!0,drawn:!0}},this.graph=new v(this.graphOptions,this.config.Node,this.config.Edge),this.labels=new i.Label[o.Label.type](this),this.fx=new i.Plot(this,i),this.op=new i.Op(this),this.json=null,this.root=null,this.busy=!1,this.initializeExtras()},createLevelDistanceFunc:function(){var e=this.getRadius(),t=0,i=Math.max,n=this.config;this.graph.eachNode(function(e){t=i(e._depth,t)},"ignore"),t++;for(var a=function(t){return function(i){i.scale=e;for(var a=i._depth+1,o=0,s=Math.pow;a;)o+=s(t,a--);return o-n.offset}},o=.51;1>=o;o+=.01){var s=(1-Math.pow(o,t))/(1-o);if(s>=2)return a(o-.01)}return a(.75)},getRadius:function(){var e=this.config.radius;if("auto"!==e)return e;var t=this.canvas.getSize();return Math.min(t.width,t.height)/2},refresh:function(e){e?(this.reposition(),this.graph.eachNode(function(e){e.startPos.rho=e.pos.rho=e.endPos.rho,e.startPos.theta=e.pos.theta=e.endPos.theta})):this.compute(),this.plot()},reposition:function(){this.compute("end");var e=this.graph.getNode(this.root).pos.getc().scale(-1);v.Util.moebiusTransformation(this.graph,[e],["end"],"end","ignore"),this.graph.eachNode(function(e){e.ignore&&(e.endPos.rho=e.pos.rho,e.endPos.theta=e.pos.theta)})},plot:function(){this.fx.plot()},onClick:function(e,t){var i=this.graph.getNode(e).pos.getc(!0);this.move(i,t)},move:function(t,i){var n=g(t.x,t.y);if(this.busy===!1&&n.norm()<1){this.busy=!0;var a=this.graph.getClosestNodeToPos(n),o=this;this.graph.computeLevels(a.id,0),this.controller.onBeforeCompute(a),i=e.merge({onComplete:e.empty},i||{}),this.fx.animate(e.merge({modes:["moebius"],hideLabels:!0},i,{onComplete:function(){o.busy=!1,i.onComplete()}}),n)}}}),$jit.Hypertree.$extend=!0,function(i){i.Op=new t({Implements:v.Op}),i.Plot=new t({Implements:v.Plot}),i.Label={},i.Label.Native=new t({Implements:v.Label.Native,initialize:function(e){this.viz=e},renderLabel:function(e,t,i){var n=e.getCtx(),a=t.pos.getc(!0),o=this.viz.getRadius();n.fillText(t.name,a.x*o,a.y*o)}}),i.Label.SVG=new t({Implements:v.Label.SVG,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY,l=a.getSize(),c=this.viz.getRadius(),d={x:Math.round(n.x*r*c+o+l.width/2),y:Math.round(n.y*h*c+s+l.height/2)};e.setAttribute("x",d.x),e.setAttribute("y",d.y),i.onPlaceLabel(e,t)}}),i.Label.HTML=new t({Implements:v.Label.HTML,initialize:function(e){this.viz=e},placeLabel:function(e,t,i){var n=t.pos.getc(!0),a=this.viz.canvas,o=a.translateOffsetX,s=a.translateOffsetY,r=a.scaleOffsetX,h=a.scaleOffsetY,l=a.getSize(),c=this.viz.getRadius(),d={x:Math.round(n.x*r*c+o+l.width/2),y:Math.round(n.y*h*c+s+l.height/2)},f=e.style;f.left=d.x+"px",f.top=d.y+"px",f.display=this.fitsInCanvas(d,a)?"":"none",i.onPlaceLabel(e,t)}}),i.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(!1)},circle:{render:function(e,t){var i=this.node,n=e.getData("dim"),a=e.pos.getc();n=i.transform?n*(1-a.squaredNorm()):n,a.$scale(e.scale),n>.2&&this.nodeHelper.circle.render("fill",a,n,t)},contains:function(e,t){var i=e.getData("dim"),n=e.pos.getc().$scale(e.scale);return this.nodeHelper.circle.contains(n,t,i)}},ellipse:{render:function(e,t){var i=e.pos.getc().$scale(e.scale),n=e.getData("width"),a=e.getData("height");this.nodeHelper.ellipse.render("fill",i,n,a,t)},contains:function(e,t){var i=e.getData("width"),n=e.getData("height"),a=e.pos.getc().$scale(e.scale);return this.nodeHelper.circle.contains(a,t,i,n)}},square:{render:function(e,t){var i=this.node,n=e.getData("dim"),a=e.pos.getc();n=i.transform?n*(1-a.squaredNorm()):n,a.$scale(e.scale),n>.2&&this.nodeHelper.square.render("fill",a,n,t)},contains:function(e,t){var i=e.getData("dim"),n=e.pos.getc().$scale(e.scale);return this.nodeHelper.square.contains(n,t,i)}},rectangle:{render:function(e,t){var i=this.node,n=e.getData("width"),a=e.getData("height"),o=e.pos.getc();n=i.transform?n*(1-o.squaredNorm()):n,a=i.transform?a*(1-o.squaredNorm()):a,o.$scale(e.scale),n>.2&&a>.2&&this.nodeHelper.rectangle.render("fill",o,n,a,t)},contains:function(e,t){var i=e.getData("width"),n=e.getData("height"),a=e.pos.getc().$scale(e.scale);return this.nodeHelper.rectangle.contains(a,t,i,n)}},triangle:{render:function(e,t){var i=this.node,n=e.getData("dim"),a=e.pos.getc();n=i.transform?n*(1-a.squaredNorm()):n,a.$scale(e.scale),n>.2&&this.nodeHelper.triangle.render("fill",a,n,t)},contains:function(e,t){var i=e.getData("dim"),n=e.pos.getc().$scale(e.scale);return this.nodeHelper.triangle.contains(n,t,i)}},star:{render:function(e,t){var i=this.node,n=e.getData("dim"),a=e.pos.getc();n=i.transform?n*(1-a.squaredNorm()):n,a.$scale(e.scale),n>.2&&this.nodeHelper.star.render("fill",a,n,t)},contains:function(e,t){var i=e.getData("dim"),n=e.pos.getc().$scale(e.scale);return this.nodeHelper.star.contains(n,t,i)}}}),i.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0),a=e.nodeFrom.scale;this.edgeHelper.line.render({x:i.x*a,y:i.y*a},{x:n.x*a,y:n.y*a},t)},contains:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0),a=e.nodeFrom.scale;this.edgeHelper.line.contains({x:i.x*a,y:i.y*a},{x:n.x*a,y:n.y*a},t,this.edge.epsilon)}},arrow:{render:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0),a=e.nodeFrom.scale,o=e.getData("dim"),s=e.data.$direction,r=s&&s.length>1&&s[0]!=e.nodeFrom.id;this.edgeHelper.arrow.render({x:i.x*a,y:i.y*a},{x:n.x*a,y:n.y*a},o,r,t)},contains:function(e,t){var i=e.nodeFrom.pos.getc(!0),n=e.nodeTo.pos.getc(!0),a=e.nodeFrom.scale;this.edgeHelper.arrow.contains({x:i.x*a,y:i.y*a},{x:n.x*a,y:n.y*a},t,this.edge.epsilon)}},hyperline:{render:function(e,t){var i=e.nodeFrom.pos.getc(),n=e.nodeTo.pos.getc(),a=this.viz.getRadius();this.edgeHelper.hyperline.render(i,n,a,t)},contains:e.lambda(!1)}})}($jit.Hypertree)}();